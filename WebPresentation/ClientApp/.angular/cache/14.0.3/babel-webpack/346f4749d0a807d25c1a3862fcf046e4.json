{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/ClientApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../Graphic.js\";\nimport r from \"../../../core/Accessor.js\";\nimport s from \"../../../core/Collection.js\";\nimport i from \"../../../core/Error.js\";\nimport has from \"../../../core/has.js\";\nimport { getOrCreateMapValue as o } from \"../../../core/MapUtils.js\";\nimport { isSome as a, isNone as n } from \"../../../core/maybe.js\";\nimport { debounce as l, eachAlways as p } from \"../../../core/promiseUtils.js\";\nimport { on as c } from \"../../../core/reactiveUtils.js\";\nimport { getMetersPerUnitForSR as u } from \"../../../core/unitUtils.js\";\nimport { property as h } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/arrayUtils.js\";\nimport { subclass as y } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport m from \"../../../geometry/Extent.js\";\nimport { getResolutionForScale as f } from \"../../../geometry/support/scaleUtils.js\";\nimport { getLayerFloorFilterClause as d } from \"../../../layers/support/floorFilterUtils.js\";\nimport { calculateTolerance as g } from \"../../../renderers/support/clickToleranceUtils.js\";\nimport { identify as w } from \"../../../rest/identify.js\";\nimport b from \"../../../rest/support/IdentifyParameters.js\";\nimport { loadArcade as v } from \"../../../support/arcadeOnDemand.js\";\nimport j from \"../../../symbols/SimpleMarkerSymbol.js\";\nimport { getRequiredFields as x, getFetchPopupTemplate as F } from \"./popupUtils.js\";\nlet G = null;\n\nfunction P(e, t) {\n  return \"tile\" === t.type || \"map-image\" === t.type;\n}\n\nlet S = class extends r {\n  constructor(e) {\n    var _this;\n\n    (super(e), _this = this), this._featuresResolutions = new WeakMap(), this.highlightGraphics = null, this.highlightGraphicUpdated = null, this.updateHighlightedFeatures = l( /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (e) {\n        _this.destroyed || _this.updatingHandles.addPromise(_this._updateHighlightedFeaturesGeometries(e).catch(() => {}));\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  }\n\n  initialize() {\n    const e = e => {\n      this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(e).catch(() => {})), this.updateHighlightedFeatures(this._highlightGeometriesResolution);\n    };\n\n    this.addHandles([c(() => this.highlightGraphics, \"change\", t => e(t.added), {\n      onListenerAdd: t => e(t)\n    })]);\n  }\n\n  fetchPopupFeatures(e, t) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      const {\n        layerView: {\n          layer: r,\n          view: {\n            scale: s\n          }\n        }\n      } = _this2;\n      if (!e) throw new i(\"fetchPopupFeatures:invalid-area\", \"Nothing to fetch without area\", {\n        layer: r\n      });\n\n      const o = _(r.sublayers, s, t);\n\n      if (!o.length) return [];\n      const a = yield R(r, o);\n      if (!((r.capabilities?.operations?.supportsIdentify ?? !0) && r.version >= 10.5) && !a) throw new i(\"fetchPopupFeatures:not-supported\", \"query operation is disabled for this service\", {\n        layer: r\n      });\n      return a ? _this2._fetchPopupFeaturesUsingQueries(e, o, t) : _this2._fetchPopupFeaturesUsingIdentify(e, o, t);\n    })();\n  }\n\n  clearHighlights() {\n    this.highlightGraphics?.removeAll();\n  }\n\n  highlight(e) {\n    const r = this.highlightGraphics;\n    if (!r) return {\n      remove() {}\n\n    };\n    let i = null;\n    if (e instanceof t ? i = [e] : s.isCollection(e) && e.length > 0 ? i = e.toArray() : Array.isArray(e) && e.length > 0 && (i = e), i = i?.filter(a), !i || !i.length) return {\n      remove: () => {}\n    };\n\n    for (const t of i) {\n      const e = t.sourceLayer;\n      null != e && \"geometryType\" in e && \"point\" === e.geometryType && (t.visible = !1);\n    }\n\n    return r.addMany(i), {\n      remove: () => {\n        r.removeMany(i ?? []);\n      }\n    };\n  }\n\n  _updateHighlightedFeaturesSymbols(e) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      const {\n        layerView: {\n          view: t\n        },\n        highlightGraphics: r,\n        highlightGraphicUpdated: s\n      } = _this3;\n      if (r && s) for (const i of e) {\n        const e = i.sourceLayer && \"renderer\" in i.sourceLayer && i.sourceLayer.renderer;\n        i.sourceLayer && \"geometryType\" in i.sourceLayer && \"point\" === i.sourceLayer.geometryType && e && \"getSymbolAsync\" in e && e.getSymbolAsync(i).then( /*#__PURE__*/function () {\n          var _ref2 = _asyncToGenerator(function* (o) {\n            o || (o = new j());\n            let a = null;\n            const n = \"visualVariables\" in e ? e.visualVariables?.find(e => \"size\" === e.type) : void 0;\n            n && (G || (G = (yield import(\"../../../renderers/visualVariables/support/visualVariableUtils.js\")).getSize), a = G(n, i, {\n              view: t.type,\n              scale: t.scale,\n              shape: \"simple-marker\" === o.type ? o.style : null\n            })), a || (a = \"width\" in o && \"height\" in o && null != o.width && null != o.height ? Math.max(o.width, o.height) : \"size\" in o ? o.size : 16), r.includes(i) && (i.symbol = new j({\n              style: \"square\",\n              size: a,\n              xoffset: \"xoffset\" in o ? o.xoffset : 0,\n              yoffset: \"yoffset\" in o ? o.yoffset : 0\n            }), s(i, \"symbol\"), i.visible = !0);\n          });\n\n          return function (_x2) {\n            return _ref2.apply(this, arguments);\n          };\n        }());\n      }\n    })();\n  }\n\n  _updateHighlightedFeaturesGeometries(e) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      const {\n        layerView: {\n          layer: t,\n          view: r\n        },\n        highlightGraphics: s,\n        highlightGraphicUpdated: i\n      } = _this4;\n      if (_this4._highlightGeometriesResolution = e, !i || !s?.length || !t.capabilities.operations.supportsQuery) return;\n\n      const a = _this4._getTargetResolution(e),\n            n = new Map();\n\n      for (const c of s) if (!_this4._featuresResolutions.has(c) || _this4._featuresResolutions.get(c) > a) {\n        const e = c.sourceLayer;\n        o(n, e, () => new Map()).set(c.getObjectId(), c);\n      }\n\n      const l = Array.from(n, ([e, t]) => {\n        const s = e.createQuery();\n        return s.objectIds = [...t.keys()], s.outFields = [e.objectIdField], s.returnGeometry = !0, s.maxAllowableOffset = a, s.outSpatialReference = r.spatialReference, e.queryFeatures(s);\n      }),\n            p = yield Promise.all(l);\n      if (!_this4.destroyed) for (const {\n        features: o\n      } of p) for (const e of o) {\n        const t = e.sourceLayer,\n              r = n.get(t).get(e.getObjectId());\n        r && s.includes(r) && (r.geometry = e.geometry, i(r, \"geometry\"), _this4._featuresResolutions.set(r, a));\n      }\n    })();\n  }\n\n  _getTargetResolution(e) {\n    const t = e * u(this.layerView.view.spatialReference),\n          r = t / 16;\n    return r <= 10 ? 0 : e / t * r;\n  }\n\n  _fetchPopupFeaturesUsingIdentify(e, t, r) {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      const s = yield _this5._createIdentifyParameters(e, t, r);\n      if (n(s)) return [];\n      const {\n        results: i\n      } = yield w(_this5.layerView.layer.parsedUrl, s);\n      return i.map(e => e.feature);\n    })();\n  }\n\n  _createIdentifyParameters(e, t, r) {\n    var _this6 = this;\n\n    return _asyncToGenerator(function* () {\n      const {\n        floors: s,\n        layer: i,\n        timeExtent: o,\n        view: {\n          spatialReference: n,\n          scale: l\n        }\n      } = _this6.layerView,\n            p = a(r) ? r.event : null;\n      if (!t.length) return null;\n      yield Promise.all(t.map(({\n        sublayer: e\n      }) => e.load().catch(() => {})));\n\n      const c = Math.min(has(\"mapservice-popup-identify-max-tolerance\"), i.allSublayers.reduce((e, t) => t.renderer ? g({\n        renderer: t.renderer,\n        event: p\n      }) : e, 2)),\n            u = _this6.createFetchPopupFeaturesQueryGeometry(e, c),\n            h = f(l, n),\n            y = Math.round(u.width / h),\n            d = new m({\n        xmin: u.center.x - h * y,\n        ymin: u.center.y - h * y,\n        xmax: u.center.x + h * y,\n        ymax: u.center.y + h * y,\n        spatialReference: u.spatialReference\n      });\n\n      return new b({\n        floors: s,\n        gdbVersion: \"gdbVersion\" in i ? i.gdbVersion : void 0,\n        geometry: e,\n        height: y,\n        layerOption: \"popup\",\n        mapExtent: d,\n        returnGeometry: !0,\n        spatialReference: n,\n        sublayers: i.sublayers,\n        timeExtent: o,\n        tolerance: c,\n        width: y\n      });\n    })();\n  }\n\n  _fetchPopupFeaturesUsingQueries(e, t, r) {\n    var _this7 = this;\n\n    return _asyncToGenerator(function* () {\n      const {\n        layerView: {\n          floors: s,\n          timeExtent: i\n        }\n      } = _this7,\n            o = a(r) ? r.event : null,\n            n = t.map( /*#__PURE__*/function () {\n        var _ref3 = _asyncToGenerator(function* ({\n          sublayer: t,\n          popupTemplate: r\n        }) {\n          if (yield t.load().catch(() => {}), t.capabilities && !t.capabilities.operations.supportsQuery) return [];\n\n          const n = t.createQuery(),\n                l = g({\n            renderer: t.renderer,\n            event: o\n          }),\n                p = _this7.createFetchPopupFeaturesQueryGeometry(e, l);\n\n          if (n.geometry = p, n.outFields = yield x(t, r), n.timeExtent = i, s) {\n            const e = s.clone(),\n                  r = d(e, t);\n            a(r) && (n.where = n.where ? `(${n.where}) AND (${r})` : r);\n          }\n\n          const c = _this7._getTargetResolution(p.width / l),\n                u = yield U(r),\n                h = \"point\" === t.geometryType || u && u.arcadeUtils.hasGeometryOperations(r);\n\n          h || (n.maxAllowableOffset = c);\n          let {\n            features: y\n          } = yield t.queryFeatures(n);\n          const m = h ? 0 : c;\n          y = yield A(t, y);\n\n          for (const e of y) _this7._featuresResolutions.set(e, m);\n\n          return y;\n        });\n\n        return function (_x3) {\n          return _ref3.apply(this, arguments);\n        };\n      }());\n      return (yield p(n)).reverse().reduce((e, t) => t.value ? [...e, ...t.value] : e, []).filter(e => null != e);\n    })();\n  }\n\n};\n\nfunction _(e, t, r) {\n  const s = [],\n        i = e => {\n    const o = 0 === e.minScale || t <= e.minScale,\n          n = 0 === e.maxScale || t >= e.maxScale;\n    if (e.visible && o && n) if (e.sublayers) e.sublayers.forEach(i);else if (e.popupEnabled) {\n      const t = F(e, { ...r,\n        defaultPopupTemplateEnabled: !1\n      });\n      a(t) && s.unshift({\n        sublayer: e,\n        popupTemplate: t\n      });\n    }\n  };\n\n  return (e?.toArray() ?? []).reverse().map(i), s;\n}\n\nfunction U(e) {\n  return e.expressionInfos?.length || Array.isArray(e.content) && e.content.some(e => \"expression\" === e.type) ? v() : Promise.resolve();\n}\n\nfunction R(_x4, _x5) {\n  return _R.apply(this, arguments);\n}\n\nfunction _R() {\n  _R = _asyncToGenerator(function* (e, t) {\n    if (e.capabilities?.operations?.supportsQuery) return !0;\n\n    try {\n      return yield Promise.any(t.map(({\n        sublayer: e\n      }) => e.load().then(() => e.capabilities.operations.supportsQuery)));\n    } catch {\n      return !1;\n    }\n  });\n  return _R.apply(this, arguments);\n}\n\nfunction A(_x6, _x7) {\n  return _A.apply(this, arguments);\n}\n\nfunction _A() {\n  _A = _asyncToGenerator(function* (e, t) {\n    const r = e.renderer;\n    return r && \"defaultSymbol\" in r && !r.defaultSymbol && (t = r.valueExpression ? yield Promise.all(t.map(e => r.getSymbolAsync(e).then(t => t ? e : null))).then(e => e.filter(e => null != e)) : t.filter(e => null != r.getSymbol(e))), t;\n  });\n  return _A.apply(this, arguments);\n}\n\ne([h({\n  constructOnly: !0\n})], S.prototype, \"createFetchPopupFeaturesQueryGeometry\", void 0), e([h({\n  constructOnly: !0\n})], S.prototype, \"layerView\", void 0), e([h({\n  constructOnly: !0\n})], S.prototype, \"highlightGraphics\", void 0), e([h({\n  constructOnly: !0\n})], S.prototype, \"highlightGraphicUpdated\", void 0), e([h({\n  constructOnly: !0\n})], S.prototype, \"updatingHandles\", void 0), S = e([y(\"esri.views.layers.support.MapService\")], S);\nexport { S as MapServiceLayerViewHelper, _ as collectPopupProviders, P as isMapServiceLayerView };","map":{"version":3,"names":["_","e","t","r","s","i","has","getOrCreateMapValue","o","isSome","a","isNone","n","debounce","l","eachAlways","p","on","c","getMetersPerUnitForSR","u","property","h","subclass","y","m","getResolutionForScale","f","getLayerFloorFilterClause","d","calculateTolerance","g","identify","w","b","loadArcade","v","j","getRequiredFields","x","getFetchPopupTemplate","F","G","P","type","S","constructor","_featuresResolutions","WeakMap","highlightGraphics","highlightGraphicUpdated","updateHighlightedFeatures","destroyed","updatingHandles","addPromise","_updateHighlightedFeaturesGeometries","catch","initialize","_updateHighlightedFeaturesSymbols","_highlightGeometriesResolution","addHandles","added","onListenerAdd","fetchPopupFeatures","layerView","layer","view","scale","sublayers","length","R","capabilities","operations","supportsIdentify","version","_fetchPopupFeaturesUsingQueries","_fetchPopupFeaturesUsingIdentify","clearHighlights","removeAll","highlight","remove","isCollection","toArray","Array","isArray","filter","sourceLayer","geometryType","visible","addMany","removeMany","renderer","getSymbolAsync","then","visualVariables","find","getSize","shape","style","width","height","Math","max","size","includes","symbol","xoffset","yoffset","supportsQuery","_getTargetResolution","Map","get","set","getObjectId","from","createQuery","objectIds","keys","outFields","objectIdField","returnGeometry","maxAllowableOffset","outSpatialReference","spatialReference","queryFeatures","Promise","all","features","geometry","_createIdentifyParameters","results","parsedUrl","map","feature","floors","timeExtent","event","sublayer","load","min","allSublayers","reduce","createFetchPopupFeaturesQueryGeometry","round","xmin","center","ymin","xmax","ymax","gdbVersion","layerOption","mapExtent","tolerance","popupTemplate","clone","where","U","arcadeUtils","hasGeometryOperations","A","reverse","value","minScale","maxScale","forEach","popupEnabled","defaultPopupTemplateEnabled","unshift","expressionInfos","content","some","resolve","any","defaultSymbol","valueExpression","getSymbol","constructOnly","prototype","MapServiceLayerViewHelper","collectPopupProviders","isMapServiceLayerView"],"sources":["C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/node_modules/@arcgis/core/views/layers/support/MapServiceLayerViewHelper.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../Graphic.js\";import r from\"../../../core/Accessor.js\";import s from\"../../../core/Collection.js\";import i from\"../../../core/Error.js\";import has from\"../../../core/has.js\";import{getOrCreateMapValue as o}from\"../../../core/MapUtils.js\";import{isSome as a,isNone as n}from\"../../../core/maybe.js\";import{debounce as l,eachAlways as p}from\"../../../core/promiseUtils.js\";import{on as c}from\"../../../core/reactiveUtils.js\";import{getMetersPerUnitForSR as u}from\"../../../core/unitUtils.js\";import{property as h}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import{subclass as y}from\"../../../core/accessorSupport/decorators/subclass.js\";import m from\"../../../geometry/Extent.js\";import{getResolutionForScale as f}from\"../../../geometry/support/scaleUtils.js\";import{getLayerFloorFilterClause as d}from\"../../../layers/support/floorFilterUtils.js\";import{calculateTolerance as g}from\"../../../renderers/support/clickToleranceUtils.js\";import{identify as w}from\"../../../rest/identify.js\";import b from\"../../../rest/support/IdentifyParameters.js\";import{loadArcade as v}from\"../../../support/arcadeOnDemand.js\";import j from\"../../../symbols/SimpleMarkerSymbol.js\";import{getRequiredFields as x,getFetchPopupTemplate as F}from\"./popupUtils.js\";let G=null;function P(e,t){return\"tile\"===t.type||\"map-image\"===t.type}let S=class extends r{constructor(e){super(e),this._featuresResolutions=new WeakMap,this.highlightGraphics=null,this.highlightGraphicUpdated=null,this.updateHighlightedFeatures=l((async e=>{this.destroyed||this.updatingHandles.addPromise(this._updateHighlightedFeaturesGeometries(e).catch((()=>{})))}))}initialize(){const e=e=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(e).catch((()=>{}))),this.updateHighlightedFeatures(this._highlightGeometriesResolution)};this.addHandles([c((()=>this.highlightGraphics),\"change\",(t=>e(t.added)),{onListenerAdd:t=>e(t)})])}async fetchPopupFeatures(e,t){const{layerView:{layer:r,view:{scale:s}}}=this;if(!e)throw new i(\"fetchPopupFeatures:invalid-area\",\"Nothing to fetch without area\",{layer:r});const o=_(r.sublayers,s,t);if(!o.length)return[];const a=await R(r,o);if(!((r.capabilities?.operations?.supportsIdentify??!0)&&r.version>=10.5)&&!a)throw new i(\"fetchPopupFeatures:not-supported\",\"query operation is disabled for this service\",{layer:r});return a?this._fetchPopupFeaturesUsingQueries(e,o,t):this._fetchPopupFeaturesUsingIdentify(e,o,t)}clearHighlights(){this.highlightGraphics?.removeAll()}highlight(e){const r=this.highlightGraphics;if(!r)return{remove(){}};let i=null;if(e instanceof t?i=[e]:s.isCollection(e)&&e.length>0?i=e.toArray():Array.isArray(e)&&e.length>0&&(i=e),i=i?.filter(a),!i||!i.length)return{remove:()=>{}};for(const t of i){const e=t.sourceLayer;null!=e&&\"geometryType\"in e&&\"point\"===e.geometryType&&(t.visible=!1)}return r.addMany(i),{remove:()=>{r.removeMany(i??[])}}}async _updateHighlightedFeaturesSymbols(e){const{layerView:{view:t},highlightGraphics:r,highlightGraphicUpdated:s}=this;if(r&&s)for(const i of e){const e=i.sourceLayer&&\"renderer\"in i.sourceLayer&&i.sourceLayer.renderer;i.sourceLayer&&\"geometryType\"in i.sourceLayer&&\"point\"===i.sourceLayer.geometryType&&e&&\"getSymbolAsync\"in e&&e.getSymbolAsync(i).then((async o=>{o||(o=new j);let a=null;const n=\"visualVariables\"in e?e.visualVariables?.find((e=>\"size\"===e.type)):void 0;n&&(G||(G=(await import(\"../../../renderers/visualVariables/support/visualVariableUtils.js\")).getSize),a=G(n,i,{view:t.type,scale:t.scale,shape:\"simple-marker\"===o.type?o.style:null})),a||(a=\"width\"in o&&\"height\"in o&&null!=o.width&&null!=o.height?Math.max(o.width,o.height):\"size\"in o?o.size:16),r.includes(i)&&(i.symbol=new j({style:\"square\",size:a,xoffset:\"xoffset\"in o?o.xoffset:0,yoffset:\"yoffset\"in o?o.yoffset:0}),s(i,\"symbol\"),i.visible=!0)}))}}async _updateHighlightedFeaturesGeometries(e){const{layerView:{layer:t,view:r},highlightGraphics:s,highlightGraphicUpdated:i}=this;if(this._highlightGeometriesResolution=e,!i||!s?.length||!t.capabilities.operations.supportsQuery)return;const a=this._getTargetResolution(e),n=new Map;for(const c of s)if(!this._featuresResolutions.has(c)||this._featuresResolutions.get(c)>a){const e=c.sourceLayer;o(n,e,(()=>new Map)).set(c.getObjectId(),c)}const l=Array.from(n,(([e,t])=>{const s=e.createQuery();return s.objectIds=[...t.keys()],s.outFields=[e.objectIdField],s.returnGeometry=!0,s.maxAllowableOffset=a,s.outSpatialReference=r.spatialReference,e.queryFeatures(s)})),p=await Promise.all(l);if(!this.destroyed)for(const{features:o}of p)for(const e of o){const t=e.sourceLayer,r=n.get(t).get(e.getObjectId());r&&s.includes(r)&&(r.geometry=e.geometry,i(r,\"geometry\"),this._featuresResolutions.set(r,a))}}_getTargetResolution(e){const t=e*u(this.layerView.view.spatialReference),r=t/16;return r<=10?0:e/t*r}async _fetchPopupFeaturesUsingIdentify(e,t,r){const s=await this._createIdentifyParameters(e,t,r);if(n(s))return[];const{results:i}=await w(this.layerView.layer.parsedUrl,s);return i.map((e=>e.feature))}async _createIdentifyParameters(e,t,r){const{floors:s,layer:i,timeExtent:o,view:{spatialReference:n,scale:l}}=this.layerView,p=a(r)?r.event:null;if(!t.length)return null;await Promise.all(t.map((({sublayer:e})=>e.load().catch((()=>{})))));const c=Math.min(has(\"mapservice-popup-identify-max-tolerance\"),i.allSublayers.reduce(((e,t)=>t.renderer?g({renderer:t.renderer,event:p}):e),2)),u=this.createFetchPopupFeaturesQueryGeometry(e,c),h=f(l,n),y=Math.round(u.width/h),d=new m({xmin:u.center.x-h*y,ymin:u.center.y-h*y,xmax:u.center.x+h*y,ymax:u.center.y+h*y,spatialReference:u.spatialReference});return new b({floors:s,gdbVersion:\"gdbVersion\"in i?i.gdbVersion:void 0,geometry:e,height:y,layerOption:\"popup\",mapExtent:d,returnGeometry:!0,spatialReference:n,sublayers:i.sublayers,timeExtent:o,tolerance:c,width:y})}async _fetchPopupFeaturesUsingQueries(e,t,r){const{layerView:{floors:s,timeExtent:i}}=this,o=a(r)?r.event:null,n=t.map((async({sublayer:t,popupTemplate:r})=>{if(await t.load().catch((()=>{})),t.capabilities&&!t.capabilities.operations.supportsQuery)return[];const n=t.createQuery(),l=g({renderer:t.renderer,event:o}),p=this.createFetchPopupFeaturesQueryGeometry(e,l);if(n.geometry=p,n.outFields=await x(t,r),n.timeExtent=i,s){const e=s.clone(),r=d(e,t);a(r)&&(n.where=n.where?`(${n.where}) AND (${r})`:r)}const c=this._getTargetResolution(p.width/l),u=await U(r),h=\"point\"===t.geometryType||u&&u.arcadeUtils.hasGeometryOperations(r);h||(n.maxAllowableOffset=c);let{features:y}=await t.queryFeatures(n);const m=h?0:c;y=await A(t,y);for(const e of y)this._featuresResolutions.set(e,m);return y}));return(await p(n)).reverse().reduce(((e,t)=>t.value?[...e,...t.value]:e),[]).filter((e=>null!=e))}};function _(e,t,r){const s=[],i=e=>{const o=0===e.minScale||t<=e.minScale,n=0===e.maxScale||t>=e.maxScale;if(e.visible&&o&&n)if(e.sublayers)e.sublayers.forEach(i);else if(e.popupEnabled){const t=F(e,{...r,defaultPopupTemplateEnabled:!1});a(t)&&s.unshift({sublayer:e,popupTemplate:t})}};return(e?.toArray()??[]).reverse().map(i),s}function U(e){return e.expressionInfos?.length||Array.isArray(e.content)&&e.content.some((e=>\"expression\"===e.type))?v():Promise.resolve()}async function R(e,t){if(e.capabilities?.operations?.supportsQuery)return!0;try{return await Promise.any(t.map((({sublayer:e})=>e.load().then((()=>e.capabilities.operations.supportsQuery)))))}catch{return!1}}async function A(e,t){const r=e.renderer;return r&&\"defaultSymbol\"in r&&!r.defaultSymbol&&(t=r.valueExpression?await Promise.all(t.map((e=>r.getSymbolAsync(e).then((t=>t?e:null))))).then((e=>e.filter((e=>null!=e)))):t.filter((e=>null!=r.getSymbol(e)))),t}e([h({constructOnly:!0})],S.prototype,\"createFetchPopupFeaturesQueryGeometry\",void 0),e([h({constructOnly:!0})],S.prototype,\"layerView\",void 0),e([h({constructOnly:!0})],S.prototype,\"highlightGraphics\",void 0),e([h({constructOnly:!0})],S.prototype,\"highlightGraphicUpdated\",void 0),e([h({constructOnly:!0})],S.prototype,\"updatingHandles\",void 0),S=e([y(\"esri.views.layers.support.MapService\")],S);export{S as MapServiceLayerViewHelper,_ as collectPopupProviders,P as isMapServiceLayerView};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}