{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/CircularArray.js\";\nimport has from \"../../../../../core/has.js\";\nimport { isNone as t, isSome as s, unwrap as r } from \"../../../../../core/maybe.js\";\nimport { FeatureSetReaderJSON as i } from \"../support/FeatureSetReaderJSON.js\";\nimport { UpdateToken as d } from \"../support/UpdateToken.js\";\n\nclass a {\n  constructor(t, s) {\n    this.requests = {\n      done: new Array(),\n      stream: new e(10)\n    }, this._edits = null, this._abortController = new AbortController(), this._version = 0, this._done = !1, this.didSend = !1, this.tile = t, this._version = s;\n  }\n\n  get signal() {\n    return this._abortController.signal;\n  }\n\n  get options() {\n    return {\n      signal: this._abortController.signal\n    };\n  }\n\n  get empty() {\n    return !this.requests.done.length && t(this.edits);\n  }\n\n  get edits() {\n    return this._edits;\n  }\n\n  get done() {\n    return this._done;\n  }\n\n  end() {\n    this._done = !0;\n  }\n\n  clear() {\n    this.requests.done = [];\n  }\n\n  applyUpdate(e) {\n    this.requests.done.forEach(t => t.message.status.unset(e)), this._version = e.version, s(this._edits) && this._edits.status.unset(e);\n  }\n\n  add(e) {\n    e.message.status = e.message.status ?? d.empty(), e.message.status.version = this._version, has(\"esri-2d-update-debug\") && console.debug(this.tile.id, \"DataTileSubscription:add\", this._version), e.message.end && this.requests.done.forEach(e => {\n      s(e.message) && e.message.end && (e.message.end = !1);\n    }), this.requests.done.push(e);\n  }\n\n  edit(e, a) {\n    const o = e.getQuantizationTransform(),\n          n = e.fullSchema(),\n          h = Array.from(e.features()).filter(s),\n          u = [...a, ...h.map(e => e.objectId)];\n    if (this.removeIds(u), this._invalidate(), t(this._edits)) return void (this._edits = {\n      type: \"append\",\n      addOrUpdate: i.fromOptimizedFeatures(h, n, r(o)),\n      id: this.tile.id,\n      status: d.empty(),\n      end: !0\n    });\n    this.requests.done.forEach(e => e.message.end = !1);\n    r(this._edits.addOrUpdate).append(e.features());\n  }\n\n  *readers() {\n    for (const {\n      message: e\n    } of this.requests.done) s(e.addOrUpdate) && (yield e.addOrUpdate);\n\n    s(this._edits) && s(this._edits.addOrUpdate) && (yield this._edits.addOrUpdate);\n  }\n\n  _invalidate() {\n    for (const e of this.requests.done) e.message.status = d.empty();\n\n    s(this._edits) && (this._edits.status = d.empty());\n  }\n\n  removeIds(e) {\n    this._invalidate();\n\n    for (const {\n      message: t\n    } of this.requests.done) {\n      const r = t.addOrUpdate;\n      s(r) && (r.removeIds(e), r.isEmpty && (has(\"esri-2d-update-debug\") && console.debug(\"Removing FeatureSetReader\"), t.addOrUpdate = null));\n    }\n\n    s(this._edits) && s(this._edits.addOrUpdate) && this._edits.addOrUpdate.removeIds(e), this.requests.done = this.requests.done.filter(e => e.message.addOrUpdate || e.message.end);\n  }\n\n  abort() {\n    this._abortController.abort();\n  }\n\n}\n\nexport { a as DataTileSubscription };","map":{"version":3,"names":["e","has","isNone","t","isSome","s","unwrap","r","FeatureSetReaderJSON","i","UpdateToken","d","a","constructor","requests","done","Array","stream","_edits","_abortController","AbortController","_version","_done","didSend","tile","signal","options","empty","length","edits","end","clear","applyUpdate","forEach","message","status","unset","version","add","console","debug","id","push","edit","o","getQuantizationTransform","n","fullSchema","h","from","features","filter","u","map","objectId","removeIds","_invalidate","type","addOrUpdate","fromOptimizedFeatures","append","readers","isEmpty","abort","DataTileSubscription"],"sources":["C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/node_modules/@arcgis/core/views/2d/layers/features/sources/DataTileSubscription.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/CircularArray.js\";import has from\"../../../../../core/has.js\";import{isNone as t,isSome as s,unwrap as r}from\"../../../../../core/maybe.js\";import{FeatureSetReaderJSON as i}from\"../support/FeatureSetReaderJSON.js\";import{UpdateToken as d}from\"../support/UpdateToken.js\";class a{constructor(t,s){this.requests={done:new Array,stream:new e(10)},this._edits=null,this._abortController=new AbortController,this._version=0,this._done=!1,this.didSend=!1,this.tile=t,this._version=s}get signal(){return this._abortController.signal}get options(){return{signal:this._abortController.signal}}get empty(){return!this.requests.done.length&&t(this.edits)}get edits(){return this._edits}get done(){return this._done}end(){this._done=!0}clear(){this.requests.done=[]}applyUpdate(e){this.requests.done.forEach((t=>t.message.status.unset(e))),this._version=e.version,s(this._edits)&&this._edits.status.unset(e)}add(e){e.message.status=e.message.status??d.empty(),e.message.status.version=this._version,has(\"esri-2d-update-debug\")&&console.debug(this.tile.id,\"DataTileSubscription:add\",this._version),e.message.end&&this.requests.done.forEach((e=>{s(e.message)&&e.message.end&&(e.message.end=!1)})),this.requests.done.push(e)}edit(e,a){const o=e.getQuantizationTransform(),n=e.fullSchema(),h=Array.from(e.features()).filter(s),u=[...a,...h.map((e=>e.objectId))];if(this.removeIds(u),this._invalidate(),t(this._edits))return void(this._edits={type:\"append\",addOrUpdate:i.fromOptimizedFeatures(h,n,r(o)),id:this.tile.id,status:d.empty(),end:!0});this.requests.done.forEach((e=>e.message.end=!1));r(this._edits.addOrUpdate).append(e.features())}*readers(){for(const{message:e}of this.requests.done)s(e.addOrUpdate)&&(yield e.addOrUpdate);s(this._edits)&&s(this._edits.addOrUpdate)&&(yield this._edits.addOrUpdate)}_invalidate(){for(const e of this.requests.done)e.message.status=d.empty();s(this._edits)&&(this._edits.status=d.empty())}removeIds(e){this._invalidate();for(const{message:t}of this.requests.done){const r=t.addOrUpdate;s(r)&&(r.removeIds(e),r.isEmpty&&(has(\"esri-2d-update-debug\")&&console.debug(\"Removing FeatureSetReader\"),t.addOrUpdate=null))}s(this._edits)&&s(this._edits.addOrUpdate)&&this._edits.addOrUpdate.removeIds(e),this.requests.done=this.requests.done.filter((e=>e.message.addOrUpdate||e.message.end))}abort(){this._abortController.abort()}}export{a as DataTileSubscription};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}