{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/ClientApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../Graphic.js\";\nimport { clone as i } from \"../../../core/lang.js\";\nimport s from \"../../../core/Logger.js\";\nimport { isNone as r, destroyMaybe as a } from \"../../../core/maybe.js\";\nimport { isAbortError as l } from \"../../../core/promiseUtils.js\";\nimport { watch as n, initial as o } from \"../../../core/reactiveUtils.js\";\nimport { property as h } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as u } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { diff as c, hasDiff as y } from \"../../../core/accessorSupport/diffUtils.js\";\nimport { create as p } from \"../../../geometry/support/aaBoundingRect.js\";\nimport { equals as d } from \"../../../geometry/support/spatialReferenceUtils.js\";\nimport { StyleUpdateType as _ } from \"../engine/vectorTiles/enums.js\";\nimport { TileHandler as f } from \"../engine/vectorTiles/TileHandler.js\";\nimport { TileManager as g } from \"../engine/vectorTiles/TileManager.js\";\nimport { VectorTile as m } from \"../engine/vectorTiles/VectorTile.js\";\nimport { VectorTileContainer as C } from \"../engine/vectorTiles/VectorTileContainer.js\";\nimport { StyleLayerType as T } from \"../engine/vectorTiles/style/StyleDefinition.js\";\nimport v from \"../engine/vectorTiles/style/StyleRepository.js\";\nimport { LayerView2DMixin as R } from \"./LayerView2D.js\";\nimport H from \"./support/DebugOverlay.js\";\nimport w from \"../tiling/TileInfoViewPOT.js\";\nimport S from \"../tiling/TileQueue.js\";\nimport D from \"../../layers/LayerView.js\";\nlet Q = class extends R(D) {\n  constructor() {\n    super(...arguments), this._styleChanges = [], this._fetchQueue = null, this._parseQueue = null, this._tileHandlerPromise = null, this._isTileHandlerReady = !1, this._collisionOverlay = null, this.fading = !1, this._getCollidersMesh = e => {\n      const {\n        pixelRatio: t\n      } = e.state;\n      let i = 0;\n      const s = [],\n            r = [];\n\n      for (const a of this._vectorTileContainer.children) if (a.symbols) for (const [e, l] of a.symbols) for (const a of l) for (const e of a.colliders) {\n        const l = (e.xScreen + e.dxScreen) * t,\n              n = (e.yScreen + e.dyScreen) * t,\n              o = e.width * t,\n              h = e.height * t,\n              u = a.unique.parts[e.partIndex].targetOpacity > .5;\n        if (!u && \"all\" !== this.layer.showCollisionBoxes) continue;\n\n        const c = 3,\n              y = 1,\n              p = 3,\n              d = 0,\n              _ = u ? 2 : 0,\n              f = u ? 3 : 0,\n              g = H.makeFlags(_, f);\n\n        s.push(l, n, g, l + o, n, g, l, n + h, g, l + o, n + h, g), r.push(i + 0, i + 1, i + 2, i + 1, i + 3, i + 2), i += 4;\n        const m = u ? c : y,\n              C = u ? p : d,\n              T = H.makeFlags(m, C);\n        s.push(l, n, T, l + o, n, T, l, n + 1, T, l + o, n + 1, T), r.push(i + 0, i + 1, i + 2, i + 1, i + 3, i + 2), i += 4, s.push(l, n + h - 1, T, l + o, n + h - 1, T, l, n + h, T, l + o, n + h, T), r.push(i + 0, i + 1, i + 2, i + 1, i + 3, i + 2), i += 4, s.push(l, n, T, l + 1, n, T, l, n + h, T, l + 1, n + h, T), r.push(i + 0, i + 1, i + 2, i + 1, i + 3, i + 2), i += 4, s.push(l + o - 1, n, T, l + o, n, T, l + o - 1, n + h, T, l + o, n + h, T), r.push(i + 0, i + 1, i + 2, i + 1, i + 3, i + 2), i += 4;\n      }\n\n      return {\n        vertexData: new Int16Array(s),\n        indexData: new Uint32Array(r)\n      };\n    }, this._getCollidersColors = () => [1, .5, 0, 1, 1, 0, 0, 1, 0, 1, .5, 1, 0, .5, 0, 1], this._getCollidersOpacities = () => [.05, .01, .15, .2];\n  }\n\n  hitTest(e, i) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      if (!_this._tileHandlerPromise) return null;\n      yield _this._tileHandlerPromise;\n      const s = yield _this._vectorTileContainer.hitTest(i);\n      if (!s || 0 === s.length) return null;\n      const r = s[0] - 1,\n            a = _this._styleRepository,\n            l = a.getStyleLayerByUID(r);\n      if (!l) return null;\n      const n = a.getStyleLayerIndex(l.id);\n      return [{\n        type: \"graphic\",\n        mapPoint: e,\n        layer: _this.layer,\n        graphic: new t({\n          attributes: {\n            layerId: n,\n            layerName: l.id,\n            layerUID: r\n          },\n          layer: _this.layer,\n          sourceLayer: _this.layer\n        })\n      }];\n    })();\n  }\n\n  update(e) {\n    if (this._tileHandlerPromise && this._isTileHandlerReady) return e.pixelRatio !== this._tileHandler.devicePixelRatio ? (this._start(), void (this._tileHandler.devicePixelRatio = e.pixelRatio)) : void (this._styleChanges.length > 0 ? this._tileHandlerPromise = this._applyStyleChanges() : (this._fetchQueue.pause(), this._parseQueue.pause(), this._fetchQueue.state = e.state, this._parseQueue.state = e.state, this._tileManager.update(e) || this.requestUpdate(), this._parseQueue.resume(), this._fetchQueue.resume()));\n  }\n\n  attach() {\n    const {\n      style: e\n    } = this.layer.currentStyleInfo;\n    this._styleRepository = new v(e), this._tileInfoView = new w(this.layer.tileInfo, this.layer.fullExtent), this._vectorTileContainer = new C(this._tileInfoView), this._tileHandler = new f(this.layer, this._styleRepository, window.devicePixelRatio || 1), this.container.addChild(this._vectorTileContainer), this._start(), this.addAttachHandles([this._vectorTileContainer.on(\"fade-start\", () => {\n      this.fading = !0, this.notifyChange(\"updating\"), this.requestUpdate();\n    }), this._vectorTileContainer.on(\"fade-complete\", () => {\n      this._collisionOverlay?.requestRender(), this.fading = !1, this.notifyChange(\"updating\"), this.requestUpdate();\n    }), n(() => this.layer.showCollisionBoxes, e => {\n      \"none\" !== e ? this._collisionOverlay || (this._collisionOverlay = new H({\n        getMesh: this._getCollidersMesh,\n        getColors: this._getCollidersColors,\n        getOpacities: this._getCollidersOpacities\n      }), this.container.addChild(this._collisionOverlay)) : this._collisionOverlay && (this.container.removeChild(this._collisionOverlay), this._collisionOverlay = null), this.container.requestRender();\n    }, o), this.layer.on(\"paint-change\", e => {\n      if (e.isDataDriven) this._styleChanges.push({\n        type: _.PAINTER_CHANGED,\n        data: e\n      }), this.notifyChange(\"updating\"), this.requestUpdate();else {\n        const t = this._styleRepository,\n              i = t.getLayerById(e.layer);\n        if (!i) return;\n        const s = i.type === T.SYMBOL;\n        t.setPaintProperties(e.layer, e.paint), s && this._vectorTileContainer.restartDeclutter(), this._vectorTileContainer.requestRender();\n      }\n    }), this.layer.on(\"layout-change\", e => {\n      const t = this._styleRepository,\n            i = t.getLayerById(e.layer);\n      if (!i) return;\n      const s = c(i.layout, e.layout);\n\n      if (!r(s)) {\n        if (y(s, \"visibility\") && 1 === L(s)) return t.setLayoutProperties(e.layer, e.layout), i.type === T.SYMBOL && this._vectorTileContainer.restartDeclutter(), void this._vectorTileContainer.requestRender();\n        this._styleChanges.push({\n          type: _.LAYOUT_CHANGED,\n          data: e\n        }), this.notifyChange(\"updating\"), this.requestUpdate();\n      }\n    }), this.layer.on(\"style-layer-visibility-change\", e => {\n      const t = this._styleRepository,\n            i = t.getLayerById(e.layer);\n      i && (t.setStyleLayerVisibility(e.layer, e.visibility), i.type === T.SYMBOL && this._vectorTileContainer.restartDeclutter(), this._vectorTileContainer.requestRender());\n    }), this.layer.on(\"style-layer-change\", e => {\n      this._styleChanges.push({\n        type: _.LAYER_CHANGED,\n        data: e\n      }), this.notifyChange(\"updating\"), this.requestUpdate();\n    }), this.layer.on(\"delete-style-layer\", e => {\n      this._styleChanges.push({\n        type: _.LAYER_REMOVED,\n        data: e\n      }), this.notifyChange(\"updating\"), this.requestUpdate();\n    }), this.layer.on(\"load-style\", () => this._loadStyle()), this.layer.on(\"spriteSource-change\", e => {\n      this._newSpriteSource = e.spriteSource, this._styleChanges.push({\n        type: _.SPRITES_CHANGED,\n        data: null\n      });\n      const t = this._styleRepository.layers;\n\n      for (const i of t) switch (i.type) {\n        case T.SYMBOL:\n          i.getLayoutProperty(\"icon-image\") && this._styleChanges.push({\n            type: _.LAYOUT_CHANGED,\n            data: {\n              layer: i.id,\n              layout: i.layout\n            }\n          });\n          break;\n\n        case T.LINE:\n          i.getPaintProperty(\"line-pattern\") && this._styleChanges.push({\n            type: _.PAINTER_CHANGED,\n            data: {\n              layer: i.id,\n              paint: i.paint,\n              isDataDriven: i.isPainterDataDriven()\n            }\n          });\n          break;\n\n        case T.FILL:\n          i.getLayoutProperty(\"fill-pattern\") && this._styleChanges.push({\n            type: _.PAINTER_CHANGED,\n            data: {\n              layer: i.id,\n              paint: i.paint,\n              isDataDriven: i.isPainterDataDriven()\n            }\n          });\n      }\n\n      this.notifyChange(\"updating\"), this.requestUpdate();\n    })]);\n  }\n\n  detach() {\n    this._stop(), this.container.removeAllChildren(), this._vectorTileContainer = a(this._vectorTileContainer), this._tileHandler = a(this._tileHandler);\n  }\n\n  moveStart() {\n    this.requestUpdate();\n  }\n\n  viewChange() {\n    this.requestUpdate();\n  }\n\n  moveEnd() {\n    this._collisionOverlay && this._vectorTileContainer.restartDeclutter(), this.requestUpdate();\n  }\n\n  supportsSpatialReference(e) {\n    return d(this.layer.tileInfo?.spatialReference, e);\n  }\n\n  canResume() {\n    let e = super.canResume();\n    const {\n      currentStyleInfo: t\n    } = this.layer;\n\n    if (e && t?.layerDefinition) {\n      const i = this.view.scale,\n            {\n        minScale: s,\n        maxScale: r\n      } = t.layerDefinition;\n      t && t.layerDefinition && (s && s < i && (e = !1), r && r > i && (e = !1));\n    }\n\n    return e;\n  }\n\n  isUpdating() {\n    const e = this._vectorTileContainer.children;\n    return !this._isTileHandlerReady || !this._fetchQueue || !this._parseQueue || this._fetchQueue.updating || this._parseQueue.updating || e.length > 0 && e.some(e => e.invalidating) || this.fading;\n  }\n\n  acquireTile(e) {\n    const t = this._createVectorTile(e);\n\n    return this._tileHandlerPromise?.then(() => {\n      this._fetchQueue.push(t.key).then(e => this._parseQueue.push({\n        key: t.key,\n        data: e\n      })).then(e => {\n        t.once(\"attach\", () => this.requestUpdate()), t.setData(e), this.requestUpdate(), this.notifyChange(\"updating\");\n      }).catch(e => {\n        this.notifyChange(\"updating\"), l(e) || s.getLogger(this.declaredClass).error(e);\n      });\n    }), t;\n  }\n\n  releaseTile(e) {\n    const t = e.key.id;\n    this._fetchQueue.abort(t), this._parseQueue.abort(t), this.requestUpdate();\n  }\n\n  _start() {\n    if (this._stop(), this._tileManager = new g({\n      acquireTile: e => this.acquireTile(e),\n      releaseTile: e => this.releaseTile(e),\n      tileInfoView: this._tileInfoView\n    }, this._vectorTileContainer), !this.layer.currentStyleInfo) return;\n\n    const e = new AbortController(),\n          t = this._tileHandler.start({\n      signal: e.signal\n    }).then(() => {\n      this._fetchQueue = new S({\n        tileInfoView: this._tileInfoView,\n        process: (e, t) => this._getTileData(e, t),\n        concurrency: 15\n      }), this._parseQueue = new S({\n        tileInfoView: this._tileInfoView,\n        process: (e, t) => this._parseTileData(e, t),\n        concurrency: 8\n      }), this.requestUpdate(), this._isTileHandlerReady = !0;\n    });\n\n    this._tileHandler.spriteMosaic.then(e => {\n      this._vectorTileContainer.setStyleResources(e, this._tileHandler.glyphMosaic, this._styleRepository), this.requestUpdate();\n    }), this._tileHandlerAbortController = e, this._tileHandlerPromise = t;\n  }\n\n  _stop() {\n    if (!this._tileHandlerAbortController || !this._vectorTileContainer) return;\n    const e = this._tileHandlerAbortController;\n    e && e.abort(), this._tileHandlerPromise = null, this._isTileHandlerReady = !1, this._fetchQueue = a(this._fetchQueue), this._parseQueue = a(this._parseQueue), this._tileManager = a(this._tileManager), this._vectorTileContainer.removeAllChildren();\n  }\n\n  _getTileData(e, t) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      const i = yield _this2._tileHandler.fetchTileData(e, t);\n      return _this2.notifyChange(\"updating\"), i;\n    })();\n  }\n\n  _parseTileData(e, t) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      return _this3._tileHandler.parseTileData(e, t);\n    })();\n  }\n\n  _applyStyleChanges() {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      _this4._isTileHandlerReady = !1, _this4._fetchQueue.pause(), _this4._parseQueue.pause(), _this4._fetchQueue.clear(), _this4._parseQueue.clear(), _this4._tileManager.clearCache();\n      const e = _this4._styleChanges;\n\n      try {\n        yield _this4._tileHandler.updateStyle(e);\n      } catch (n) {\n        s.getLogger(_this4.declaredClass).error(\"error applying vector-tiles style update\", n.message), _this4._fetchQueue.resume(), _this4._parseQueue.resume(), _this4._isTileHandlerReady = !0;\n      }\n\n      const t = _this4._styleRepository,\n            i = [];\n      e.forEach(e => {\n        if (e.type !== _.LAYER_REMOVED) return;\n        const s = e.data,\n              r = t.getLayerById(s.layer);\n        r && i.push(r.uid);\n      });\n      const r = [];\n      let a;\n      e.forEach(e => {\n        const i = e.type,\n              s = e.data;\n\n        switch (i) {\n          case _.PAINTER_CHANGED:\n            t.setPaintProperties(s.layer, s.paint), a = s.layer;\n            break;\n\n          case _.LAYOUT_CHANGED:\n            t.setLayoutProperties(s.layer, s.layout), a = s.layer;\n            break;\n\n          case _.LAYER_REMOVED:\n            return void t.deleteStyleLayer(s.layer);\n\n          case _.LAYER_CHANGED:\n            t.setStyleLayer(s.layer, s.index), a = s.layer.id;\n            break;\n\n          case _.SPRITES_CHANGED:\n            _this4._vectorTileContainer.setSpriteMosaic(_this4._tileHandler.setSpriteSource(_this4._newSpriteSource)), _this4._newSpriteSource = null, a = null;\n        }\n\n        const l = t.getLayerById(a);\n        l && r.push(l.uid);\n      });\n      const l = _this4._vectorTileContainer.children;\n\n      if (i.length > 0) {\n        _this4._vectorTileContainer.deleteStyleLayers(i);\n\n        for (const e of l) e.deleteLayerData(i);\n      }\n\n      if (_this4._fetchQueue.resume(), _this4._parseQueue.resume(), r.length > 0) {\n        const e = [];\n\n        for (const t of l) {\n          const i = _this4._fetchQueue.push(t.key).then(e => _this4._parseQueue.push({\n            key: t.key,\n            data: e,\n            styleLayerUIDs: r\n          })).then(e => t.setData(e));\n\n          e.push(i);\n        }\n\n        yield Promise.all(e);\n      }\n\n      _this4._styleChanges = [], _this4._isTileHandlerReady = !0, _this4.notifyChange(\"updating\"), _this4.requestUpdate();\n    })();\n  }\n\n  _loadStyle() {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      const {\n        style: e\n      } = _this5.layer.currentStyleInfo,\n            t = i(e);\n      _this5._isTileHandlerReady = !1, _this5._fetchQueue.pause(), _this5._parseQueue.pause(), _this5._fetchQueue.clear(), _this5._parseQueue.clear(), _this5.notifyChange(\"updating\"), _this5._styleRepository = new v(t), _this5._vectorTileContainer.destroy(), _this5._tileManager.clear(), _this5._tileHandlerAbortController.abort(), _this5._tileHandlerAbortController = new AbortController();\n      const {\n        signal: s\n      } = _this5._tileHandlerAbortController;\n\n      try {\n        _this5._tileHandlerPromise = _this5._tileHandler.setStyle(_this5._styleRepository, t), yield _this5._tileHandlerPromise;\n      } catch (a) {\n        if (!l(a)) throw a;\n      }\n\n      if (s.aborted) return _this5._fetchQueue.resume(), _this5._parseQueue.resume(), _this5._isTileHandlerReady = !0, _this5.notifyChange(\"updating\"), void _this5.requestUpdate();\n      const r = yield _this5._tileHandler.spriteMosaic;\n      _this5._vectorTileContainer.setStyleResources(r, _this5._tileHandler.glyphMosaic, _this5._styleRepository), _this5._fetchQueue.resume(), _this5._parseQueue.resume(), _this5._isTileHandlerReady = !0, _this5.notifyChange(\"updating\"), _this5.requestUpdate();\n    })();\n  }\n\n  _createVectorTile(e) {\n    const t = this._tileInfoView.getTileBounds(p(), e),\n          i = this._tileInfoView.getTileResolution(e.level);\n\n    return new m(e, i, t[0], t[3], 512, 512, this._styleRepository);\n  }\n\n};\n\nfunction L(e) {\n  if (r(e)) return 0;\n\n  switch (e.type) {\n    case \"partial\":\n      return Object.keys(e.diff).length;\n\n    case \"complete\":\n      return Math.max(Object.keys(e.oldValue).length, Object.keys(e.newValue).length);\n\n    case \"collection\":\n      return Object.keys(e.added).length + Object.keys(e.changed).length + Object.keys(e.removed).length;\n  }\n}\n\ne([h()], Q.prototype, \"_fetchQueue\", void 0), e([h()], Q.prototype, \"_parseQueue\", void 0), e([h()], Q.prototype, \"_isTileHandlerReady\", void 0), e([h()], Q.prototype, \"fading\", void 0), Q = e([u(\"esri.views.2d.layers.VectorTileLayerView2D\")], Q);\nconst I = Q;\nexport { I as default };","map":{"version":3,"names":["_","e","t","clone","i","s","isNone","r","destroyMaybe","a","isAbortError","l","watch","n","initial","o","property","h","subclass","u","diff","c","hasDiff","y","create","p","equals","d","StyleUpdateType","TileHandler","f","TileManager","g","VectorTile","m","VectorTileContainer","C","StyleLayerType","T","v","LayerView2DMixin","R","H","w","S","D","Q","constructor","arguments","_styleChanges","_fetchQueue","_parseQueue","_tileHandlerPromise","_isTileHandlerReady","_collisionOverlay","fading","_getCollidersMesh","pixelRatio","state","_vectorTileContainer","children","symbols","colliders","xScreen","dxScreen","yScreen","dyScreen","width","height","unique","parts","partIndex","targetOpacity","layer","showCollisionBoxes","makeFlags","push","vertexData","Int16Array","indexData","Uint32Array","_getCollidersColors","_getCollidersOpacities","hitTest","length","_styleRepository","getStyleLayerByUID","getStyleLayerIndex","id","type","mapPoint","graphic","attributes","layerId","layerName","layerUID","sourceLayer","update","_tileHandler","devicePixelRatio","_start","_applyStyleChanges","pause","_tileManager","requestUpdate","resume","attach","style","currentStyleInfo","_tileInfoView","tileInfo","fullExtent","window","container","addChild","addAttachHandles","on","notifyChange","requestRender","getMesh","getColors","getOpacities","removeChild","isDataDriven","PAINTER_CHANGED","data","getLayerById","SYMBOL","setPaintProperties","paint","restartDeclutter","layout","L","setLayoutProperties","LAYOUT_CHANGED","setStyleLayerVisibility","visibility","LAYER_CHANGED","LAYER_REMOVED","_loadStyle","_newSpriteSource","spriteSource","SPRITES_CHANGED","layers","getLayoutProperty","LINE","getPaintProperty","isPainterDataDriven","FILL","detach","_stop","removeAllChildren","moveStart","viewChange","moveEnd","supportsSpatialReference","spatialReference","canResume","layerDefinition","view","scale","minScale","maxScale","isUpdating","updating","some","invalidating","acquireTile","_createVectorTile","then","key","once","setData","catch","getLogger","declaredClass","error","releaseTile","abort","tileInfoView","AbortController","start","signal","process","_getTileData","concurrency","_parseTileData","spriteMosaic","setStyleResources","glyphMosaic","_tileHandlerAbortController","fetchTileData","parseTileData","clear","clearCache","updateStyle","message","forEach","uid","deleteStyleLayer","setStyleLayer","index","setSpriteMosaic","setSpriteSource","deleteStyleLayers","deleteLayerData","styleLayerUIDs","Promise","all","destroy","setStyle","aborted","getTileBounds","getTileResolution","level","Object","keys","Math","max","oldValue","newValue","added","changed","removed","prototype","I","default"],"sources":["C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/node_modules/@arcgis/core/views/2d/layers/VectorTileLayerView2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../Graphic.js\";import{clone as i}from\"../../../core/lang.js\";import s from\"../../../core/Logger.js\";import{isNone as r,destroyMaybe as a}from\"../../../core/maybe.js\";import{isAbortError as l}from\"../../../core/promiseUtils.js\";import{watch as n,initial as o}from\"../../../core/reactiveUtils.js\";import{property as h}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as u}from\"../../../core/accessorSupport/decorators/subclass.js\";import{diff as c,hasDiff as y}from\"../../../core/accessorSupport/diffUtils.js\";import{create as p}from\"../../../geometry/support/aaBoundingRect.js\";import{equals as d}from\"../../../geometry/support/spatialReferenceUtils.js\";import{StyleUpdateType as _}from\"../engine/vectorTiles/enums.js\";import{TileHandler as f}from\"../engine/vectorTiles/TileHandler.js\";import{TileManager as g}from\"../engine/vectorTiles/TileManager.js\";import{VectorTile as m}from\"../engine/vectorTiles/VectorTile.js\";import{VectorTileContainer as C}from\"../engine/vectorTiles/VectorTileContainer.js\";import{StyleLayerType as T}from\"../engine/vectorTiles/style/StyleDefinition.js\";import v from\"../engine/vectorTiles/style/StyleRepository.js\";import{LayerView2DMixin as R}from\"./LayerView2D.js\";import H from\"./support/DebugOverlay.js\";import w from\"../tiling/TileInfoViewPOT.js\";import S from\"../tiling/TileQueue.js\";import D from\"../../layers/LayerView.js\";let Q=class extends(R(D)){constructor(){super(...arguments),this._styleChanges=[],this._fetchQueue=null,this._parseQueue=null,this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._collisionOverlay=null,this.fading=!1,this._getCollidersMesh=e=>{const{pixelRatio:t}=e.state;let i=0;const s=[],r=[];for(const a of this._vectorTileContainer.children)if(a.symbols)for(const[e,l]of a.symbols)for(const a of l)for(const e of a.colliders){const l=(e.xScreen+e.dxScreen)*t,n=(e.yScreen+e.dyScreen)*t,o=e.width*t,h=e.height*t,u=a.unique.parts[e.partIndex].targetOpacity>.5;if(!u&&\"all\"!==this.layer.showCollisionBoxes)continue;const c=3,y=1,p=3,d=0,_=u?2:0,f=u?3:0,g=H.makeFlags(_,f);s.push(l,n,g,l+o,n,g,l,n+h,g,l+o,n+h,g),r.push(i+0,i+1,i+2,i+1,i+3,i+2),i+=4;const m=u?c:y,C=u?p:d,T=H.makeFlags(m,C);s.push(l,n,T,l+o,n,T,l,n+1,T,l+o,n+1,T),r.push(i+0,i+1,i+2,i+1,i+3,i+2),i+=4,s.push(l,n+h-1,T,l+o,n+h-1,T,l,n+h,T,l+o,n+h,T),r.push(i+0,i+1,i+2,i+1,i+3,i+2),i+=4,s.push(l,n,T,l+1,n,T,l,n+h,T,l+1,n+h,T),r.push(i+0,i+1,i+2,i+1,i+3,i+2),i+=4,s.push(l+o-1,n,T,l+o,n,T,l+o-1,n+h,T,l+o,n+h,T),r.push(i+0,i+1,i+2,i+1,i+3,i+2),i+=4}return{vertexData:new Int16Array(s),indexData:new Uint32Array(r)}},this._getCollidersColors=()=>[1,.5,0,1,1,0,0,1,0,1,.5,1,0,.5,0,1],this._getCollidersOpacities=()=>[.05,.01,.15,.2]}async hitTest(e,i){if(!this._tileHandlerPromise)return null;await this._tileHandlerPromise;const s=await this._vectorTileContainer.hitTest(i);if(!s||0===s.length)return null;const r=s[0]-1,a=this._styleRepository,l=a.getStyleLayerByUID(r);if(!l)return null;const n=a.getStyleLayerIndex(l.id);return[{type:\"graphic\",mapPoint:e,layer:this.layer,graphic:new t({attributes:{layerId:n,layerName:l.id,layerUID:r},layer:this.layer,sourceLayer:this.layer})}]}update(e){if(this._tileHandlerPromise&&this._isTileHandlerReady)return e.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),void(this._tileHandler.devicePixelRatio=e.pixelRatio)):void(this._styleChanges.length>0?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=e.state,this._parseQueue.state=e.state,this._tileManager.update(e)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))}attach(){const{style:e}=this.layer.currentStyleInfo;this._styleRepository=new v(e),this._tileInfoView=new w(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new C(this._tileInfoView),this._tileHandler=new f(this.layer,this._styleRepository,window.devicePixelRatio||1),this.container.addChild(this._vectorTileContainer),this._start(),this.addAttachHandles([this._vectorTileContainer.on(\"fade-start\",(()=>{this.fading=!0,this.notifyChange(\"updating\"),this.requestUpdate()})),this._vectorTileContainer.on(\"fade-complete\",(()=>{this._collisionOverlay?.requestRender(),this.fading=!1,this.notifyChange(\"updating\"),this.requestUpdate()})),n((()=>this.layer.showCollisionBoxes),(e=>{\"none\"!==e?this._collisionOverlay||(this._collisionOverlay=new H({getMesh:this._getCollidersMesh,getColors:this._getCollidersColors,getOpacities:this._getCollidersOpacities}),this.container.addChild(this._collisionOverlay)):this._collisionOverlay&&(this.container.removeChild(this._collisionOverlay),this._collisionOverlay=null),this.container.requestRender()}),o),this.layer.on(\"paint-change\",(e=>{if(e.isDataDriven)this._styleChanges.push({type:_.PAINTER_CHANGED,data:e}),this.notifyChange(\"updating\"),this.requestUpdate();else{const t=this._styleRepository,i=t.getLayerById(e.layer);if(!i)return;const s=i.type===T.SYMBOL;t.setPaintProperties(e.layer,e.paint),s&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender()}})),this.layer.on(\"layout-change\",(e=>{const t=this._styleRepository,i=t.getLayerById(e.layer);if(!i)return;const s=c(i.layout,e.layout);if(!r(s)){if(y(s,\"visibility\")&&1===L(s))return t.setLayoutProperties(e.layer,e.layout),i.type===T.SYMBOL&&this._vectorTileContainer.restartDeclutter(),void this._vectorTileContainer.requestRender();this._styleChanges.push({type:_.LAYOUT_CHANGED,data:e}),this.notifyChange(\"updating\"),this.requestUpdate()}})),this.layer.on(\"style-layer-visibility-change\",(e=>{const t=this._styleRepository,i=t.getLayerById(e.layer);i&&(t.setStyleLayerVisibility(e.layer,e.visibility),i.type===T.SYMBOL&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender())})),this.layer.on(\"style-layer-change\",(e=>{this._styleChanges.push({type:_.LAYER_CHANGED,data:e}),this.notifyChange(\"updating\"),this.requestUpdate()})),this.layer.on(\"delete-style-layer\",(e=>{this._styleChanges.push({type:_.LAYER_REMOVED,data:e}),this.notifyChange(\"updating\"),this.requestUpdate()})),this.layer.on(\"load-style\",(()=>this._loadStyle())),this.layer.on(\"spriteSource-change\",(e=>{this._newSpriteSource=e.spriteSource,this._styleChanges.push({type:_.SPRITES_CHANGED,data:null});const t=this._styleRepository.layers;for(const i of t)switch(i.type){case T.SYMBOL:i.getLayoutProperty(\"icon-image\")&&this._styleChanges.push({type:_.LAYOUT_CHANGED,data:{layer:i.id,layout:i.layout}});break;case T.LINE:i.getPaintProperty(\"line-pattern\")&&this._styleChanges.push({type:_.PAINTER_CHANGED,data:{layer:i.id,paint:i.paint,isDataDriven:i.isPainterDataDriven()}});break;case T.FILL:i.getLayoutProperty(\"fill-pattern\")&&this._styleChanges.push({type:_.PAINTER_CHANGED,data:{layer:i.id,paint:i.paint,isDataDriven:i.isPainterDataDriven()}})}this.notifyChange(\"updating\"),this.requestUpdate()}))])}detach(){this._stop(),this.container.removeAllChildren(),this._vectorTileContainer=a(this._vectorTileContainer),this._tileHandler=a(this._tileHandler)}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this._collisionOverlay&&this._vectorTileContainer.restartDeclutter(),this.requestUpdate()}supportsSpatialReference(e){return d(this.layer.tileInfo?.spatialReference,e)}canResume(){let e=super.canResume();const{currentStyleInfo:t}=this.layer;if(e&&t?.layerDefinition){const i=this.view.scale,{minScale:s,maxScale:r}=t.layerDefinition;t&&t.layerDefinition&&(s&&s<i&&(e=!1),r&&r>i&&(e=!1))}return e}isUpdating(){const e=this._vectorTileContainer.children;return!this._isTileHandlerReady||!this._fetchQueue||!this._parseQueue||this._fetchQueue.updating||this._parseQueue.updating||e.length>0&&e.some((e=>e.invalidating))||this.fading}acquireTile(e){const t=this._createVectorTile(e);return this._tileHandlerPromise?.then((()=>{this._fetchQueue.push(t.key).then((e=>this._parseQueue.push({key:t.key,data:e}))).then((e=>{t.once(\"attach\",(()=>this.requestUpdate())),t.setData(e),this.requestUpdate(),this.notifyChange(\"updating\")})).catch((e=>{this.notifyChange(\"updating\"),l(e)||s.getLogger(this.declaredClass).error(e)}))})),t}releaseTile(e){const t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this.requestUpdate()}_start(){if(this._stop(),this._tileManager=new g({acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView},this._vectorTileContainer),!this.layer.currentStyleInfo)return;const e=new AbortController,t=this._tileHandler.start({signal:e.signal}).then((()=>{this._fetchQueue=new S({tileInfoView:this._tileInfoView,process:(e,t)=>this._getTileData(e,t),concurrency:15}),this._parseQueue=new S({tileInfoView:this._tileInfoView,process:(e,t)=>this._parseTileData(e,t),concurrency:8}),this.requestUpdate(),this._isTileHandlerReady=!0}));this._tileHandler.spriteMosaic.then((e=>{this._vectorTileContainer.setStyleResources(e,this._tileHandler.glyphMosaic,this._styleRepository),this.requestUpdate()})),this._tileHandlerAbortController=e,this._tileHandlerPromise=t}_stop(){if(!this._tileHandlerAbortController||!this._vectorTileContainer)return;const e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._fetchQueue=a(this._fetchQueue),this._parseQueue=a(this._parseQueue),this._tileManager=a(this._tileManager),this._vectorTileContainer.removeAllChildren()}async _getTileData(e,t){const i=await this._tileHandler.fetchTileData(e,t);return this.notifyChange(\"updating\"),i}async _parseTileData(e,t){return this._tileHandler.parseTileData(e,t)}async _applyStyleChanges(){this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this._tileManager.clearCache();const e=this._styleChanges;try{await this._tileHandler.updateStyle(e)}catch(n){s.getLogger(this.declaredClass).error(\"error applying vector-tiles style update\",n.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0}const t=this._styleRepository,i=[];e.forEach((e=>{if(e.type!==_.LAYER_REMOVED)return;const s=e.data,r=t.getLayerById(s.layer);r&&i.push(r.uid)}));const r=[];let a;e.forEach((e=>{const i=e.type,s=e.data;switch(i){case _.PAINTER_CHANGED:t.setPaintProperties(s.layer,s.paint),a=s.layer;break;case _.LAYOUT_CHANGED:t.setLayoutProperties(s.layer,s.layout),a=s.layer;break;case _.LAYER_REMOVED:return void t.deleteStyleLayer(s.layer);case _.LAYER_CHANGED:t.setStyleLayer(s.layer,s.index),a=s.layer.id;break;case _.SPRITES_CHANGED:this._vectorTileContainer.setSpriteMosaic(this._tileHandler.setSpriteSource(this._newSpriteSource)),this._newSpriteSource=null,a=null}const l=t.getLayerById(a);l&&r.push(l.uid)}));const l=this._vectorTileContainer.children;if(i.length>0){this._vectorTileContainer.deleteStyleLayers(i);for(const e of l)e.deleteLayerData(i)}if(this._fetchQueue.resume(),this._parseQueue.resume(),r.length>0){const e=[];for(const t of l){const i=this._fetchQueue.push(t.key).then((e=>this._parseQueue.push({key:t.key,data:e,styleLayerUIDs:r}))).then((e=>t.setData(e)));e.push(i)}await Promise.all(e)}this._styleChanges=[],this._isTileHandlerReady=!0,this.notifyChange(\"updating\"),this.requestUpdate()}async _loadStyle(){const{style:e}=this.layer.currentStyleInfo,t=i(e);this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this.notifyChange(\"updating\"),this._styleRepository=new v(t),this._vectorTileContainer.destroy(),this._tileManager.clear(),this._tileHandlerAbortController.abort(),this._tileHandlerAbortController=new AbortController;const{signal:s}=this._tileHandlerAbortController;try{this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,t),await this._tileHandlerPromise}catch(a){if(!l(a))throw a}if(s.aborted)return this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.notifyChange(\"updating\"),void this.requestUpdate();const r=await this._tileHandler.spriteMosaic;this._vectorTileContainer.setStyleResources(r,this._tileHandler.glyphMosaic,this._styleRepository),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.notifyChange(\"updating\"),this.requestUpdate()}_createVectorTile(e){const t=this._tileInfoView.getTileBounds(p(),e),i=this._tileInfoView.getTileResolution(e.level);return new m(e,i,t[0],t[3],512,512,this._styleRepository)}};function L(e){if(r(e))return 0;switch(e.type){case\"partial\":return Object.keys(e.diff).length;case\"complete\":return Math.max(Object.keys(e.oldValue).length,Object.keys(e.newValue).length);case\"collection\":return Object.keys(e.added).length+Object.keys(e.changed).length+Object.keys(e.removed).length}}e([h()],Q.prototype,\"_fetchQueue\",void 0),e([h()],Q.prototype,\"_parseQueue\",void 0),e([h()],Q.prototype,\"_isTileHandlerReady\",void 0),e([h()],Q.prototype,\"fading\",void 0),Q=e([u(\"esri.views.2d.layers.VectorTileLayerView2D\")],Q);const I=Q;export{I as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}