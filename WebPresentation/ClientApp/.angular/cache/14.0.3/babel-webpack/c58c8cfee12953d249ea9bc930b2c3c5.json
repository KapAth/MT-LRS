{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/ClientApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../chunks/tslib.es6.js\";\nimport { equals as t } from \"../../../../../core/arrayUtils.js\";\nimport { AsyncSequence as i } from \"../../../../../core/AsyncSequence.js\";\nimport { createTask as s } from \"../../../../../core/asyncUtils.js\";\nimport { HandleOwner as r } from \"../../../../../core/HandleOwner.js\";\nimport { makeHandle as o } from \"../../../../../core/handleUtils.js\";\nimport n from \"../../../../../core/Logger.js\";\nimport { isSome as a, isNone as l, unwrap as u } from \"../../../../../core/maybe.js\";\nimport { throwIfAbortError as c } from \"../../../../../core/promiseUtils.js\";\nimport { sync as d } from \"../../../../../core/reactiveUtils.js\";\nimport { property as h } from \"../../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport { subclass as p } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport f from \"../../../../../geometry/Extent.js\";\nimport { toExtent as y } from \"../../../../../geometry/support/aaBoundingRect.js\";\nimport { unquantizeOptimizedFeatureSet as g, convertFromFeatureSet as m } from \"../../../../../layers/graphics/featureConversionUtils.js\";\nimport { isHostedAgolService as _ } from \"../../../../../layers/support/arcgisLayerUrl.js\";\nimport { OptimizedFeatureSetParserContext as b } from \"../../../../../rest/query/operations/pbfOptimizedFeatureSet.js\";\nimport { executeQueryForExtent as F, executeQueryPBF as T, executeQuery as P } from \"../../../../../rest/query/operations/query.js\";\nimport I from \"../../../../../rest/support/Query.js\";\nimport { StateType as v, PendingFeatureTile as O } from \"./PendingFeatureTile.js\";\nlet C = class extends r {\n  get _minimumVerticesPerFeature() {\n    switch (this.store?.featureStore.geometryType) {\n      case \"esriGeometryPoint\":\n      case \"esriGeometryMultipoint\":\n        return 1;\n\n      case \"esriGeometryPolygon\":\n        return 4;\n\n      case \"esriGeometryPolyline\":\n        return 2;\n    }\n  }\n\n  set filter(e) {\n    const t = this._get(\"filter\"),\n          i = this._filterProperties(e);\n\n    JSON.stringify(t) !== JSON.stringify(i) && this._set(\"filter\", i);\n  }\n\n  set customParameters(e) {\n    const t = this._get(\"customParameters\");\n\n    JSON.stringify(t) !== JSON.stringify(e) && this._set(\"customParameters\", e);\n  }\n\n  get _configuration() {\n    return {\n      filter: this.filter,\n      customParameters: this.customParameters,\n      tileInfo: this.tileInfo,\n      tileSize: this.tileSize\n    };\n  }\n\n  set tileInfo(e) {\n    const t = this._get(\"tileInfo\");\n\n    t !== e && (a(e) && a(t) && JSON.stringify(e) === JSON.stringify(t) || (this._set(\"tileInfo\", e), this.store.tileInfo = e));\n  }\n\n  set tileSize(e) {\n    this._get(\"tileSize\") !== e && this._set(\"tileSize\", e);\n  }\n\n  get updating() {\n    return this.updatingExcludingEdits || this._pendingEdits.updating;\n  }\n\n  get updatingExcludingEdits() {\n    return this.updatingHandles.updating;\n  }\n\n  get hasZ() {\n    return this.store.featureStore.hasZ;\n  }\n\n  constructor(e) {\n    super(e), this.tilesOfInterest = [], this.availability = 0, this._pendingTiles = new Map(), this._pendingEdits = new i(), this._pendingEditsAbortController = new AbortController();\n  }\n\n  initialize() {\n    this._initializeFetchExtent(), this.updatingHandles.add(() => this._configuration, () => this.refresh()), this.updatingHandles.add(() => this.tilesOfInterest, (e, i) => {\n      t(e, i, ({\n        id: e\n      }, {\n        id: t\n      }) => e === t) || this._process();\n    }, d);\n  }\n\n  destroy() {\n    this._pendingTiles.forEach(e => this._deletePendingTile(e)), this._pendingTiles.clear(), this.store.destroy(), this.tilesOfInterest.length = 0, this._pendingEditsAbortController.abort(), this._pendingEditsAbortController = null;\n  }\n\n  refresh() {\n    this.store.refresh(), this._pendingTiles.forEach(e => this._deletePendingTile(e)), this._process();\n  }\n\n  applyEdits(e) {\n    var _this = this;\n\n    this._pendingEdits.push(e, /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (e) {\n        if (0 === e.addedFeatures.length && 0 === e.updatedFeatures.length && 0 === e.deletedFeatures.length) return;\n\n        for (const [, i] of _this._pendingTiles) i.reset();\n\n        const t = { ...e,\n          deletedFeatures: e.deletedFeatures.map(({\n            objectId: e,\n            globalId: t\n          }) => e && -1 !== e ? e : _this._lookupObjectIdByGlobalId(t))\n        };\n        yield _this.updatingHandles.addPromise(_this.store.processEdits(t, (e, t) => _this._queryFeaturesById(e, t), _this._pendingEditsAbortController.signal)), _this._processPendingTiles();\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  }\n\n  _initializeFetchExtent() {\n    var _this2 = this;\n\n    if (!this.capabilities.query.supportsExtent || !_(this.url)) return;\n    const e = s( /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(function* (e) {\n        try {\n          const t = yield F(_this2.url, new I({\n            where: \"1=1\",\n            outSpatialReference: _this2.spatialReference,\n            cacheHint: !!_this2.capabilities.query.supportsCacheHint || void 0\n          }), {\n            query: _this2._configuration.customParameters,\n            signal: e\n          });\n          _this2.store.extent = f.fromJSON(t.data?.extent);\n        } catch (t) {\n          c(t), n.getLogger(_this2.declaredClass).warn(\"Failed to fetch data extent\", t);\n        }\n      });\n\n      return function (_x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n    this.updatingHandles.addPromise(e.promise.then(() => this._process())), this.handles.add(o(() => e.abort()));\n  }\n\n  get debugInfo() {\n    return {\n      numberOfFeatures: this.store.featureStore.numFeatures,\n      tilesOfInterest: this.tilesOfInterest,\n      pendingTiles: Array.from(this._pendingTiles.values()).map(e => e.debugInfo),\n      storedTiles: this.store.debugInfo\n    };\n  }\n\n  _process() {\n    this._markTilesNotAlive(), this._createPendingTiles(), this._deletePendingTiles(), this._processPendingTiles();\n  }\n\n  _markTilesNotAlive() {\n    for (const [, e] of this._pendingTiles) e.alive = !1;\n  }\n\n  _createPendingTiles() {\n    const e = this._collectMissingTilesInfo();\n\n    if (this._setAvailability(l(e) ? 1 : e.coveredArea / e.fullArea), !l(e)) for (const {\n      data: t,\n      resolution: i\n    } of e.missingTiles) {\n      const e = this._pendingTiles.get(t.id);\n\n      e ? (e.resolution = i, e.alive = !0) : this._createPendingTile(t, i);\n    }\n  }\n\n  _collectMissingTilesInfo() {\n    let e = null;\n\n    for (let t = this.tilesOfInterest.length - 1; t >= 0; t--) {\n      const i = this.tilesOfInterest[t],\n            s = this.store.process(i, (e, t) => this._verifyTileComplexity(e, t));\n      l(e) ? e = s : e.prepend(s);\n    }\n\n    return e;\n  }\n\n  _deletePendingTiles() {\n    for (const [, e] of this._pendingTiles) e.alive || this._deletePendingTile(e);\n  }\n\n  _processPendingTiles() {\n    const e = {\n      fetchCount: (e, t) => this._fetchCount(e, t),\n      fetchFeatures: (e, t, i) => this._fetchFeatures(e, t, i),\n      finish: (e, t) => this._finishPendingTile(e, t),\n      resume: () => this._processPendingTiles()\n    };\n    if (this._ensureFetchAllCounts(e)) for (const [, t] of this._pendingTiles) this._verifyTileComplexity(this.store.getFeatureCount(t.data), t.resolution) && this.updatingHandles.addPromise(t.process(e));\n  }\n\n  _verifyTileComplexity(e, t) {\n    return this._verifyVertexComplexity(e) && this._verifyFeatureDensity(e, t);\n  }\n\n  _verifyVertexComplexity(e) {\n    return e * this._minimumVerticesPerFeature < x;\n  }\n\n  _verifyFeatureDensity(e, t) {\n    if (l(this.tileInfo)) return !1;\n    const i = this.tileSize * t;\n    return e * (j / (i * i)) < w;\n  }\n\n  _ensureFetchAllCounts(e) {\n    let t = !0;\n\n    for (const [, i] of this._pendingTiles) i.state.type < v.FETCHED_COUNT && this.updatingHandles.addPromise(i.process(e)), i.state.type <= v.FETCH_COUNT && (t = !1);\n\n    return t;\n  }\n\n  _finishPendingTile(e, t) {\n    this.store.add(e.data, t), this._deletePendingTile(e), this._updateAvailability();\n  }\n\n  _updateAvailability() {\n    const e = this._collectMissingTilesInfo();\n\n    this._setAvailability(l(e) ? 1 : e.coveredArea / e.fullArea);\n  }\n\n  _setAvailability(e) {\n    this._set(\"availability\", e);\n  }\n\n  _createPendingTile(e, t) {\n    const i = new O(e, t);\n    return this._pendingTiles.set(e.id, i), i;\n  }\n\n  _deletePendingTile(e) {\n    e.reset(), this._pendingTiles.delete(e.data.id);\n  }\n\n  _fetchCount(e, t) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      return _this3.store.fetchCount(e.data, _this3.url, _this3._createCountQuery(e), {\n        query: _this3.customParameters,\n        timeout: S,\n        signal: t\n      });\n    })();\n  }\n\n  _fetchFeatures(e, t, i) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      let s = 0;\n      const r = [];\n      let o = 0,\n          n = t;\n\n      for (;;) {\n        const a = _this4._createFeaturesQuery(e),\n              l = _this4._setPagingParameters(a, s, n),\n              {\n          features: c,\n          exceededTransferLimit: d\n        } = yield _this4._queryFeatures(a, i);\n\n        l && (s += u(a.num)), o += c.length;\n\n        for (const e of c) r.push(e);\n\n        if (n = t - o, !l || !d || n <= 0) return r;\n      }\n    })();\n  }\n\n  _filterProperties(e) {\n    return l(e) ? {\n      where: \"1=1\",\n      gdbVersion: void 0,\n      timeExtent: void 0\n    } : {\n      where: e.where || \"1=1\",\n      timeExtent: e.timeExtent,\n      gdbVersion: e.gdbVersion\n    };\n  }\n\n  _lookupObjectIdByGlobalId(e) {\n    const t = this.globalIdField,\n          i = this.objectIdField;\n    if (l(t)) throw new Error(\"Expected globalIdField to be defined\");\n    let s = null;\n    if (this.store.featureStore.forEach(r => {\n      e === r.attributes[t] && (s = r.objectId ?? r.attributes[i]);\n    }), l(s)) throw new Error(`Expected to find a feature with globalId ${e}`);\n    return s;\n  }\n\n  _queryFeaturesById(e, t) {\n    const i = this._createFeaturesQuery();\n\n    return i.objectIds = e, this._queryFeatures(i, t);\n  }\n\n  _queryFeatures(e, t) {\n    return this.capabilities.query.supportsFormatPBF ? this._queryFeaturesPBF(e, t) : this._queryFeaturesJSON(e, t);\n  }\n\n  _queryFeaturesPBF(e, t) {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      const {\n        sourceSpatialReference: i\n      } = _this5,\n            {\n        data: s\n      } = yield T(_this5.url, e, new b({\n        sourceSpatialReference: i\n      }), {\n        query: _this5._configuration.customParameters,\n        timeout: S,\n        signal: t\n      });\n      return g(s);\n    })();\n  }\n\n  _queryFeaturesJSON(e, t) {\n    var _this6 = this;\n\n    return _asyncToGenerator(function* () {\n      const {\n        sourceSpatialReference: i\n      } = _this6,\n            {\n        data: s\n      } = yield P(_this6.url, e, i, {\n        query: _this6._configuration.customParameters,\n        timeout: S,\n        signal: t\n      });\n      return m(s, _this6.objectIdField);\n    })();\n  }\n\n  _createCountQuery(e) {\n    const t = this._createBaseQuery(e);\n\n    return this.capabilities.query.supportsCacheHint && (t.cacheHint = !0), t;\n  }\n\n  _createFeaturesQuery(e = null) {\n    const t = this._createBaseQuery(e);\n\n    return t.outFields = this.globalIdField ? [this.globalIdField, this.objectIdField] : [this.objectIdField], t.returnGeometry = !0, a(e) && (this.capabilities.query.supportsResultType ? t.resultType = \"tile\" : this.capabilities.query.supportsCacheHint && (t.cacheHint = !0)), t;\n  }\n\n  _createBaseQuery(e) {\n    const t = new I({\n      returnZ: this.hasZ,\n      returnM: !1,\n      geometry: a(this.tileInfo) && a(e) ? y(e.data.extent, this.tileInfo.spatialReference) : void 0\n    }),\n          i = this._configuration.filter;\n    return a(i) && (t.where = i.where, t.gdbVersion = i.gdbVersion, t.timeExtent = i.timeExtent), t.outSpatialReference = this.spatialReference, t;\n  }\n\n  _setPagingParameters(e, t, i) {\n    if (!this.capabilities.query.supportsPagination) return !1;\n    const {\n      supportsMaxRecordCountFactor: s,\n      supportsCacheHint: r,\n      tileMaxRecordCount: o,\n      maxRecordCount: n,\n      supportsResultType: a\n    } = this.capabilities.query,\n          l = s ? I.MAX_MAX_RECORD_COUNT_FACTOR : 1,\n          u = l * ((a || r) && o ? o : n || E);\n    return e.start = t, s ? (e.maxRecordCountFactor = Math.min(l, Math.ceil(i / u)), e.num = Math.min(i, e.maxRecordCountFactor * u)) : e.num = Math.min(i, u), !0;\n  }\n\n};\ne([h({\n  constructOnly: !0\n})], C.prototype, \"url\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"objectIdField\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"globalIdField\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"capabilities\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"sourceSpatialReference\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"spatialReference\", void 0), e([h({\n  constructOnly: !0\n})], C.prototype, \"store\", void 0), e([h({\n  readOnly: !0\n})], C.prototype, \"_minimumVerticesPerFeature\", null), e([h()], C.prototype, \"filter\", null), e([h()], C.prototype, \"customParameters\", null), e([h({\n  readOnly: !0\n})], C.prototype, \"_configuration\", null), e([h()], C.prototype, \"tileInfo\", null), e([h()], C.prototype, \"tileSize\", null), e([h()], C.prototype, \"tilesOfInterest\", void 0), e([h({\n  readOnly: !0\n})], C.prototype, \"updating\", null), e([h({\n  readOnly: !0\n})], C.prototype, \"updatingExcludingEdits\", null), e([h({\n  readOnly: !0\n})], C.prototype, \"availability\", void 0), e([h()], C.prototype, \"hasZ\", null), C = e([p(\"esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher\")], C);\nconst E = 2e3,\n      S = 6e5,\n      x = 1e6,\n      j = 25,\n      w = 1;\nexport { C as FeatureServiceTiledFetcher };","map":{"version":3,"names":["_","e","equals","t","AsyncSequence","i","createTask","s","HandleOwner","r","makeHandle","o","n","isSome","a","isNone","l","unwrap","u","throwIfAbortError","c","sync","d","property","h","subclass","p","f","toExtent","y","unquantizeOptimizedFeatureSet","g","convertFromFeatureSet","m","isHostedAgolService","OptimizedFeatureSetParserContext","b","executeQueryForExtent","F","executeQueryPBF","T","executeQuery","P","I","StateType","v","PendingFeatureTile","O","C","_minimumVerticesPerFeature","store","featureStore","geometryType","filter","_get","_filterProperties","JSON","stringify","_set","customParameters","_configuration","tileInfo","tileSize","updating","updatingExcludingEdits","_pendingEdits","updatingHandles","hasZ","constructor","tilesOfInterest","availability","_pendingTiles","Map","_pendingEditsAbortController","AbortController","initialize","_initializeFetchExtent","add","refresh","id","_process","destroy","forEach","_deletePendingTile","clear","length","abort","applyEdits","push","addedFeatures","updatedFeatures","deletedFeatures","reset","map","objectId","globalId","_lookupObjectIdByGlobalId","addPromise","processEdits","_queryFeaturesById","signal","_processPendingTiles","capabilities","query","supportsExtent","url","where","outSpatialReference","spatialReference","cacheHint","supportsCacheHint","extent","fromJSON","data","getLogger","declaredClass","warn","promise","then","handles","debugInfo","numberOfFeatures","numFeatures","pendingTiles","Array","from","values","storedTiles","_markTilesNotAlive","_createPendingTiles","_deletePendingTiles","alive","_collectMissingTilesInfo","_setAvailability","coveredArea","fullArea","resolution","missingTiles","get","_createPendingTile","process","_verifyTileComplexity","prepend","fetchCount","_fetchCount","fetchFeatures","_fetchFeatures","finish","_finishPendingTile","resume","_ensureFetchAllCounts","getFeatureCount","_verifyVertexComplexity","_verifyFeatureDensity","x","j","w","state","type","FETCHED_COUNT","FETCH_COUNT","_updateAvailability","set","delete","_createCountQuery","timeout","S","_createFeaturesQuery","_setPagingParameters","features","exceededTransferLimit","_queryFeatures","num","gdbVersion","timeExtent","globalIdField","objectIdField","Error","attributes","objectIds","supportsFormatPBF","_queryFeaturesPBF","_queryFeaturesJSON","sourceSpatialReference","_createBaseQuery","outFields","returnGeometry","supportsResultType","resultType","returnZ","returnM","geometry","supportsPagination","supportsMaxRecordCountFactor","tileMaxRecordCount","maxRecordCount","MAX_MAX_RECORD_COUNT_FACTOR","E","start","maxRecordCountFactor","Math","min","ceil","constructOnly","prototype","readOnly","FeatureServiceTiledFetcher"],"sources":["C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/node_modules/@arcgis/core/views/interactive/snapping/featureSources/featureServiceSource/FeatureServiceTiledFetcher.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{equals as t}from\"../../../../../core/arrayUtils.js\";import{AsyncSequence as i}from\"../../../../../core/AsyncSequence.js\";import{createTask as s}from\"../../../../../core/asyncUtils.js\";import{HandleOwner as r}from\"../../../../../core/HandleOwner.js\";import{makeHandle as o}from\"../../../../../core/handleUtils.js\";import n from\"../../../../../core/Logger.js\";import{isSome as a,isNone as l,unwrap as u}from\"../../../../../core/maybe.js\";import{throwIfAbortError as c}from\"../../../../../core/promiseUtils.js\";import{sync as d}from\"../../../../../core/reactiveUtils.js\";import{property as h}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import{subclass as p}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import f from\"../../../../../geometry/Extent.js\";import{toExtent as y}from\"../../../../../geometry/support/aaBoundingRect.js\";import{unquantizeOptimizedFeatureSet as g,convertFromFeatureSet as m}from\"../../../../../layers/graphics/featureConversionUtils.js\";import{isHostedAgolService as _}from\"../../../../../layers/support/arcgisLayerUrl.js\";import{OptimizedFeatureSetParserContext as b}from\"../../../../../rest/query/operations/pbfOptimizedFeatureSet.js\";import{executeQueryForExtent as F,executeQueryPBF as T,executeQuery as P}from\"../../../../../rest/query/operations/query.js\";import I from\"../../../../../rest/support/Query.js\";import{StateType as v,PendingFeatureTile as O}from\"./PendingFeatureTile.js\";let C=class extends r{get _minimumVerticesPerFeature(){switch(this.store?.featureStore.geometryType){case\"esriGeometryPoint\":case\"esriGeometryMultipoint\":return 1;case\"esriGeometryPolygon\":return 4;case\"esriGeometryPolyline\":return 2}}set filter(e){const t=this._get(\"filter\"),i=this._filterProperties(e);JSON.stringify(t)!==JSON.stringify(i)&&this._set(\"filter\",i)}set customParameters(e){const t=this._get(\"customParameters\");JSON.stringify(t)!==JSON.stringify(e)&&this._set(\"customParameters\",e)}get _configuration(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}set tileInfo(e){const t=this._get(\"tileInfo\");t!==e&&(a(e)&&a(t)&&JSON.stringify(e)===JSON.stringify(t)||(this._set(\"tileInfo\",e),this.store.tileInfo=e))}set tileSize(e){this._get(\"tileSize\")!==e&&this._set(\"tileSize\",e)}get updating(){return this.updatingExcludingEdits||this._pendingEdits.updating}get updatingExcludingEdits(){return this.updatingHandles.updating}get hasZ(){return this.store.featureStore.hasZ}constructor(e){super(e),this.tilesOfInterest=[],this.availability=0,this._pendingTiles=new Map,this._pendingEdits=new i,this._pendingEditsAbortController=new AbortController}initialize(){this._initializeFetchExtent(),this.updatingHandles.add((()=>this._configuration),(()=>this.refresh())),this.updatingHandles.add((()=>this.tilesOfInterest),((e,i)=>{t(e,i,(({id:e},{id:t})=>e===t))||this._process()}),d)}destroy(){this._pendingTiles.forEach((e=>this._deletePendingTile(e))),this._pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this._pendingEditsAbortController.abort(),this._pendingEditsAbortController=null}refresh(){this.store.refresh(),this._pendingTiles.forEach((e=>this._deletePendingTile(e))),this._process()}applyEdits(e){this._pendingEdits.push(e,(async e=>{if(0===e.addedFeatures.length&&0===e.updatedFeatures.length&&0===e.deletedFeatures.length)return;for(const[,i]of this._pendingTiles)i.reset();const t={...e,deletedFeatures:e.deletedFeatures.map((({objectId:e,globalId:t})=>e&&-1!==e?e:this._lookupObjectIdByGlobalId(t)))};await this.updatingHandles.addPromise(this.store.processEdits(t,((e,t)=>this._queryFeaturesById(e,t)),this._pendingEditsAbortController.signal)),this._processPendingTiles()}))}_initializeFetchExtent(){if(!this.capabilities.query.supportsExtent||!_(this.url))return;const e=s((async e=>{try{const t=await F(this.url,new I({where:\"1=1\",outSpatialReference:this.spatialReference,cacheHint:!!this.capabilities.query.supportsCacheHint||void 0}),{query:this._configuration.customParameters,signal:e});this.store.extent=f.fromJSON(t.data?.extent)}catch(t){c(t),n.getLogger(this.declaredClass).warn(\"Failed to fetch data extent\",t)}}));this.updatingHandles.addPromise(e.promise.then((()=>this._process()))),this.handles.add(o((()=>e.abort())))}get debugInfo(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this._pendingTiles.values()).map((e=>e.debugInfo)),storedTiles:this.store.debugInfo}}_process(){this._markTilesNotAlive(),this._createPendingTiles(),this._deletePendingTiles(),this._processPendingTiles()}_markTilesNotAlive(){for(const[,e]of this._pendingTiles)e.alive=!1}_createPendingTiles(){const e=this._collectMissingTilesInfo();if(this._setAvailability(l(e)?1:e.coveredArea/e.fullArea),!l(e))for(const{data:t,resolution:i}of e.missingTiles){const e=this._pendingTiles.get(t.id);e?(e.resolution=i,e.alive=!0):this._createPendingTile(t,i)}}_collectMissingTilesInfo(){let e=null;for(let t=this.tilesOfInterest.length-1;t>=0;t--){const i=this.tilesOfInterest[t],s=this.store.process(i,((e,t)=>this._verifyTileComplexity(e,t)));l(e)?e=s:e.prepend(s)}return e}_deletePendingTiles(){for(const[,e]of this._pendingTiles)e.alive||this._deletePendingTile(e)}_processPendingTiles(){const e={fetchCount:(e,t)=>this._fetchCount(e,t),fetchFeatures:(e,t,i)=>this._fetchFeatures(e,t,i),finish:(e,t)=>this._finishPendingTile(e,t),resume:()=>this._processPendingTiles()};if(this._ensureFetchAllCounts(e))for(const[,t]of this._pendingTiles)this._verifyTileComplexity(this.store.getFeatureCount(t.data),t.resolution)&&this.updatingHandles.addPromise(t.process(e))}_verifyTileComplexity(e,t){return this._verifyVertexComplexity(e)&&this._verifyFeatureDensity(e,t)}_verifyVertexComplexity(e){return e*this._minimumVerticesPerFeature<x}_verifyFeatureDensity(e,t){if(l(this.tileInfo))return!1;const i=this.tileSize*t;return e*(j/(i*i))<w}_ensureFetchAllCounts(e){let t=!0;for(const[,i]of this._pendingTiles)i.state.type<v.FETCHED_COUNT&&this.updatingHandles.addPromise(i.process(e)),i.state.type<=v.FETCH_COUNT&&(t=!1);return t}_finishPendingTile(e,t){this.store.add(e.data,t),this._deletePendingTile(e),this._updateAvailability()}_updateAvailability(){const e=this._collectMissingTilesInfo();this._setAvailability(l(e)?1:e.coveredArea/e.fullArea)}_setAvailability(e){this._set(\"availability\",e)}_createPendingTile(e,t){const i=new O(e,t);return this._pendingTiles.set(e.id,i),i}_deletePendingTile(e){e.reset(),this._pendingTiles.delete(e.data.id)}async _fetchCount(e,t){return this.store.fetchCount(e.data,this.url,this._createCountQuery(e),{query:this.customParameters,timeout:S,signal:t})}async _fetchFeatures(e,t,i){let s=0;const r=[];let o=0,n=t;for(;;){const a=this._createFeaturesQuery(e),l=this._setPagingParameters(a,s,n),{features:c,exceededTransferLimit:d}=await this._queryFeatures(a,i);l&&(s+=u(a.num)),o+=c.length;for(const e of c)r.push(e);if(n=t-o,!l||!d||n<=0)return r}}_filterProperties(e){return l(e)?{where:\"1=1\",gdbVersion:void 0,timeExtent:void 0}:{where:e.where||\"1=1\",timeExtent:e.timeExtent,gdbVersion:e.gdbVersion}}_lookupObjectIdByGlobalId(e){const t=this.globalIdField,i=this.objectIdField;if(l(t))throw new Error(\"Expected globalIdField to be defined\");let s=null;if(this.store.featureStore.forEach((r=>{e===r.attributes[t]&&(s=r.objectId??r.attributes[i])})),l(s))throw new Error(`Expected to find a feature with globalId ${e}`);return s}_queryFeaturesById(e,t){const i=this._createFeaturesQuery();return i.objectIds=e,this._queryFeatures(i,t)}_queryFeatures(e,t){return this.capabilities.query.supportsFormatPBF?this._queryFeaturesPBF(e,t):this._queryFeaturesJSON(e,t)}async _queryFeaturesPBF(e,t){const{sourceSpatialReference:i}=this,{data:s}=await T(this.url,e,new b({sourceSpatialReference:i}),{query:this._configuration.customParameters,timeout:S,signal:t});return g(s)}async _queryFeaturesJSON(e,t){const{sourceSpatialReference:i}=this,{data:s}=await P(this.url,e,i,{query:this._configuration.customParameters,timeout:S,signal:t});return m(s,this.objectIdField)}_createCountQuery(e){const t=this._createBaseQuery(e);return this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t}_createFeaturesQuery(e=null){const t=this._createBaseQuery(e);return t.outFields=this.globalIdField?[this.globalIdField,this.objectIdField]:[this.objectIdField],t.returnGeometry=!0,a(e)&&(this.capabilities.query.supportsResultType?t.resultType=\"tile\":this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0)),t}_createBaseQuery(e){const t=new I({returnZ:this.hasZ,returnM:!1,geometry:a(this.tileInfo)&&a(e)?y(e.data.extent,this.tileInfo.spatialReference):void 0}),i=this._configuration.filter;return a(i)&&(t.where=i.where,t.gdbVersion=i.gdbVersion,t.timeExtent=i.timeExtent),t.outSpatialReference=this.spatialReference,t}_setPagingParameters(e,t,i){if(!this.capabilities.query.supportsPagination)return!1;const{supportsMaxRecordCountFactor:s,supportsCacheHint:r,tileMaxRecordCount:o,maxRecordCount:n,supportsResultType:a}=this.capabilities.query,l=s?I.MAX_MAX_RECORD_COUNT_FACTOR:1,u=l*((a||r)&&o?o:n||E);return e.start=t,s?(e.maxRecordCountFactor=Math.min(l,Math.ceil(i/u)),e.num=Math.min(i,e.maxRecordCountFactor*u)):e.num=Math.min(i,u),!0}};e([h({constructOnly:!0})],C.prototype,\"url\",void 0),e([h({constructOnly:!0})],C.prototype,\"objectIdField\",void 0),e([h({constructOnly:!0})],C.prototype,\"globalIdField\",void 0),e([h({constructOnly:!0})],C.prototype,\"capabilities\",void 0),e([h({constructOnly:!0})],C.prototype,\"sourceSpatialReference\",void 0),e([h({constructOnly:!0})],C.prototype,\"spatialReference\",void 0),e([h({constructOnly:!0})],C.prototype,\"store\",void 0),e([h({readOnly:!0})],C.prototype,\"_minimumVerticesPerFeature\",null),e([h()],C.prototype,\"filter\",null),e([h()],C.prototype,\"customParameters\",null),e([h({readOnly:!0})],C.prototype,\"_configuration\",null),e([h()],C.prototype,\"tileInfo\",null),e([h()],C.prototype,\"tileSize\",null),e([h()],C.prototype,\"tilesOfInterest\",void 0),e([h({readOnly:!0})],C.prototype,\"updating\",null),e([h({readOnly:!0})],C.prototype,\"updatingExcludingEdits\",null),e([h({readOnly:!0})],C.prototype,\"availability\",void 0),e([h()],C.prototype,\"hasZ\",null),C=e([p(\"esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher\")],C);const E=2e3,S=6e5,x=1e6,j=25,w=1;export{C as FeatureServiceTiledFetcher};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}