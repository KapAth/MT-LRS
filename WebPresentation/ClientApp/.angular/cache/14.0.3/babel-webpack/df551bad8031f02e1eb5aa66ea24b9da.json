{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/ClientApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport \"../../../../geometry.js\";\nimport { HandleOwner as t } from \"../../../../core/HandleOwner.js\";\nimport i from \"../../../../core/Logger.js\";\nimport { isSome as s, unwrap as r } from \"../../../../core/maybe.js\";\nimport { debounce as a, isAbortError as o, eachAlways as l } from \"../../../../core/promiseUtils.js\";\nimport { property as n } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../core/arrayUtils.js\";\nimport { subclass as h } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport c from \"../../../../geometry/Point.js\";\nimport u from \"../../../../layers/support/PixelBlock.js\";\nimport p from \"../../../../layers/support/TileInfo.js\";\nimport { update as d, unregister as g, register as y, getRasterId as m } from \"../../../../layers/support/rasterDatasets/RawBlockCache.js\";\nimport { extractBands as _ } from \"../../../../layers/support/rasterFunctions/pixelUtils.js\";\nimport { getWorldWidth as f, computeProjectedScales as b } from \"../../../../layers/support/rasterFunctions/rasterProjectionHelper.js\";\nimport \"../../tiling/PagedTileQueue.js\";\nimport w from \"../../tiling/TileInfoView.js\";\nimport \"../../tiling/TileKey.js\";\nimport I from \"../../tiling/TileQueue.js\";\nimport P from \"../../tiling/TileStrategy.js\";\nimport { TILE_SIZE as C } from \"../../engine/webgl/definitions.js\";\nimport { getWebGLCapabilities as R } from \"../../../webgl/capabilities.js\";\nimport S from \"../../../../geometry/Extent.js\";\nconst T = [0, 0];\nlet v = class extends t {\n  constructor() {\n    var _this;\n\n    (super(...arguments), _this = this), this._emptyTilePixelBlock = null, this._tileStrategy = null, this._tileInfoView = null, this._fetchQueue = null, this._blockCacheRegistryUrl = null, this._blockCacheRegistryId = null, this._srcResolutions = [], this.previousLOD = null, this._needBlockCacheUpdate = !1, this._globalSymbolizerParams = null, this._symbolizerParams = null, this._abortController = null, this._isCustomTilingScheme = !1, this._rasterFunctionState = \"na\", this._globalUpdateRequested = !1, this.attached = !1, this.timeExtent = null, this.redrawOrRefetch = a( /*#__PURE__*/_asyncToGenerator(function* (e = {}) {\n      if (!_this.previousLOD || _this.layerView.suspended) return;\n      const t = _this._rasterFunctionState;\n      e.reprocess && (yield _this.updatingHandles.addPromise(_this.layer.updateRasterFunction()), _this.updateRasterFunctionParameters());\n      const i = _this._rasterFunctionState,\n            {\n        type: s\n      } = _this;\n      return e.refetch || \"raster\" !== s && !!e.reprocess || \"cpu\" === i || \"cpu\" === t ? _this.updatingHandles.addPromise(_this.doRefresh()) : _this.updatingHandles.addPromise(_this._redrawImage(e.signal));\n    }));\n  }\n\n  get useWebGLForProcessing() {\n    return this._get(\"useWebGLForProcessing\") ?? !0;\n  }\n\n  set useWebGLForProcessing(e) {\n    this._set(\"useWebGLForProcessing\", e);\n  }\n\n  get useProgressiveUpdate() {\n    return null == this._get(\"useProgressiveUpdate\") || this._get(\"useProgressiveUpdate\");\n  }\n\n  set useProgressiveUpdate(e) {\n    if (this._tileStrategy && this.useProgressiveUpdate !== e) {\n      this._tileStrategy.destroy(), this.container.removeAllChildren();\n\n      const t = this._getCacheSize(e);\n\n      this._tileStrategy = new P({\n        cachePolicy: \"purge\",\n        acquireTile: e => this.acquireTile(e),\n        releaseTile: e => this.releaseTile(e),\n        cacheSize: t,\n        tileInfoView: this._tileInfoView\n      }), this._set(\"useProgressiveUpdate\", e), this.layerView.requestUpdate();\n    }\n  }\n\n  update(e) {\n    this._fetchQueue.pause(), this._fetchQueue.state = e.state, this._tileStrategy.update(e), this._fetchQueue.resume();\n\n    const {\n      extent: t,\n      resolution: i,\n      scale: s\n    } = e.state,\n          r = this._tileInfoView.getClosestInfoForScale(s);\n\n    if (this.layer.raster) {\n      if (!this.useProgressiveUpdate || this._needBlockCacheUpdate) {\n        const e = this._srcResolutions[r.level],\n              s = t.toJSON ? t : S.fromJSON(t);\n        d(this._blockCacheRegistryUrl, this._blockCacheRegistryId, s, i, e, this.layer.raster.ioConfig.sampling);\n      }\n\n      this._needBlockCacheUpdate = !1, this.previousLOD?.level !== r.level && (this.previousLOD = r, null == this._symbolizerParams || this.layerView.hasTilingEffects || this._updateSymbolizerParams(), this._tileStrategy.updateCacheSize(0));\n    }\n  }\n\n  moveEnd() {\n    !this.layerView.hasTilingEffects && this.useProgressiveUpdate || (this._abortController && this._abortController.abort(), this._abortController = new AbortController(), 0 === this._fetchQueue.length && this._redrawImage(this._abortController.signal).then(() => {\n      this._globalUpdateRequested = !1, this.layerView.requestUpdate();\n    }));\n\n    const e = this._getCacheSize(this.useProgressiveUpdate);\n\n    this._tileStrategy.updateCacheSize(e), this.layerView.requestUpdate();\n  }\n\n  get updating() {\n    return this._fetchQueue?.updating || this._globalUpdateRequested || !(!this.updatingHandles || !this.updatingHandles.updating);\n  }\n\n  attach() {\n    R(\"2d\").supportsTextureFloat || (this.useWebGLForProcessing = !1), this._initializeTileInfo(), this._tileInfoView = new w(this.layerView.tileInfo, this.layerView.fullExtent);\n\n    const e = this._computeFetchConcurrency();\n\n    this._fetchQueue = new I({\n      tileInfoView: this._tileInfoView,\n      concurrency: e,\n      process: (e, t) => this._fetchTile1(e, t)\n    });\n\n    const t = this._getCacheSize(this.useProgressiveUpdate);\n\n    this._tileStrategy = new P({\n      cachePolicy: \"purge\",\n      acquireTile: e => this.acquireTile(e),\n      releaseTile: e => this.releaseTile(e),\n      cacheSize: t,\n      tileInfoView: this._tileInfoView\n    }), this._updateBlockCacheRegistry();\n  }\n\n  detach() {\n    this._tileStrategy.destroy(), this._fetchQueue.clear(), this.container.removeAllChildren(), this._fetchQueue = this._tileStrategy = this._tileInfoView = null, g(this._blockCacheRegistryUrl, this._blockCacheRegistryId), this._blockCacheRegistryUrl = this._blockCacheRegistryId = null;\n  }\n\n  acquireTile(e) {\n    const t = this.container.createTile(e);\n    return this._enqueueTileFetch(t), this.layerView.requestUpdate(), this._needBlockCacheUpdate = !0, this._globalUpdateRequested = this.layerView.hasTilingEffects || !this.useProgressiveUpdate, t;\n  }\n\n  releaseTile(e) {\n    this._fetchQueue.abort(e.key.id), this.container.removeChild(e), e.once(\"detach\", () => {\n      e.destroy(), this.layerView.requestUpdate();\n    }), this.layerView.requestUpdate();\n  }\n\n  createEmptyTilePixelBlock(e = null) {\n    const t = null == e || e.join(\",\") === this._tileInfoView.tileInfo.size.join(\",\");\n\n    if (t && s(this._emptyTilePixelBlock)) return this._emptyTilePixelBlock;\n    e = e || this._tileInfoView.tileInfo.size;\n    const [i, r] = e,\n          a = new u({\n      width: i,\n      height: r,\n      pixels: [new Uint8Array(i * r)],\n      mask: new Uint8Array(i * r),\n      pixelType: \"u8\"\n    });\n    return t && (this._emptyTilePixelBlock = a), a;\n  }\n\n  _getBandIds() {\n    if (!(\"rasterFunctionChain\" in this.container) || !this.container.rasterFunctionChain) return this.layer.bandIds;\n    const {\n      bandIds: e,\n      raster: t\n    } = this.layer,\n          i = \"rasterFunction\" in t ? t.rasterFunction.rawInputBandIds : null;\n    return e?.length && i?.length && 1 !== t.rasterInfo.bandCount ? e.map(e => i[Math.min(e, i.length - 1)]) : e || i;\n  }\n\n  updateRasterFunctionParameters() {}\n\n  _fetchTile1(e, t) {\n    const i = s(t) ? t.signal : null,\n          a = this.canUseWebGLForProcessing(),\n          {\n      layerView: o\n    } = this,\n          {\n      tileInfo: l\n    } = o,\n          n = !l.isWrappable && s(f(o.view.spatialReference)),\n          h = a && this.layer.raster.hasUniqueSourceStorageInfo,\n          c = {\n      allowPartialFill: !0,\n      datumTransformation: o.datumTransformation,\n      interpolation: a ? \"nearest\" : this.layer.interpolation,\n      registryId: this._blockCacheRegistryId,\n      requestRawData: h,\n      skipRasterFunction: \"raster\" === this.type && null != this.container.rasterFunctionChain,\n      signal: r(i),\n      srcResolution: this._srcResolutions[e.level],\n      timeExtent: o.timeExtent,\n      tileInfo: l,\n      disableWrapAround: n\n    };\n    return this.fetchTile(e, c);\n  }\n\n  _getCacheSize(e) {\n    return e ? 40 : 0;\n  }\n\n  _initializeTileInfo() {\n    const {\n      layerView: e\n    } = this,\n          t = e.view.spatialReference,\n          i = new c({\n      x: e.fullExtent.xmin,\n      y: e.fullExtent.ymax,\n      spatialReference: t\n    });\n\n    if (this._canUseLayerLODs()) {\n      const {\n        lods: s\n      } = this.layer.tileInfo,\n            r = s.map(({\n        scale: e\n      }) => e),\n            a = p.create({\n        spatialReference: t,\n        size: C,\n        scales: r\n      }),\n            o = t.isGeographic ? .01 * 1e-5 : .01;\n\n      if (this._isCustomTilingScheme = Math.abs(a.origin.x - i.x) > o, (0 === a.origin.x || a.origin.x > i.x) && (a.origin = i), !this._isCustomTilingScheme) {\n        const e = p.create({\n          spatialReference: t,\n          size: C\n        }).lods.map(({\n          scale: e\n        }) => e);\n        this._isCustomTilingScheme = r.some(t => !e.some(e => Math.abs(e - t) < .001));\n      }\n\n      return e.set(\"tileInfo\", a), void (this._srcResolutions = s.map(({\n        resolution: e\n      }) => ({\n        x: e,\n        y: e\n      })));\n    }\n\n    const {\n      scales: s,\n      srcResolutions: r,\n      isCustomTilingScheme: a\n    } = b(this.layer.rasterInfo, t, C),\n          o = p.create({\n      spatialReference: t,\n      size: C,\n      scales: s\n    });\n    (0 === o.origin.x || o.origin.x > i.x) && (o.origin = i), this._isCustomTilingScheme = a, e.set(\"tileInfo\", o), this._srcResolutions = r ?? [];\n  }\n\n  _canUseLayerLODs() {\n    const {\n      layer: e,\n      layerView: t\n    } = this;\n    if (\"Map\" !== e.raster.tileType) return !1;\n    const {\n      lods: i\n    } = e.tileInfo,\n          s = t.view.constraints?.effectiveLODs;\n    if (!(s?.length === i.length && s.every(({\n      scale: e\n    }, t) => Math.abs(e - i[t].scale) < .001))) return !1;\n    const r = [];\n\n    for (let a = 0; a < i.length - 1; a++) r.push(Math.round(10 * i[a].resolution / i[a + 1].resolution) / 10);\n\n    return r.some(e => e !== e[0]);\n  }\n\n  _computeFetchConcurrency() {\n    const {\n      blockBoundary: e\n    } = this.layer.rasterInfo.storageInfo,\n          t = e[e.length - 1];\n    return (t.maxCol - t.minCol + 1) * (t.maxRow - t.minRow + 1) > 64 ? 2 : 10;\n  }\n\n  _enqueueTileFetch(e, t) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      _this2.updatingHandles.addPromise(_this2._enqueueTileFetch1(e, t));\n    })();\n  }\n\n  _enqueueTileFetch1(e, t) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      if (!_this3._fetchQueue.has(e.key.id)) {\n        try {\n          const t = yield _this3._fetchQueue.push(e.key),\n                r = _this3._getBandIds();\n\n          let a = !_this3.useProgressiveUpdate || _this3.layerView.hasTilingEffects && !_this3._globalSymbolizerParams;\n\n          if (_this3._globalUpdateRequested && !_this3.layerView.moving && 0 === _this3._fetchQueue.length) {\n            a = !1;\n\n            try {\n              yield _this3._redrawImage(_this3._abortController?.signal);\n            } catch (s) {\n              o(s) && i.getLogger(_this3.declaredClass).error(s);\n            }\n\n            _this3._globalUpdateRequested = !1;\n          }\n\n          !_this3.canUseWebGLForProcessing() && \"rasterVF\" !== _this3.type || _this3.layerView.hasTilingEffects || null != _this3._symbolizerParams || _this3._updateSymbolizerParams();\n\n          const l = _this3._tileInfoView.getTileCoords(T, e.key),\n                n = _this3._tileInfoView.getTileResolution(e.key);\n\n          yield _this3.updateTileSource(e, {\n            source: t,\n            symbolizerParams: _this3._symbolizerParams,\n            globalSymbolizerParams: _this3._globalSymbolizerParams,\n            suspended: a,\n            bandIds: r,\n            coords: l,\n            resolution: n\n          }), e.once(\"attach\", () => _this3.layerView.requestUpdate()), _this3.container.addChild(e);\n        } catch (s) {\n          o(s) || i.getLogger(_this3.declaredClass).error(s);\n        }\n\n        _this3.layerView.requestUpdate();\n      }\n    })();\n  }\n\n  _redrawImage(e) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      if (0 === _this4.container.children.length) return;\n      yield _this4.layer.updateRenderer(), _this4.layerView.hasTilingEffects ? yield _this4._updateGlobalSymbolizerParams(e) : (_this4._updateSymbolizerParams(), _this4._globalSymbolizerParams = null);\n\n      const t = _this4.container.children.map( /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator(function* (e) {\n          return _this4.updateTileSymbolizerParameters(e, {\n            local: _this4._symbolizerParams,\n            global: _this4._globalSymbolizerParams\n          });\n        });\n\n        return function (_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }());\n\n      yield l(t), _this4.container.requestRender();\n    })();\n  }\n\n  _updateGlobalSymbolizerParams(e) {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      const t = {\n        srcResolution: _this5._srcResolutions[_this5.previousLOD.level],\n        registryId: _this5._blockCacheRegistryId,\n        signal: e\n      },\n            i = yield _this5.layer.fetchPixels(_this5.layerView.view.extent, _this5.layerView.view.width, _this5.layerView.view.height, t);\n      if (!i || !i.pixelBlock) return;\n\n      const {\n        resolution: s\n      } = _this5.previousLOD,\n            r = _this5._getBandIds(),\n            a = _this5.layer.symbolizer.generateWebGLParameters({\n        pixelBlock: _(i.pixelBlock, r),\n        isGCS: _this5.layerView.view.spatialReference.isGeographic,\n        resolution: {\n          x: s,\n          y: s\n        },\n        bandIds: r\n      });\n\n      !_this5.canUseWebGLForProcessing() && a && \"stretch\" === a.type && _this5.layer.renderer && \"raster-stretch\" === _this5.layer.renderer.type && (a.factor = a.factor.map(e => 255 * e), a.outMin = Math.round(255 * a.outMin), a.outMax = Math.round(255 * a.outMax)), _this5._globalSymbolizerParams = a;\n    })();\n  }\n\n  _updateSymbolizerParams() {\n    const {\n      resolution: e\n    } = this.previousLOD,\n          t = this._getBandIds();\n\n    this._symbolizerParams = this.layer.symbolizer.generateWebGLParameters({\n      pixelBlock: null,\n      isGCS: this.layerView.view.spatialReference.isGeographic,\n      resolution: {\n        x: e,\n        y: e\n      },\n      bandIds: t\n    });\n  }\n\n  _updateBlockCacheRegistry(e = !1) {\n    const {\n      layer: t,\n      layerView: i\n    } = this,\n          {\n      url: s,\n      raster: r\n    } = t,\n          {\n      multidimensionalDefinition: a\n    } = t.normalizeRasterFetchOptions({\n      multidimensionalDefinition: t.multidimensionalDefinition,\n      timeExtent: i.timeExtent\n    }),\n          o = r.rasterInfo.multidimensionalInfo ? r.getSliceIndex(a) : null,\n          l = m(s, o);\n\n    if (l !== this._blockCacheRegistryUrl) {\n      if (null != this._blockCacheRegistryUrl && g(this._blockCacheRegistryUrl, this._blockCacheRegistryId), this._blockCacheRegistryId = y(l, r.rasterInfo), e) {\n        const {\n          view: e\n        } = i,\n              t = this._tileInfoView.getClosestInfoForScale(e.scale),\n              s = this._srcResolutions[t.level];\n\n        d(l, this._blockCacheRegistryId, e.extent, e.resolution, s, r.ioConfig.sampling);\n      }\n\n      this._blockCacheRegistryUrl = l;\n    }\n  }\n\n  doRefresh() {\n    var _this6 = this;\n\n    return _asyncToGenerator(function* () {\n      if (!_this6.attached) return;\n      yield _this6.layer.updateRenderer(), _this6.layerView.hasTilingEffects || _this6._updateSymbolizerParams(), _this6._updateBlockCacheRegistry(!0), _this6._fetchQueue.reset();\n      const e = [];\n      _this6._globalUpdateRequested = _this6.layerView.hasTilingEffects || !_this6.useProgressiveUpdate, _this6._tileStrategy.tiles.forEach(t => e.push(_this6._enqueueTileFetch(t))), yield l(e);\n    })();\n  }\n\n};\ne([n()], v.prototype, \"_fetchQueue\", void 0), e([n()], v.prototype, \"_globalUpdateRequested\", void 0), e([n()], v.prototype, \"attached\", void 0), e([n()], v.prototype, \"container\", void 0), e([n()], v.prototype, \"layer\", void 0), e([n()], v.prototype, \"layerView\", void 0), e([n()], v.prototype, \"type\", void 0), e([n()], v.prototype, \"useWebGLForProcessing\", null), e([n()], v.prototype, \"useProgressiveUpdate\", null), e([n()], v.prototype, \"timeExtent\", void 0), e([n()], v.prototype, \"updating\", null), v = e([h(\"esri.views.2d.layers.imagery.BaseImageryTileSubView2D\")], v);\nexport { v as BaseImageryTileSubView2D };","map":{"version":3,"names":["_","e","HandleOwner","t","i","isSome","s","unwrap","r","debounce","a","isAbortError","o","eachAlways","l","property","n","subclass","h","c","u","p","update","d","unregister","g","register","y","getRasterId","m","extractBands","getWorldWidth","f","computeProjectedScales","b","w","I","P","TILE_SIZE","C","getWebGLCapabilities","R","S","T","v","constructor","arguments","_emptyTilePixelBlock","_tileStrategy","_tileInfoView","_fetchQueue","_blockCacheRegistryUrl","_blockCacheRegistryId","_srcResolutions","previousLOD","_needBlockCacheUpdate","_globalSymbolizerParams","_symbolizerParams","_abortController","_isCustomTilingScheme","_rasterFunctionState","_globalUpdateRequested","attached","timeExtent","redrawOrRefetch","layerView","suspended","reprocess","updatingHandles","addPromise","layer","updateRasterFunction","updateRasterFunctionParameters","type","refetch","doRefresh","_redrawImage","signal","useWebGLForProcessing","_get","_set","useProgressiveUpdate","destroy","container","removeAllChildren","_getCacheSize","cachePolicy","acquireTile","releaseTile","cacheSize","tileInfoView","requestUpdate","pause","state","resume","extent","resolution","scale","getClosestInfoForScale","raster","level","toJSON","fromJSON","ioConfig","sampling","hasTilingEffects","_updateSymbolizerParams","updateCacheSize","moveEnd","abort","AbortController","length","then","updating","attach","supportsTextureFloat","_initializeTileInfo","tileInfo","fullExtent","_computeFetchConcurrency","concurrency","process","_fetchTile1","_updateBlockCacheRegistry","detach","clear","createTile","_enqueueTileFetch","key","id","removeChild","once","createEmptyTilePixelBlock","join","size","width","height","pixels","Uint8Array","mask","pixelType","_getBandIds","rasterFunctionChain","bandIds","rasterFunction","rawInputBandIds","rasterInfo","bandCount","map","Math","min","canUseWebGLForProcessing","isWrappable","view","spatialReference","hasUniqueSourceStorageInfo","allowPartialFill","datumTransformation","interpolation","registryId","requestRawData","skipRasterFunction","srcResolution","disableWrapAround","fetchTile","x","xmin","ymax","_canUseLayerLODs","lods","create","scales","isGeographic","abs","origin","some","set","srcResolutions","isCustomTilingScheme","tileType","constraints","effectiveLODs","every","push","round","blockBoundary","storageInfo","maxCol","minCol","maxRow","minRow","_enqueueTileFetch1","has","moving","getLogger","declaredClass","error","getTileCoords","getTileResolution","updateTileSource","source","symbolizerParams","globalSymbolizerParams","coords","addChild","children","updateRenderer","_updateGlobalSymbolizerParams","updateTileSymbolizerParameters","local","global","requestRender","fetchPixels","pixelBlock","symbolizer","generateWebGLParameters","isGCS","renderer","factor","outMin","outMax","url","multidimensionalDefinition","normalizeRasterFetchOptions","multidimensionalInfo","getSliceIndex","reset","tiles","forEach","prototype","BaseImageryTileSubView2D"],"sources":["C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/node_modules/@arcgis/core/views/2d/layers/imagery/BaseImageryTileSubView2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../geometry.js\";import{HandleOwner as t}from\"../../../../core/HandleOwner.js\";import i from\"../../../../core/Logger.js\";import{isSome as s,unwrap as r}from\"../../../../core/maybe.js\";import{debounce as a,isAbortError as o,eachAlways as l}from\"../../../../core/promiseUtils.js\";import{property as n}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/arrayUtils.js\";import{subclass as h}from\"../../../../core/accessorSupport/decorators/subclass.js\";import c from\"../../../../geometry/Point.js\";import u from\"../../../../layers/support/PixelBlock.js\";import p from\"../../../../layers/support/TileInfo.js\";import{update as d,unregister as g,register as y,getRasterId as m}from\"../../../../layers/support/rasterDatasets/RawBlockCache.js\";import{extractBands as _}from\"../../../../layers/support/rasterFunctions/pixelUtils.js\";import{getWorldWidth as f,computeProjectedScales as b}from\"../../../../layers/support/rasterFunctions/rasterProjectionHelper.js\";import\"../../tiling/PagedTileQueue.js\";import w from\"../../tiling/TileInfoView.js\";import\"../../tiling/TileKey.js\";import I from\"../../tiling/TileQueue.js\";import P from\"../../tiling/TileStrategy.js\";import{TILE_SIZE as C}from\"../../engine/webgl/definitions.js\";import{getWebGLCapabilities as R}from\"../../../webgl/capabilities.js\";import S from\"../../../../geometry/Extent.js\";const T=[0,0];let v=class extends t{constructor(){super(...arguments),this._emptyTilePixelBlock=null,this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._srcResolutions=[],this.previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._isCustomTilingScheme=!1,this._rasterFunctionState=\"na\",this._globalUpdateRequested=!1,this.attached=!1,this.timeExtent=null,this.redrawOrRefetch=a((async(e={})=>{if(!this.previousLOD||this.layerView.suspended)return;const t=this._rasterFunctionState;e.reprocess&&(await this.updatingHandles.addPromise(this.layer.updateRasterFunction()),this.updateRasterFunctionParameters());const i=this._rasterFunctionState,{type:s}=this;return e.refetch||\"raster\"!==s&&!!e.reprocess||\"cpu\"===i||\"cpu\"===t?this.updatingHandles.addPromise(this.doRefresh()):this.updatingHandles.addPromise(this._redrawImage(e.signal))}))}get useWebGLForProcessing(){return this._get(\"useWebGLForProcessing\")??!0}set useWebGLForProcessing(e){this._set(\"useWebGLForProcessing\",e)}get useProgressiveUpdate(){return null==this._get(\"useProgressiveUpdate\")||this._get(\"useProgressiveUpdate\")}set useProgressiveUpdate(e){if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this.container.removeAllChildren();const t=this._getCacheSize(e);this._tileStrategy=new P({cachePolicy:\"purge\",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._set(\"useProgressiveUpdate\",e),this.layerView.requestUpdate()}}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();const{extent:t,resolution:i,scale:s}=e.state,r=this._tileInfoView.getClosestInfoForScale(s);if(this.layer.raster){if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const e=this._srcResolutions[r.level],s=t.toJSON?t:S.fromJSON(t);d(this._blockCacheRegistryUrl,this._blockCacheRegistryId,s,i,e,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,this.previousLOD?.level!==r.level&&(this.previousLOD=r,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((()=>{this._globalUpdateRequested=!1,this.layerView.requestUpdate()})));const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(e),this.layerView.requestUpdate()}get updating(){return this._fetchQueue?.updating||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}attach(){R(\"2d\").supportsTextureFloat||(this.useWebGLForProcessing=!1),this._initializeTileInfo(),this._tileInfoView=new w(this.layerView.tileInfo,this.layerView.fullExtent);const e=this._computeFetchConcurrency();this._fetchQueue=new I({tileInfoView:this._tileInfoView,concurrency:e,process:(e,t)=>this._fetchTile1(e,t)});const t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new P({cachePolicy:\"purge\",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}detach(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,g(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}acquireTile(e){const t=this.container.createTile(e);return this._enqueueTileFetch(t),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}releaseTile(e){this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once(\"detach\",(()=>{e.destroy(),this.layerView.requestUpdate()})),this.layerView.requestUpdate()}createEmptyTilePixelBlock(e=null){const t=null==e||e.join(\",\")===this._tileInfoView.tileInfo.size.join(\",\");if(t&&s(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;e=e||this._tileInfoView.tileInfo.size;const[i,r]=e,a=new u({width:i,height:r,pixels:[new Uint8Array(i*r)],mask:new Uint8Array(i*r),pixelType:\"u8\"});return t&&(this._emptyTilePixelBlock=a),a}_getBandIds(){if(!(\"rasterFunctionChain\"in this.container)||!this.container.rasterFunctionChain)return this.layer.bandIds;const{bandIds:e,raster:t}=this.layer,i=\"rasterFunction\"in t?t.rasterFunction.rawInputBandIds:null;return e?.length&&i?.length&&1!==t.rasterInfo.bandCount?e.map((e=>i[Math.min(e,i.length-1)])):e||i}updateRasterFunctionParameters(){}_fetchTile1(e,t){const i=s(t)?t.signal:null,a=this.canUseWebGLForProcessing(),{layerView:o}=this,{tileInfo:l}=o,n=!l.isWrappable&&s(f(o.view.spatialReference)),h=a&&this.layer.raster.hasUniqueSourceStorageInfo,c={allowPartialFill:!0,datumTransformation:o.datumTransformation,interpolation:a?\"nearest\":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:h,skipRasterFunction:\"raster\"===this.type&&null!=this.container.rasterFunctionChain,signal:r(i),srcResolution:this._srcResolutions[e.level],timeExtent:o.timeExtent,tileInfo:l,disableWrapAround:n};return this.fetchTile(e,c)}_getCacheSize(e){return e?40:0}_initializeTileInfo(){const{layerView:e}=this,t=e.view.spatialReference,i=new c({x:e.fullExtent.xmin,y:e.fullExtent.ymax,spatialReference:t});if(this._canUseLayerLODs()){const{lods:s}=this.layer.tileInfo,r=s.map((({scale:e})=>e)),a=p.create({spatialReference:t,size:C,scales:r}),o=t.isGeographic?.01*1e-5:.01;if(this._isCustomTilingScheme=Math.abs(a.origin.x-i.x)>o,(0===a.origin.x||a.origin.x>i.x)&&(a.origin=i),!this._isCustomTilingScheme){const e=p.create({spatialReference:t,size:C}).lods.map((({scale:e})=>e));this._isCustomTilingScheme=r.some((t=>!e.some((e=>Math.abs(e-t)<.001))))}return e.set(\"tileInfo\",a),void(this._srcResolutions=s.map((({resolution:e})=>({x:e,y:e}))))}const{scales:s,srcResolutions:r,isCustomTilingScheme:a}=b(this.layer.rasterInfo,t,C),o=p.create({spatialReference:t,size:C,scales:s});(0===o.origin.x||o.origin.x>i.x)&&(o.origin=i),this._isCustomTilingScheme=a,e.set(\"tileInfo\",o),this._srcResolutions=r??[]}_canUseLayerLODs(){const{layer:e,layerView:t}=this;if(\"Map\"!==e.raster.tileType)return!1;const{lods:i}=e.tileInfo,s=t.view.constraints?.effectiveLODs;if(!(s?.length===i.length&&s.every((({scale:e},t)=>Math.abs(e-i[t].scale)<.001))))return!1;const r=[];for(let a=0;a<i.length-1;a++)r.push(Math.round(10*i[a].resolution/i[a+1].resolution)/10);return r.some((e=>e!==e[0]))}_computeFetchConcurrency(){const{blockBoundary:e}=this.layer.rasterInfo.storageInfo,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}async _enqueueTileFetch(e,t){this.updatingHandles.addPromise(this._enqueueTileFetch1(e,t))}async _enqueueTileFetch1(e,t){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key),r=this._getBandIds();let a=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){a=!1;try{await this._redrawImage(this._abortController?.signal)}catch(s){o(s)&&i.getLogger(this.declaredClass).error(s)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&\"rasterVF\"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const l=this._tileInfoView.getTileCoords(T,e.key),n=this._tileInfoView.getTileResolution(e.key);await this.updateTileSource(e,{source:t,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:a,bandIds:r,coords:l,resolution:n}),e.once(\"attach\",(()=>this.layerView.requestUpdate())),this.container.addChild(e)}catch(s){o(s)||i.getLogger(this.declaredClass).error(s)}this.layerView.requestUpdate()}}async _redrawImage(e){if(0===this.container.children.length)return;await this.layer.updateRenderer(),this.layerView.hasTilingEffects?await this._updateGlobalSymbolizerParams(e):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null);const t=this.container.children.map((async e=>this.updateTileSymbolizerParameters(e,{local:this._symbolizerParams,global:this._globalSymbolizerParams})));await l(t),this.container.requestRender()}async _updateGlobalSymbolizerParams(e){const t={srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:e},i=await this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,t);if(!i||!i.pixelBlock)return;const{resolution:s}=this.previousLOD,r=this._getBandIds(),a=this.layer.symbolizer.generateWebGLParameters({pixelBlock:_(i.pixelBlock,r),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:s,y:s},bandIds:r});!this.canUseWebGLForProcessing()&&a&&\"stretch\"===a.type&&this.layer.renderer&&\"raster-stretch\"===this.layer.renderer.type&&(a.factor=a.factor.map((e=>255*e)),a.outMin=Math.round(255*a.outMin),a.outMax=Math.round(255*a.outMax)),this._globalSymbolizerParams=a}_updateSymbolizerParams(){const{resolution:e}=this.previousLOD,t=this._getBandIds();this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:e,y:e},bandIds:t})}_updateBlockCacheRegistry(e=!1){const{layer:t,layerView:i}=this,{url:s,raster:r}=t,{multidimensionalDefinition:a}=t.normalizeRasterFetchOptions({multidimensionalDefinition:t.multidimensionalDefinition,timeExtent:i.timeExtent}),o=r.rasterInfo.multidimensionalInfo?r.getSliceIndex(a):null,l=m(s,o);if(l!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&g(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=y(l,r.rasterInfo),e){const{view:e}=i,t=this._tileInfoView.getClosestInfoForScale(e.scale),s=this._srcResolutions[t.level];d(l,this._blockCacheRegistryId,e.extent,e.resolution,s,r.ioConfig.sampling)}this._blockCacheRegistryUrl=l}}async doRefresh(){if(!this.attached)return;await this.layer.updateRenderer(),this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset();const e=[];this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,this._tileStrategy.tiles.forEach((t=>e.push(this._enqueueTileFetch(t)))),await l(e)}};e([n()],v.prototype,\"_fetchQueue\",void 0),e([n()],v.prototype,\"_globalUpdateRequested\",void 0),e([n()],v.prototype,\"attached\",void 0),e([n()],v.prototype,\"container\",void 0),e([n()],v.prototype,\"layer\",void 0),e([n()],v.prototype,\"layerView\",void 0),e([n()],v.prototype,\"type\",void 0),e([n()],v.prototype,\"useWebGLForProcessing\",null),e([n()],v.prototype,\"useProgressiveUpdate\",null),e([n()],v.prototype,\"timeExtent\",void 0),e([n()],v.prototype,\"updating\",null),v=e([h(\"esri.views.2d.layers.imagery.BaseImageryTileSubView2D\")],v);export{v as BaseImageryTileSubView2D};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}