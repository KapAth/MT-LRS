{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/ClientApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../../core/Accessor.js\";\nimport has from \"../../../../../core/has.js\";\nimport { isNone as r, applySome as s, isSome as i, filterNones as a } from \"../../../../../core/maybe.js\";\nimport { ignoreAbortErrors as o, after as n, throwIfAborted as u, throwIfNotAbortError as g, isAbortError as h } from \"../../../../../core/promiseUtils.js\";\nimport { when as d, watch as c, whenOnce as l } from \"../../../../../core/reactiveUtils.js\";\nimport { property as p } from \"../../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../../core/arrayUtils.js\";\nimport { subclass as y } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport { convertToGeometry as f } from \"../../../../../layers/graphics/featureConversionUtils.js\";\nimport { QueryEngine as m } from \"../../../../../layers/graphics/data/QueryEngine.js\";\nimport S from \"../../../../../layers/support/FieldsIndex.js\";\nimport { FeatureStore2D as _ } from \"../FeatureStore2D.js\";\nimport { createSource as v } from \"../sources/createSource.js\";\nimport b from \"../support/AttributeStore.js\";\nimport { BinStore as I } from \"../support/BinStore.js\";\nimport { ClusterStore as Q } from \"../support/ClusterStore.js\";\nimport { ComputedAttributeStorage as C } from \"../support/ComputedAttributeStorage.js\";\nimport { FeatureSetReaderJSON as E } from \"../support/FeatureSetReaderJSON.js\";\nimport { UpdateToken as w } from \"../support/UpdateToken.js\";\nimport { QueueProcessor as F } from \"../../../../support/QueueProcessor.js\";\nconst T = 5e3,\n      k = \"tileRenderer.featuresView.attributeView.initialize\",\n      j = \"tileRenderer.featuresView.attributeView.requestUpdate\",\n      x = \"tileRenderer.featuresView.requestRender\";\n\nfunction R(e) {\n  return \"worker:port-closed\" === e.name;\n}\n\nfunction A(e) {\n  if (!h(e) && !R(e)) throw e;\n}\n\nfunction U(e) {\n  return \"feature\" === e.type && \"snapshot\" === e.mode;\n}\n\nlet q = class extends t {\n  constructor() {\n    super(...arguments), this._storage = new C(), this._markedIdsBufId = this._storage.createBitset(), this._lastCleanup = performance.now(), this._cleanupNeeded = !1, this._invalidated = !1, this._tileToResolver = new Map(), this._didEdit = !1, this._updateVersion = 1, this.tileStore = null, this.config = null, this.processor = null, this.remoteClient = null, this.service = null;\n  }\n\n  initialize() {\n    this._initStores(), this._initSource(), this._updateQueue = new F({\n      concurrency: \"stream\" === this._source.type ? 1 : 4,\n      process: (e, t) => this._onTileMessage(e, {\n        signal: t\n      })\n    }), this.addHandles([this.tileStore.on(\"update\", this.onTileUpdate.bind(this)), d(() => !this.updating, () => this.onIdle())]), this._checkUpdating = setInterval(() => this.notifyChange(\"updating\"), 300);\n  }\n\n  _initSource() {\n    const e = this.tileStore.tileScheme,\n          t = () => this._updateQueue && this._updateQueue.length < 50,\n          r = (e, t) => (this._invalidated = !0, this._patchTile(e, t));\n\n    this._source = v(this.service, this.spatialReference, e, r, t, this.featureStore), this._proxyEvents();\n  }\n\n  _proxyEvents() {\n    if (\"stream\" === this._source.type) {\n      const e = this._source.events,\n            t = this._source;\n      this.addHandles([c(() => t.connectionStatus, e => this.remoteClient.invoke(\"setProperty\", {\n        propertyName: \"connectionStatus\",\n        value: e\n      }).catch(A), {\n        initial: !0\n      }), c(() => t.errorString, e => this.remoteClient.invoke(\"setProperty\", {\n        propertyName: \"errorString\",\n        value: e\n      }).catch(A), {\n        initial: !0\n      }), e.on(\"data-received\", e => this.remoteClient.invoke(\"emitEvent\", {\n        name: \"data-received\",\n        event: {\n          attributes: e.attributes,\n          centroid: e.centroid,\n          geometry: e.geometry\n        }\n      }).catch(A)), e.on(\"message-received\", e => this.remoteClient.invoke(\"emitEvent\", {\n        name: \"message-received\",\n        event: e\n      }).catch(A)), e.on(\"updateRate\", e => this.remoteClient.invoke(\"emitEvent\", {\n        name: \"update-rate\",\n        event: { ...e\n        }\n      }).catch(A))]);\n    }\n  }\n\n  _initAttributeStore(e) {\n    this.attributeStore || (this.attributeStore = new b({\n      type: \"remote\",\n      initialize: (e, t) => o(this.remoteClient.invoke(k, e, {\n        signal: t\n      }).catch(A)),\n      update: (e, t) => o(this.remoteClient.invoke(j, e, {\n        signal: t\n      }).catch(A)),\n      render: e => o(this.remoteClient.invoke(x, void 0, {\n        signal: e\n      }).catch(A))\n    }, e, () => this.notifyChange(\"updating\")));\n  }\n\n  _initStores() {\n    const e = \"snapshot\" === this.service.type ? \"snapshot\" : \"on-demand\",\n          t = {\n      geometryInfo: {\n        geometryType: this.service.geometryType,\n        hasM: !1,\n        hasZ: !1\n      },\n      spatialReference: this.spatialReference,\n      fieldsIndex: this.fieldsIndex,\n      fields: this.service.fields\n    };\n    this.featureStore = new _(t, this._storage, e);\n  }\n\n  _initQueryEngine(e) {\n    const t = this;\n    this.featureQueryEngine?.destroy(), this.featureQueryEngine = new m({\n      definitionExpression: e.schema.source.definitionExpression ?? void 0,\n      fields: this.service.fields,\n      geometryType: this.service.geometryType,\n      objectIdField: this.service.objectIdField,\n      hasM: !1,\n      hasZ: !1,\n      spatialReference: this.spatialReference.toJSON(),\n      cacheSpatialQueries: !0,\n      featureStore: this.featureStore,\n      aggregateAdapter: {\n        getFeatureObjectIds(e) {\n          if (r(t.aggregateStore)) return [];\n          return t.aggregateStore.getFeatureDisplayIdsForAggregate(e).map(e => t.getObjectId(e));\n        }\n\n      },\n      timeInfo: this.service.timeInfo\n    });\n  }\n\n  _initAggregateQueryEngine(e, t) {\n    if (this.aggregateQueryEngine?.destroy(), r(e)) return;\n    const s = t.targets.aggregate.params.fields.slice();\n    this.aggregateQueryEngine = new m({\n      definitionExpression: void 0,\n      fields: s,\n      geometryType: e.geometryInfo.geometryType,\n      objectIdField: e.objectIdField,\n      hasM: e.geometryInfo.hasM,\n      hasZ: e.geometryInfo.hasZ,\n      spatialReference: this.spatialReference.toJSON(),\n      cacheSpatialQueries: !1,\n      featureStore: e,\n      aggregateAdapter: {\n        getFeatureObjectIds: e => []\n      }\n    });\n  }\n\n  destroy() {\n    this._updateQueue.destroy(), this._source.destroy(), this.featureQueryEngine?.destroy(), this.aggregateQueryEngine?.destroy(), this.attributeStore?.destroy();\n\n    for (const e of this.tileStore.tiles) this._source.unsubscribe(e);\n\n    clearInterval(this._checkUpdating);\n  }\n\n  get fieldsIndex() {\n    return new S(this.service.fields);\n  }\n\n  get spatialReference() {\n    return this.tileStore.tileScheme.spatialReference;\n  }\n\n  get updating() {\n    return this.isUpdating();\n  }\n\n  isUpdating() {\n    const e = this._source.updating,\n          t = !!this._updateQueue.length,\n          r = !this.attributeStore || this.attributeStore.isUpdating(),\n          s = e || t || r;\n    return has(\"esri-2d-log-updating\") && console.log(`Updating FeatureController2D: ${s}\\n  -> updatingSource ${e}\\n  -> updateQueue ${t}\\n  -> updatingAttributeStore ${r}\\n`), s;\n  }\n\n  updateCustomParameters(e) {\n    \"stream\" === this._source.type && this._source.updateCustomParameters(e);\n  }\n\n  enableEvent(e) {\n    this._source.enableEvent(e.name, e.value);\n  }\n\n  pause() {\n    this._updateQueue.pause(), this._updateQueue.clear();\n  }\n\n  resume() {\n    this._updateQueue.resume();\n  }\n\n  pauseStream() {\n    \"stream\" === this._source.type && this._source.pauseStream();\n  }\n\n  resumeStream() {\n    \"stream\" === this._source.type && this._source.resumeStream();\n  }\n\n  sendMessageToSocket(e) {\n    \"stream\" === this._source.type && this._source.sendMessageToSocket(e);\n  }\n\n  sendMessageToClient(e) {\n    \"stream\" === this._source.type && this._source.sendMessageToClient(e);\n  }\n\n  _initAggregateStore(e) {\n    const t = e.schema.targets?.aggregate?.type,\n          r = s(this.config, e => e.schema.targets?.aggregate?.type);\n\n    if (r !== t && (i(this.aggregateStore) && (this.removeHandles(\"valueRangesChanged\"), this.aggregateStore.destroy(), this.aggregateStore = null), t)) {\n      switch (t) {\n        case \"cluster\":\n          {\n            const e = {\n              geometryInfo: {\n                geometryType: \"esriGeometryPoint\",\n                hasM: !1,\n                hasZ: !1\n              },\n              spatialReference: this.spatialReference,\n              fieldsIndex: this.fieldsIndex,\n              fields: this.service.fields\n            };\n            this.aggregateStore = new Q(e, this.spatialReference, this._storage, this.service), this.addHandles(this.aggregateStore.events.on(\"valueRangesChanged\", e => {\n              this.remoteClient.invoke(\"emitEvent\", {\n                name: \"valueRangesChanged\",\n                event: {\n                  valueRanges: e.valueRanges\n                }\n              }).catch(A);\n            }), \"valueRangesChanged\");\n            break;\n          }\n\n        case \"bin\":\n          {\n            const e = {\n              geometryInfo: {\n                geometryType: \"esriGeometryPolygon\",\n                hasM: !1,\n                hasZ: !1\n              },\n              spatialReference: this.spatialReference,\n              fieldsIndex: this.fieldsIndex,\n              fields: this.service.fields\n            };\n            this.aggregateStore = new I(e, this.spatialReference, this._storage, this.service);\n            break;\n          }\n      }\n\n      this.aggregateStore.onTileUpdate({\n        added: this.tileStore.tiles,\n        removed: []\n      });\n    }\n  }\n\n  update(e, t) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this._updateVersion++, _this._initQueryEngine(t), _this._initAttributeStore(t), _this.pause(), yield Promise.all([_this._source.update(e, t.schema.source), _this.featureStore.updateSchema(e, t.schema.targets.feature), _this.attributeStore.update(e, t), _this.attributeStore.updateFilters(e, t, _this)]), _this._initAggregateStore(t), i(_this.aggregateStore) && (yield _this.aggregateStore.updateSchema(e, t.schema.targets.aggregate)), _this._initAggregateQueryEngine(_this.aggregateStore, t.schema), has(\"esri-2d-update-debug\") && e.describe(), _this._set(\"config\", t);\n    })();\n  }\n\n  applyUpdate(e) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      e.version = _this2._updateVersion, has(\"esri-2d-update-debug\") && console.debug(`Applying update ${e.version}`), e.mesh && _this2.clearTiles(), _this2._updateQueue.resume(), yield _this2._source.applyUpdate(e), _this2.notifyChange(\"updating\"), yield l(() => !_this2.updating), i(_this2.aggregateStore) && (yield n(10), yield l(() => !_this2.updating));\n    })();\n  }\n\n  onEdits({\n    edits: e\n  }) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      has(\"esri-2d-update-debug\") && console.debug(\"Applying Edit:\", e), _this3._didEdit = !0;\n\n      try {\n        const t = e.removed.map(e => e.objectId && -1 !== e.objectId ? e.objectId : _this3._lookupObjectIdByGlobalId(e.globalId)),\n              r = e.addOrModified.map(({\n          objectId: e\n        }) => e);\n        _this3.featureStore.invalidate(), yield _this3._source.edit(r, t), _this3.clearTiles(), _this3.notifyChange(\"updating\"), i(_this3.aggregateStore) && _this3.aggregateStore.clear(), yield _this3._source.resend(), yield l(() => !_this3.updating);\n      } catch (t) {}\n    })();\n  }\n\n  refresh(e) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      if (!e.dataChanged) {\n        const e = w.empty();\n        return e.storage.filters = !0, _this4.applyUpdate(e);\n      }\n\n      _this4.featureStore.invalidate(), _this4.clearTiles(), _this4._source.refresh(_this4._updateVersion, e), _this4._cleanupNeeded = !0, _this4.notifyChange(\"updating\"), yield l(() => !_this4.updating);\n    })();\n  }\n\n  clearTiles() {\n    for (const e of this.tileStore.tiles) this.processor.onTileClear(e);\n  }\n\n  onTileUpdate(e) {\n    i(this.aggregateStore) && this.aggregateStore.onTileUpdate(e);\n\n    for (const t of e.added) this._source.subscribe(t, this._updateVersion), this._level = t.level;\n\n    for (const t of e.removed) this._source.unsubscribe(t), this._cleanupNeeded = !0, this._tileToResolver.has(t.id) && (this._tileToResolver.get(t.id).resolve(), this._tileToResolver.delete(t.id));\n\n    this.notifyChange(\"updating\");\n  }\n\n  onIdle() {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      _this5._invalidated && (_this5._invalidated = !1, (i(_this5.aggregateStore) || \"heatmap\" === _this5.processor.type) && (yield _this5._repushCurrentLevelTiles())), _this5._markAndSweep();\n    })();\n  }\n\n  querySummaryStatistics({\n    query: e,\n    params: t\n  }) {\n    var _this6 = this;\n\n    return _asyncToGenerator(function* () {\n      return _this6.featureQueryEngine.executeQueryForSummaryStatistics(e, t);\n    })();\n  }\n\n  queryAggregateSummaryStatistics({\n    query: e,\n    params: t\n  }) {\n    var _this7 = this;\n\n    return _asyncToGenerator(function* () {\n      return _this7.aggregateQueryEngine.executeQueryForSummaryStatistics(e, t);\n    })();\n  }\n\n  queryUniqueValues({\n    query: e,\n    params: t\n  }) {\n    var _this8 = this;\n\n    return _asyncToGenerator(function* () {\n      return _this8.featureQueryEngine.executeQueryForUniqueValues(e, t);\n    })();\n  }\n\n  queryAggregateUniqueValues({\n    query: e,\n    params: t\n  }) {\n    var _this9 = this;\n\n    return _asyncToGenerator(function* () {\n      return _this9.aggregateQueryEngine.executeQueryForUniqueValues(e, t);\n    })();\n  }\n\n  queryClassBreaks({\n    query: e,\n    params: t\n  }) {\n    var _this10 = this;\n\n    return _asyncToGenerator(function* () {\n      return _this10.featureQueryEngine.executeQueryForClassBreaks(e, t);\n    })();\n  }\n\n  queryAggregateClassBreaks({\n    query: e,\n    params: t\n  }) {\n    var _this11 = this;\n\n    return _asyncToGenerator(function* () {\n      return _this11.aggregateQueryEngine.executeQueryForClassBreaks(e, t);\n    })();\n  }\n\n  queryHistogram({\n    query: e,\n    params: t\n  }) {\n    var _this12 = this;\n\n    return _asyncToGenerator(function* () {\n      return _this12.featureQueryEngine.executeQueryForHistogram(e, t);\n    })();\n  }\n\n  queryAggregateHistogram({\n    query: e,\n    params: t\n  }) {\n    var _this13 = this;\n\n    return _asyncToGenerator(function* () {\n      return _this13.aggregateQueryEngine.executeQueryForHistogram(e, t);\n    })();\n  }\n\n  queryExtent(e) {\n    return this.featureQueryEngine.executeQueryForExtent(e);\n  }\n\n  queryAggregates(e) {\n    return this.aggregateQueryEngine.executeQuery(e);\n  }\n\n  queryAggregateCount(e) {\n    return this.aggregateQueryEngine.executeQueryForCount(e);\n  }\n\n  queryAggregateIds(e) {\n    return this.aggregateQueryEngine.executeQueryForIds(e);\n  }\n\n  queryFeatures(e) {\n    return this.featureQueryEngine.executeQuery(e);\n  }\n\n  queryVisibleFeatures(e) {\n    var _this14 = this;\n\n    return _asyncToGenerator(function* () {\n      const t = yield _this14.featureQueryEngine.executeQuery(e),\n            r = t.objectIdFieldName;\n      return t.features = t.features.filter(e => {\n        const t = e.attributes[r],\n              i = _this14.getDisplayId(t);\n\n        return s(i, e => _this14.attributeStore.isVisible(e));\n      }), t;\n    })();\n  }\n\n  queryFeatureCount(e) {\n    return this.featureQueryEngine.executeQueryForCount(e);\n  }\n\n  queryLatestObservations(e) {\n    return this.featureQueryEngine.executeQueryForLatestObservations(e);\n  }\n\n  queryObjectIds(e) {\n    return this.featureQueryEngine.executeQueryForIds(e);\n  }\n\n  queryStatistics() {\n    var _this15 = this;\n\n    return _asyncToGenerator(function* () {\n      return _this15.featureStore.storeStatistics;\n    })();\n  }\n\n  getObjectId(e) {\n    return this.featureStore.lookupObjectId(e, this._storage);\n  }\n\n  getDisplayId(e) {\n    if (i(this.aggregateStore)) {\n      const t = this.aggregateStore.getDisplayId(e);\n\n      if (r(t)) {\n        const t = this.featureStore.lookupDisplayId(e);\n        return this.aggregateStore.getDisplayIdForReferenceId(t);\n      }\n\n      return t;\n    }\n\n    return this.featureStore.lookupDisplayId(e);\n  }\n\n  getFeatures(e) {\n    const t = [],\n          r = [];\n\n    for (const s of e) {\n      const e = i(this.aggregateStore) ? this.getAggregate(s) : null;\n      if (i(e)) {\n        if (i(e.attributes.referenceId)) {\n          const r = this.getFeature(e.attributes.referenceId);\n          i(r) && t.push(r);\n        } else r.push(e);\n      } else {\n        const e = this.getFeature(s);\n        i(e) && t.push(e);\n      }\n    }\n\n    return {\n      features: t,\n      aggregates: r\n    };\n  }\n\n  getFeature(e) {\n    const t = this.featureStore.lookupFeatureByDisplayId(e, this._storage);\n    if (r(t)) return null;\n    const s = t.readHydratedGeometry(),\n          i = f(s, t.geometryType, t.hasZ, t.hasM);\n    return {\n      attributes: t.readAttributes(),\n      geometry: i\n    };\n  }\n\n  getAggregate(e) {\n    return r(this.aggregateStore) ? null : this.aggregateStore.getAggregate(e);\n  }\n\n  getAggregates() {\n    return r(this.aggregateStore) ? [] : this.aggregateStore.getAggregates();\n  }\n\n  setHighlight(e) {\n    var _this16 = this;\n\n    return _asyncToGenerator(function* () {\n      const t = a(e.map(e => _this16.getDisplayId(e)));\n      return _this16.attributeStore.setHighlight(e, t);\n    })();\n  }\n\n  _lookupObjectIdByGlobalId(e) {\n    const t = this.service.globalIdField;\n    if (r(t)) throw new Error(\"Expected globalIdField to be defined\");\n    let s = null;\n    if (this.featureStore.forEach(r => {\n      e === r.readAttribute(t) && (s = r.getObjectId());\n    }), r(s)) throw new Error(`Expected to find a feature with globalId ${e}`);\n    return s;\n  }\n\n  _repushCurrentLevelTiles() {\n    var _this17 = this;\n\n    return _asyncToGenerator(function* () {\n      const e = _this17.tileStore.tiles.filter(e => e.level === _this17._level);\n\n      e.map( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (e) {\n          return _this17._patchTile({\n            type: \"append\",\n            id: e.key.id,\n            clear: !0,\n            addOrUpdate: null,\n            end: !1\n          });\n        });\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n      const t = e.map( /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator(function* (e) {\n          return _this17._patchTile({\n            type: \"append\",\n            id: e.key.id,\n            addOrUpdate: E.fromOptimizedFeatures([], _this17.service),\n            remove: [],\n            end: !0,\n            isRepush: !0,\n            status: w.empty()\n          });\n        });\n\n        return function (_x2) {\n          return _ref2.apply(this, arguments);\n        };\n      }());\n      yield Promise.all(t);\n    })();\n  }\n\n  _maybeForceCleanup() {\n    performance.now() - this._lastCleanup > T && this._markAndSweep();\n  }\n\n  _patchTile(e, t) {\n    const r = this._updateQueue.push(e, t).then(() => {\n      this.notifyChange(\"updating\");\n    }).catch(e => {\n      this.notifyChange(\"updating\");\n    });\n\n    return this.notifyChange(\"updating\"), r;\n  }\n\n  _onTileMessage(e, t) {\n    var _this18 = this;\n\n    return _asyncToGenerator(function* () {\n      if (u(t), has(\"esri-2d-update-debug\")) {\n        const t = s(e.addOrUpdate, e => e.hasFeatures);\n        console.debug(e.id, `FeatureController:onTileMessage: [clear:${e.clear}, end:${e.end}, features: ${t}]`);\n      }\n\n      const a = _this18.tileStore.get(e.id);\n\n      if (!a) return;\n      if (e.clear) return _this18.processor.onTileClear(a);\n      const o = e.status;\n      _this18._cleanupNeeded = !0;\n      const n = [];\n\n      for (const r of e.remove ?? []) {\n        const e = _this18.featureStore.lookupDisplayId(r);\n\n        e && n.push(e);\n      }\n\n      e.remove = n;\n\n      try {\n        if (r(e.addOrUpdate)) return void _this18.processor.onTileMessage(a, { ...e,\n          addOrUpdate: null\n        }, i(_this18.aggregateStore), t).catch(g);\n\n        if (e.addOrUpdate.setArcadeSpatialReference(_this18.spatialReference), _this18.featureStore.hasInstance(e.addOrUpdate.instance) && o.targets.feature || (o.targets.feature = !0, _this18.featureStore.onTileData(a, e)), !o.storage.data || !o.storage.filters) {\n          o.storage.data = !0, o.storage.filters = !0, _this18.attributeStore.onTileData(a, e);\n          \"stream\" === _this18._source.type || _this18._didEdit ? (yield _this18.attributeStore.sendUpdates(), u(t)) : _this18.attributeStore.sendUpdates();\n        }\n\n        if (i(_this18.aggregateStore) && !o.targets.aggregate) {\n          o.targets.aggregate = !0;\n\n          const t = U(_this18._source) && _this18._source.loading,\n                r = !U(_this18._source) || t || e.end;\n\n          if (_this18.aggregateStore.onTileData(a, e, _this18._storage, _this18.attributeStore, r), !r) return;\n          o.mesh || (_this18.attributeStore.onTileData(a, e), yield _this18.attributeStore.sendUpdates());\n        }\n\n        if (!o.mesh) {\n          o.mesh = !0;\n\n          const r = i(_this18.aggregateStore) && \"cluster\" === _this18.aggregateStore.type;\n\n          yield _this18.processor.onTileMessage(a, e, r, t), u(t);\n        }\n\n        _this18._maybeForceCleanup();\n      } catch (h) {\n        g(h);\n      }\n    })();\n  }\n\n  _mark(e, t, r) {\n    const s = (4294901760 & this._storage.getInstanceId(e)) >>> 16;\n    e && (t.add(s), r.set(e));\n  }\n\n  _markAndSweep() {\n    this._lastCleanup = performance.now();\n    if (!(!(\"feature\" === this._source.type && \"snapshot\" === this._source.mode) && (\"stream\" === this._source.type || this._cleanupNeeded))) return;\n    this._cleanupNeeded = !1;\n\n    const e = this._storage.getBitset(this._markedIdsBufId),\n          t = new Set();\n\n    e.clear();\n\n    for (const r of this.tileStore.tiles) for (const s of this._source.readers(r.id)) {\n      const r = s.getCursor();\n\n      for (; r.next();) {\n        let s = r.getDisplayId();\n\n        if (!s) {\n          const e = r.getObjectId();\n          s = this.featureStore.lookupDisplayId(e);\n        }\n\n        this._mark(s, t, e);\n      }\n    }\n\n    \"symbol\" === this.processor.type && this.processor.forEachBufferId(r => {\n      this._mark(r, t, e);\n    }), this._updateQueue.forEach(r => {\n      for (const s of r.remove ?? []) {\n        const r = this.featureStore.lookupDisplayId(s);\n\n        this._mark(r, t, e);\n      }\n    }), i(this.aggregateStore) && (this.aggregateStore.sweepFeatures(e, this.featureStore), \"sweepAggregates\" in this.aggregateStore && this.aggregateStore.sweepAggregates(this._storage, this.attributeStore, this._level)), this.featureStore.sweepFeatures(e, this._storage, this.attributeStore), this.featureStore.sweepFeatureSets(t);\n  }\n\n};\ne([p({\n  constructOnly: !0\n})], q.prototype, \"tileStore\", void 0), e([p()], q.prototype, \"config\", void 0), e([p({\n  readOnly: !0\n})], q.prototype, \"fieldsIndex\", null), e([p()], q.prototype, \"processor\", void 0), e([p({\n  constructOnly: !0\n})], q.prototype, \"remoteClient\", void 0), e([p({\n  constructOnly: !0\n})], q.prototype, \"service\", void 0), e([p()], q.prototype, \"spatialReference\", null), e([p()], q.prototype, \"updating\", null), q = e([y(\"esri.views.2d.layers.features.controllers.FeatureController2D\")], q);\nconst O = q;\nexport { O as default };","map":{"version":3,"names":["_","e","t","has","isNone","r","applySome","s","isSome","i","filterNones","a","ignoreAbortErrors","o","after","n","throwIfAborted","u","throwIfNotAbortError","g","isAbortError","h","when","d","watch","c","whenOnce","l","property","p","subclass","y","convertToGeometry","f","QueryEngine","m","S","FeatureStore2D","createSource","v","b","BinStore","I","ClusterStore","Q","ComputedAttributeStorage","C","FeatureSetReaderJSON","E","UpdateToken","w","QueueProcessor","F","T","k","j","x","R","name","A","U","type","mode","q","constructor","arguments","_storage","_markedIdsBufId","createBitset","_lastCleanup","performance","now","_cleanupNeeded","_invalidated","_tileToResolver","Map","_didEdit","_updateVersion","tileStore","config","processor","remoteClient","service","initialize","_initStores","_initSource","_updateQueue","concurrency","_source","process","_onTileMessage","signal","addHandles","on","onTileUpdate","bind","updating","onIdle","_checkUpdating","setInterval","notifyChange","tileScheme","length","_patchTile","spatialReference","featureStore","_proxyEvents","events","connectionStatus","invoke","propertyName","value","catch","initial","errorString","event","attributes","centroid","geometry","_initAttributeStore","attributeStore","update","render","geometryInfo","geometryType","hasM","hasZ","fieldsIndex","fields","_initQueryEngine","featureQueryEngine","destroy","definitionExpression","schema","source","objectIdField","toJSON","cacheSpatialQueries","aggregateAdapter","getFeatureObjectIds","aggregateStore","getFeatureDisplayIdsForAggregate","map","getObjectId","timeInfo","_initAggregateQueryEngine","aggregateQueryEngine","targets","aggregate","params","slice","tiles","unsubscribe","clearInterval","isUpdating","console","log","updateCustomParameters","enableEvent","pause","clear","resume","pauseStream","resumeStream","sendMessageToSocket","sendMessageToClient","_initAggregateStore","removeHandles","valueRanges","added","removed","Promise","all","updateSchema","feature","updateFilters","describe","_set","applyUpdate","version","debug","mesh","clearTiles","onEdits","edits","objectId","_lookupObjectIdByGlobalId","globalId","addOrModified","invalidate","edit","resend","refresh","dataChanged","empty","storage","filters","onTileClear","subscribe","_level","level","id","get","resolve","delete","_repushCurrentLevelTiles","_markAndSweep","querySummaryStatistics","query","executeQueryForSummaryStatistics","queryAggregateSummaryStatistics","queryUniqueValues","executeQueryForUniqueValues","queryAggregateUniqueValues","queryClassBreaks","executeQueryForClassBreaks","queryAggregateClassBreaks","queryHistogram","executeQueryForHistogram","queryAggregateHistogram","queryExtent","executeQueryForExtent","queryAggregates","executeQuery","queryAggregateCount","executeQueryForCount","queryAggregateIds","executeQueryForIds","queryFeatures","queryVisibleFeatures","objectIdFieldName","features","filter","getDisplayId","isVisible","queryFeatureCount","queryLatestObservations","executeQueryForLatestObservations","queryObjectIds","queryStatistics","storeStatistics","lookupObjectId","lookupDisplayId","getDisplayIdForReferenceId","getFeatures","getAggregate","referenceId","getFeature","push","aggregates","lookupFeatureByDisplayId","readHydratedGeometry","readAttributes","getAggregates","setHighlight","globalIdField","Error","forEach","readAttribute","key","addOrUpdate","end","fromOptimizedFeatures","remove","isRepush","status","_maybeForceCleanup","then","hasFeatures","onTileMessage","setArcadeSpatialReference","hasInstance","instance","onTileData","data","sendUpdates","loading","_mark","getInstanceId","add","set","getBitset","Set","readers","getCursor","next","forEachBufferId","sweepFeatures","sweepAggregates","sweepFeatureSets","constructOnly","prototype","readOnly","O","default"],"sources":["C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/node_modules/@arcgis/core/views/2d/layers/features/controllers/FeatureController2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import t from\"../../../../../core/Accessor.js\";import has from\"../../../../../core/has.js\";import{isNone as r,applySome as s,isSome as i,filterNones as a}from\"../../../../../core/maybe.js\";import{ignoreAbortErrors as o,after as n,throwIfAborted as u,throwIfNotAbortError as g,isAbortError as h}from\"../../../../../core/promiseUtils.js\";import{when as d,watch as c,whenOnce as l}from\"../../../../../core/reactiveUtils.js\";import{property as p}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/arrayUtils.js\";import{subclass as y}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{convertToGeometry as f}from\"../../../../../layers/graphics/featureConversionUtils.js\";import{QueryEngine as m}from\"../../../../../layers/graphics/data/QueryEngine.js\";import S from\"../../../../../layers/support/FieldsIndex.js\";import{FeatureStore2D as _}from\"../FeatureStore2D.js\";import{createSource as v}from\"../sources/createSource.js\";import b from\"../support/AttributeStore.js\";import{BinStore as I}from\"../support/BinStore.js\";import{ClusterStore as Q}from\"../support/ClusterStore.js\";import{ComputedAttributeStorage as C}from\"../support/ComputedAttributeStorage.js\";import{FeatureSetReaderJSON as E}from\"../support/FeatureSetReaderJSON.js\";import{UpdateToken as w}from\"../support/UpdateToken.js\";import{QueueProcessor as F}from\"../../../../support/QueueProcessor.js\";const T=5e3,k=\"tileRenderer.featuresView.attributeView.initialize\",j=\"tileRenderer.featuresView.attributeView.requestUpdate\",x=\"tileRenderer.featuresView.requestRender\";function R(e){return\"worker:port-closed\"===e.name}function A(e){if(!h(e)&&!R(e))throw e}function U(e){return\"feature\"===e.type&&\"snapshot\"===e.mode}let q=class extends t{constructor(){super(...arguments),this._storage=new C,this._markedIdsBufId=this._storage.createBitset(),this._lastCleanup=performance.now(),this._cleanupNeeded=!1,this._invalidated=!1,this._tileToResolver=new Map,this._didEdit=!1,this._updateVersion=1,this.tileStore=null,this.config=null,this.processor=null,this.remoteClient=null,this.service=null}initialize(){this._initStores(),this._initSource(),this._updateQueue=new F({concurrency:\"stream\"===this._source.type?1:4,process:(e,t)=>this._onTileMessage(e,{signal:t})}),this.addHandles([this.tileStore.on(\"update\",this.onTileUpdate.bind(this)),d((()=>!this.updating),(()=>this.onIdle()))]),this._checkUpdating=setInterval((()=>this.notifyChange(\"updating\")),300)}_initSource(){const e=this.tileStore.tileScheme,t=()=>this._updateQueue&&this._updateQueue.length<50,r=(e,t)=>(this._invalidated=!0,this._patchTile(e,t));this._source=v(this.service,this.spatialReference,e,r,t,this.featureStore),this._proxyEvents()}_proxyEvents(){if(\"stream\"===this._source.type){const e=this._source.events,t=this._source;this.addHandles([c((()=>t.connectionStatus),(e=>this.remoteClient.invoke(\"setProperty\",{propertyName:\"connectionStatus\",value:e}).catch(A)),{initial:!0}),c((()=>t.errorString),(e=>this.remoteClient.invoke(\"setProperty\",{propertyName:\"errorString\",value:e}).catch(A)),{initial:!0}),e.on(\"data-received\",(e=>this.remoteClient.invoke(\"emitEvent\",{name:\"data-received\",event:{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry}}).catch(A))),e.on(\"message-received\",(e=>this.remoteClient.invoke(\"emitEvent\",{name:\"message-received\",event:e}).catch(A))),e.on(\"updateRate\",(e=>this.remoteClient.invoke(\"emitEvent\",{name:\"update-rate\",event:{...e}}).catch(A)))])}}_initAttributeStore(e){this.attributeStore||(this.attributeStore=new b({type:\"remote\",initialize:(e,t)=>o(this.remoteClient.invoke(k,e,{signal:t}).catch(A)),update:(e,t)=>o(this.remoteClient.invoke(j,e,{signal:t}).catch(A)),render:e=>o(this.remoteClient.invoke(x,void 0,{signal:e}).catch(A))},e,(()=>this.notifyChange(\"updating\"))))}_initStores(){const e=\"snapshot\"===this.service.type?\"snapshot\":\"on-demand\",t={geometryInfo:{geometryType:this.service.geometryType,hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields};this.featureStore=new _(t,this._storage,e)}_initQueryEngine(e){const t=this;this.featureQueryEngine?.destroy(),this.featureQueryEngine=new m({definitionExpression:e.schema.source.definitionExpression??void 0,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:this.featureStore,aggregateAdapter:{getFeatureObjectIds(e){if(r(t.aggregateStore))return[];return t.aggregateStore.getFeatureDisplayIdsForAggregate(e).map((e=>t.getObjectId(e)))}},timeInfo:this.service.timeInfo})}_initAggregateQueryEngine(e,t){if(this.aggregateQueryEngine?.destroy(),r(e))return;const s=t.targets.aggregate.params.fields.slice();this.aggregateQueryEngine=new m({definitionExpression:void 0,fields:s,geometryType:e.geometryInfo.geometryType,objectIdField:e.objectIdField,hasM:e.geometryInfo.hasM,hasZ:e.geometryInfo.hasZ,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!1,featureStore:e,aggregateAdapter:{getFeatureObjectIds:e=>[]}})}destroy(){this._updateQueue.destroy(),this._source.destroy(),this.featureQueryEngine?.destroy(),this.aggregateQueryEngine?.destroy(),this.attributeStore?.destroy();for(const e of this.tileStore.tiles)this._source.unsubscribe(e);clearInterval(this._checkUpdating)}get fieldsIndex(){return new S(this.service.fields)}get spatialReference(){return this.tileStore.tileScheme.spatialReference}get updating(){return this.isUpdating()}isUpdating(){const e=this._source.updating,t=!!this._updateQueue.length,r=!this.attributeStore||this.attributeStore.isUpdating(),s=e||t||r;return has(\"esri-2d-log-updating\")&&console.log(`Updating FeatureController2D: ${s}\\n  -> updatingSource ${e}\\n  -> updateQueue ${t}\\n  -> updatingAttributeStore ${r}\\n`),s}updateCustomParameters(e){\"stream\"===this._source.type&&this._source.updateCustomParameters(e)}enableEvent(e){this._source.enableEvent(e.name,e.value)}pause(){this._updateQueue.pause(),this._updateQueue.clear()}resume(){this._updateQueue.resume()}pauseStream(){\"stream\"===this._source.type&&this._source.pauseStream()}resumeStream(){\"stream\"===this._source.type&&this._source.resumeStream()}sendMessageToSocket(e){\"stream\"===this._source.type&&this._source.sendMessageToSocket(e)}sendMessageToClient(e){\"stream\"===this._source.type&&this._source.sendMessageToClient(e)}_initAggregateStore(e){const t=e.schema.targets?.aggregate?.type,r=s(this.config,(e=>e.schema.targets?.aggregate?.type));if(r!==t&&(i(this.aggregateStore)&&(this.removeHandles(\"valueRangesChanged\"),this.aggregateStore.destroy(),this.aggregateStore=null),t)){switch(t){case\"cluster\":{const e={geometryInfo:{geometryType:\"esriGeometryPoint\",hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields};this.aggregateStore=new Q(e,this.spatialReference,this._storage,this.service),this.addHandles(this.aggregateStore.events.on(\"valueRangesChanged\",(e=>{this.remoteClient.invoke(\"emitEvent\",{name:\"valueRangesChanged\",event:{valueRanges:e.valueRanges}}).catch(A)})),\"valueRangesChanged\");break}case\"bin\":{const e={geometryInfo:{geometryType:\"esriGeometryPolygon\",hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields};this.aggregateStore=new I(e,this.spatialReference,this._storage,this.service);break}}this.aggregateStore.onTileUpdate({added:this.tileStore.tiles,removed:[]})}}async update(e,t){this._updateVersion++,this._initQueryEngine(t),this._initAttributeStore(t),this.pause(),await Promise.all([this._source.update(e,t.schema.source),this.featureStore.updateSchema(e,t.schema.targets.feature),this.attributeStore.update(e,t),this.attributeStore.updateFilters(e,t,this)]),this._initAggregateStore(t),i(this.aggregateStore)&&await this.aggregateStore.updateSchema(e,t.schema.targets.aggregate),this._initAggregateQueryEngine(this.aggregateStore,t.schema),has(\"esri-2d-update-debug\")&&e.describe(),this._set(\"config\",t)}async applyUpdate(e){e.version=this._updateVersion,has(\"esri-2d-update-debug\")&&console.debug(`Applying update ${e.version}`),e.mesh&&this.clearTiles(),this._updateQueue.resume(),await this._source.applyUpdate(e),this.notifyChange(\"updating\"),await l((()=>!this.updating)),i(this.aggregateStore)&&(await n(10),await l((()=>!this.updating)))}async onEdits({edits:e}){has(\"esri-2d-update-debug\")&&console.debug(\"Applying Edit:\",e),this._didEdit=!0;try{const t=e.removed.map((e=>e.objectId&&-1!==e.objectId?e.objectId:this._lookupObjectIdByGlobalId(e.globalId))),r=e.addOrModified.map((({objectId:e})=>e));this.featureStore.invalidate(),await this._source.edit(r,t),this.clearTiles(),this.notifyChange(\"updating\"),i(this.aggregateStore)&&this.aggregateStore.clear(),await this._source.resend(),await l((()=>!this.updating))}catch(t){}}async refresh(e){if(!e.dataChanged){const e=w.empty();return e.storage.filters=!0,this.applyUpdate(e)}this.featureStore.invalidate(),this.clearTiles(),this._source.refresh(this._updateVersion,e),this._cleanupNeeded=!0,this.notifyChange(\"updating\"),await l((()=>!this.updating))}clearTiles(){for(const e of this.tileStore.tiles)this.processor.onTileClear(e)}onTileUpdate(e){i(this.aggregateStore)&&this.aggregateStore.onTileUpdate(e);for(const t of e.added)this._source.subscribe(t,this._updateVersion),this._level=t.level;for(const t of e.removed)this._source.unsubscribe(t),this._cleanupNeeded=!0,this._tileToResolver.has(t.id)&&(this._tileToResolver.get(t.id).resolve(),this._tileToResolver.delete(t.id));this.notifyChange(\"updating\")}async onIdle(){this._invalidated&&(this._invalidated=!1,(i(this.aggregateStore)||\"heatmap\"===this.processor.type)&&await this._repushCurrentLevelTiles()),this._markAndSweep()}async querySummaryStatistics({query:e,params:t}){return this.featureQueryEngine.executeQueryForSummaryStatistics(e,t)}async queryAggregateSummaryStatistics({query:e,params:t}){return this.aggregateQueryEngine.executeQueryForSummaryStatistics(e,t)}async queryUniqueValues({query:e,params:t}){return this.featureQueryEngine.executeQueryForUniqueValues(e,t)}async queryAggregateUniqueValues({query:e,params:t}){return this.aggregateQueryEngine.executeQueryForUniqueValues(e,t)}async queryClassBreaks({query:e,params:t}){return this.featureQueryEngine.executeQueryForClassBreaks(e,t)}async queryAggregateClassBreaks({query:e,params:t}){return this.aggregateQueryEngine.executeQueryForClassBreaks(e,t)}async queryHistogram({query:e,params:t}){return this.featureQueryEngine.executeQueryForHistogram(e,t)}async queryAggregateHistogram({query:e,params:t}){return this.aggregateQueryEngine.executeQueryForHistogram(e,t)}queryExtent(e){return this.featureQueryEngine.executeQueryForExtent(e)}queryAggregates(e){return this.aggregateQueryEngine.executeQuery(e)}queryAggregateCount(e){return this.aggregateQueryEngine.executeQueryForCount(e)}queryAggregateIds(e){return this.aggregateQueryEngine.executeQueryForIds(e)}queryFeatures(e){return this.featureQueryEngine.executeQuery(e)}async queryVisibleFeatures(e){const t=await this.featureQueryEngine.executeQuery(e),r=t.objectIdFieldName;return t.features=t.features.filter((e=>{const t=e.attributes[r],i=this.getDisplayId(t);return s(i,(e=>this.attributeStore.isVisible(e)))})),t}queryFeatureCount(e){return this.featureQueryEngine.executeQueryForCount(e)}queryLatestObservations(e){return this.featureQueryEngine.executeQueryForLatestObservations(e)}queryObjectIds(e){return this.featureQueryEngine.executeQueryForIds(e)}async queryStatistics(){return this.featureStore.storeStatistics}getObjectId(e){return this.featureStore.lookupObjectId(e,this._storage)}getDisplayId(e){if(i(this.aggregateStore)){const t=this.aggregateStore.getDisplayId(e);if(r(t)){const t=this.featureStore.lookupDisplayId(e);return this.aggregateStore.getDisplayIdForReferenceId(t)}return t}return this.featureStore.lookupDisplayId(e)}getFeatures(e){const t=[],r=[];for(const s of e){const e=i(this.aggregateStore)?this.getAggregate(s):null;if(i(e))if(i(e.attributes.referenceId)){const r=this.getFeature(e.attributes.referenceId);i(r)&&t.push(r)}else r.push(e);else{const e=this.getFeature(s);i(e)&&t.push(e)}}return{features:t,aggregates:r}}getFeature(e){const t=this.featureStore.lookupFeatureByDisplayId(e,this._storage);if(r(t))return null;const s=t.readHydratedGeometry(),i=f(s,t.geometryType,t.hasZ,t.hasM);return{attributes:t.readAttributes(),geometry:i}}getAggregate(e){return r(this.aggregateStore)?null:this.aggregateStore.getAggregate(e)}getAggregates(){return r(this.aggregateStore)?[]:this.aggregateStore.getAggregates()}async setHighlight(e){const t=a(e.map((e=>this.getDisplayId(e))));return this.attributeStore.setHighlight(e,t)}_lookupObjectIdByGlobalId(e){const t=this.service.globalIdField;if(r(t))throw new Error(\"Expected globalIdField to be defined\");let s=null;if(this.featureStore.forEach((r=>{e===r.readAttribute(t)&&(s=r.getObjectId())})),r(s))throw new Error(`Expected to find a feature with globalId ${e}`);return s}async _repushCurrentLevelTiles(){const e=this.tileStore.tiles.filter((e=>e.level===this._level));e.map((async e=>this._patchTile({type:\"append\",id:e.key.id,clear:!0,addOrUpdate:null,end:!1})));const t=e.map((async e=>this._patchTile({type:\"append\",id:e.key.id,addOrUpdate:E.fromOptimizedFeatures([],this.service),remove:[],end:!0,isRepush:!0,status:w.empty()})));await Promise.all(t)}_maybeForceCleanup(){performance.now()-this._lastCleanup>T&&this._markAndSweep()}_patchTile(e,t){const r=this._updateQueue.push(e,t).then((()=>{this.notifyChange(\"updating\")})).catch((e=>{this.notifyChange(\"updating\")}));return this.notifyChange(\"updating\"),r}async _onTileMessage(e,t){if(u(t),has(\"esri-2d-update-debug\")){const t=s(e.addOrUpdate,(e=>e.hasFeatures));console.debug(e.id,`FeatureController:onTileMessage: [clear:${e.clear}, end:${e.end}, features: ${t}]`)}const a=this.tileStore.get(e.id);if(!a)return;if(e.clear)return this.processor.onTileClear(a);const o=e.status;this._cleanupNeeded=!0;const n=[];for(const r of e.remove??[]){const e=this.featureStore.lookupDisplayId(r);e&&n.push(e)}e.remove=n;try{if(r(e.addOrUpdate))return void this.processor.onTileMessage(a,{...e,addOrUpdate:null},i(this.aggregateStore),t).catch(g);if(e.addOrUpdate.setArcadeSpatialReference(this.spatialReference),this.featureStore.hasInstance(e.addOrUpdate.instance)&&o.targets.feature||(o.targets.feature=!0,this.featureStore.onTileData(a,e)),!o.storage.data||!o.storage.filters){o.storage.data=!0,o.storage.filters=!0,this.attributeStore.onTileData(a,e);\"stream\"===this._source.type||this._didEdit?(await this.attributeStore.sendUpdates(),u(t)):this.attributeStore.sendUpdates()}if(i(this.aggregateStore)&&!o.targets.aggregate){o.targets.aggregate=!0;const t=U(this._source)&&this._source.loading,r=!U(this._source)||t||e.end;if(this.aggregateStore.onTileData(a,e,this._storage,this.attributeStore,r),!r)return;o.mesh||(this.attributeStore.onTileData(a,e),await this.attributeStore.sendUpdates())}if(!o.mesh){o.mesh=!0;const r=i(this.aggregateStore)&&\"cluster\"===this.aggregateStore.type;await this.processor.onTileMessage(a,e,r,t),u(t)}this._maybeForceCleanup()}catch(h){g(h)}}_mark(e,t,r){const s=(4294901760&this._storage.getInstanceId(e))>>>16;e&&(t.add(s),r.set(e))}_markAndSweep(){this._lastCleanup=performance.now();if(!(!(\"feature\"===this._source.type&&\"snapshot\"===this._source.mode)&&(\"stream\"===this._source.type||this._cleanupNeeded)))return;this._cleanupNeeded=!1;const e=this._storage.getBitset(this._markedIdsBufId),t=new Set;e.clear();for(const r of this.tileStore.tiles)for(const s of this._source.readers(r.id)){const r=s.getCursor();for(;r.next();){let s=r.getDisplayId();if(!s){const e=r.getObjectId();s=this.featureStore.lookupDisplayId(e)}this._mark(s,t,e)}}\"symbol\"===this.processor.type&&this.processor.forEachBufferId((r=>{this._mark(r,t,e)})),this._updateQueue.forEach((r=>{for(const s of r.remove??[]){const r=this.featureStore.lookupDisplayId(s);this._mark(r,t,e)}})),i(this.aggregateStore)&&(this.aggregateStore.sweepFeatures(e,this.featureStore),\"sweepAggregates\"in this.aggregateStore&&this.aggregateStore.sweepAggregates(this._storage,this.attributeStore,this._level)),this.featureStore.sweepFeatures(e,this._storage,this.attributeStore),this.featureStore.sweepFeatureSets(t)}};e([p({constructOnly:!0})],q.prototype,\"tileStore\",void 0),e([p()],q.prototype,\"config\",void 0),e([p({readOnly:!0})],q.prototype,\"fieldsIndex\",null),e([p()],q.prototype,\"processor\",void 0),e([p({constructOnly:!0})],q.prototype,\"remoteClient\",void 0),e([p({constructOnly:!0})],q.prototype,\"service\",void 0),e([p()],q.prototype,\"spatialReference\",null),e([p()],q.prototype,\"updating\",null),q=e([y(\"esri.views.2d.layers.features.controllers.FeatureController2D\")],q);const O=q;export{O as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}