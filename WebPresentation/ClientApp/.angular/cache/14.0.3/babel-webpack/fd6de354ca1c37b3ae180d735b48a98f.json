{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/Logger.js\";\nimport { getOrCreateMapValue as t } from \"../../../../../core/MapUtils.js\";\nimport { applySome as s, isSome as r, isNone as i } from \"../../../../../core/maybe.js\";\nimport { j as a } from \"../../../../../chunks/quat.js\";\nimport { I as o, b as n } from \"../../../../../chunks/quatf64.js\";\nimport { k as l } from \"../../../../../chunks/vec3.js\";\nimport { Z as c, a as h, O as f } from \"../../../../../chunks/vec3f64.js\";\nimport u from \"../../../MeshMaterialMetallicRoughness.js\";\nimport p from \"../../../MeshTransform.js\";\nimport { ungeoreferenceByTransform as d } from \"../../georeference.js\";\nimport { Buffer as m } from \"./buffer.js\";\nimport { computeOrigin as g, smoothNormals as _ } from \"./geometry.js\";\nimport { BufferOutputType as x, ImageOutputType as A, AttributeType as T, TargetBuffer as R, AlphaMode as b } from \"./types.js\";\nimport { imageToArrayBuffer as E, imageToDataURI as M } from \"./imageutils.js\";\nimport { isEncodedMeshTexture as O } from \"../../../../../views/3d/glTF/internal/resourceUtils.js\";\nimport { DataType as w, TextureWrapMode as N } from \"../../../../../views/webgl/enums.js\";\nconst B = e.getLogger(\"gltf\");\n\nclass C {\n  constructor(e, t, s) {\n    this.params = {}, this._materialMap = new Array(), this._imageMap = new Map(), this._textureMap = new Map(), this.gltf = {\n      asset: {\n        version: \"2.0\",\n        copyright: e.copyright,\n        generator: e.generator\n      },\n      extras: {\n        options: t,\n        binChunkBuffer: null,\n        promises: []\n      }\n    }, s && (this.params = s), this._addScenes(e);\n  }\n\n  _addScenes(e) {\n    this.gltf.scene = e.defaultScene;\n    const t = this.gltf.extras,\n          s = t.options.bufferOutputType === x.GLB || t.options.imageOutputType === A.GLB;\n    s && (t.binChunkBuffer = new m(this.gltf)), e.forEachScene(e => {\n      this._addScene(e);\n    }), s && t.binChunkBuffer.finalize();\n  }\n\n  _addScene(e) {\n    this.gltf.scenes || (this.gltf.scenes = []);\n    const t = {};\n    e.name && (t.name = e.name), e.forEachNode(e => {\n      t.nodes || (t.nodes = []);\n\n      const s = this._addNode(e);\n\n      t.nodes.push(s);\n    }), this.gltf.scenes.push(t);\n  }\n\n  _addNode(e) {\n    this.gltf.nodes || (this.gltf.nodes = []);\n    const t = {};\n    e.name && (t.name = e.name);\n    const s = e.translation;\n    l(s, c) || (t.translation = h(s));\n    const r = e.rotation;\n    a(r, o) || (t.rotation = n(r));\n    const i = e.scale;\n    l(i, f) || (t.scale = h(i)), e.mesh && e.mesh.vertexAttributes.position ? t.mesh = this._addMesh(e.mesh) : e.forEachNode(e => {\n      t.children || (t.children = []);\n\n      const s = this._addNode(e);\n\n      t.children.push(s);\n    });\n    const u = this.gltf.nodes.length;\n    return this.gltf.nodes.push(t), u;\n  }\n\n  _addMesh(e) {\n    this.gltf.meshes || (this.gltf.meshes = []);\n    const t = {\n      primitives: []\n    },\n          i = this.gltf.extras,\n          a = i.options.bufferOutputType === x.GLB;\n    let o;\n    o = a ? i.binChunkBuffer : new m(this.gltf), this.params.origin || (this.params.origin = g(e));\n    const n = this.params.ignoreLocalTransform ? s(e.transform, e => new p({\n      origin: [e.origin[0], e.origin[1], e.origin[2]],\n      geographic: !1\n    })) : e.transform,\n          l = d(e.vertexAttributes, n, this.params.origin, {\n      geographic: this.params.geographic,\n      unit: \"meters\"\n    });\n    _(e, l), this._flipYZAxis(l);\n    const c = o.addBufferView(w.FLOAT, T.VEC3, R.ARRAY_BUFFER);\n    let h, f, u, A;\n    l.normal && (h = o.addBufferView(w.FLOAT, T.VEC3, R.ARRAY_BUFFER)), e.vertexAttributes.uv && (f = o.addBufferView(w.FLOAT, T.VEC2, R.ARRAY_BUFFER)), l.tangent && (u = o.addBufferView(w.FLOAT, T.VEC4, R.ARRAY_BUFFER)), e.vertexAttributes.color && (A = o.addBufferView(w.UNSIGNED_BYTE, T.VEC4, R.ARRAY_BUFFER)), c.startAccessor(\"POSITION\"), h && h.startAccessor(\"NORMAL\"), f && f.startAccessor(\"TEXCOORD_0\"), u && u.startAccessor(\"TANGENT\"), A && A.startAccessor(\"COLOR_0\");\n    const b = l.position.length / 3,\n          {\n      position: E,\n      normal: M,\n      tangent: O\n    } = l,\n          {\n      color: N,\n      uv: B\n    } = e.vertexAttributes;\n\n    for (let s = 0; s < b; ++s) c.push(E[3 * s + 0]), c.push(E[3 * s + 1]), c.push(E[3 * s + 2]), h && r(M) && (h.push(M[3 * s + 0]), h.push(M[3 * s + 1]), h.push(M[3 * s + 2])), f && r(B) && (f.push(B[2 * s + 0]), f.push(B[2 * s + 1])), u && r(O) && (u.push(O[4 * s + 0]), u.push(O[4 * s + 1]), u.push(O[4 * s + 2]), u.push(O[4 * s + 3])), A && r(N) && (A.push(N[4 * s + 0]), A.push(N[4 * s + 1]), A.push(N[4 * s + 2]), A.push(N[4 * s + 3]));\n\n    const C = c.endAccessor(),\n          I = this._addAccessor(c.index, C);\n\n    let L, v, y, F, S;\n\n    if (h) {\n      const e = h.endAccessor();\n      L = this._addAccessor(h.index, e);\n    }\n\n    if (f) {\n      const e = f.endAccessor();\n      v = this._addAccessor(f.index, e);\n    }\n\n    if (u) {\n      const e = u.endAccessor();\n      y = this._addAccessor(u.index, e);\n    }\n\n    if (A) {\n      const e = A.endAccessor();\n      F = this._addAccessor(A.index, e);\n    }\n\n    e.components && e.components.length > 0 && e.components[0].faces ? (S = o.addBufferView(w.UNSIGNED_INT, T.SCALAR, R.ELEMENT_ARRAY_BUFFER), this._addMeshVertexIndexed(S, e.components, t, I, L, v, y, F)) : this._addMeshVertexNonIndexed(e.components, t, I, L, v, y, F), c.finalize(), h && h.finalize(), f && f.finalize(), u && u.finalize(), S && S.finalize(), A && A.finalize(), a || o.finalize();\n    const k = this.gltf.meshes.length;\n    return this.gltf.meshes.push(t), k;\n  }\n\n  _flipYZAxis({\n    position: e,\n    normal: t,\n    tangent: s\n  }) {\n    this._flipYZBuffer(e, 3), this._flipYZBuffer(t, 3), this._flipYZBuffer(s, 4);\n  }\n\n  _flipYZBuffer(e, t) {\n    if (!i(e)) for (let s = 1, r = 2; s < e.length; s += t, r += t) {\n      const t = e[s],\n            i = e[r];\n      e[s] = i, e[r] = -t;\n    }\n  }\n\n  _addMaterial(e) {\n    if (null === e) return;\n\n    const t = this._materialMap.indexOf(e);\n\n    if (-1 !== t) return t;\n    this.gltf.materials || (this.gltf.materials = []);\n    const s = {};\n\n    switch (e.alphaMode) {\n      case \"mask\":\n        s.alphaMode = b.MASK;\n        break;\n\n      case \"auto\":\n      case \"blend\":\n        s.alphaMode = b.BLEND;\n    }\n\n    .5 !== e.alphaCutoff && (s.alphaCutoff = e.alphaCutoff), e.doubleSided && (s.doubleSided = e.doubleSided), s.pbrMetallicRoughness = {};\n\n    const i = e => e ** 2.1,\n          a = e => {\n      const t = e.toRgba();\n      return t[0] = i(t[0] / 255), t[1] = i(t[1] / 255), t[2] = i(t[2] / 255), t;\n    };\n\n    if (r(e.color) && (s.pbrMetallicRoughness.baseColorFactor = a(e.color)), r(e.colorTexture) && (s.pbrMetallicRoughness.baseColorTexture = {\n      index: this._addTexture(e.colorTexture)\n    }), r(e.normalTexture) && (s.normalTexture = {\n      index: this._addTexture(e.normalTexture)\n    }), e instanceof u) {\n      if (r(e.emissiveTexture) && (s.emissiveTexture = {\n        index: this._addTexture(e.emissiveTexture)\n      }), r(e.emissiveColor)) {\n        const t = a(e.emissiveColor);\n        s.emissiveFactor = [t[0], t[1], t[2]];\n      }\n\n      r(e.occlusionTexture) && (s.occlusionTexture = {\n        index: this._addTexture(e.occlusionTexture)\n      }), r(e.metallicRoughnessTexture) && (s.pbrMetallicRoughness.metallicRoughnessTexture = {\n        index: this._addTexture(e.metallicRoughnessTexture)\n      }), s.pbrMetallicRoughness.metallicFactor = e.metallic, s.pbrMetallicRoughness.roughnessFactor = e.roughness;\n    } else s.pbrMetallicRoughness.metallicFactor = 1, s.pbrMetallicRoughness.roughnessFactor = 1, B.warnOnce(\"Meshes exported to GLTF without MeshMaterialMetallicRoughness material will appear different when imported back.\");\n\n    const o = this.gltf.materials.length;\n    return this.gltf.materials.push(s), this._materialMap.push(e), o;\n  }\n\n  _addTexture(e) {\n    const s = this.gltf.textures ?? [];\n    return this.gltf.textures = s, t(this._textureMap, e, () => {\n      const t = {\n        sampler: this._addSampler(e),\n        source: this._addImage(e)\n      },\n            r = s.length;\n      return s.push(t), r;\n    });\n  }\n\n  _addImage(e) {\n    const t = this._imageMap.get(e);\n\n    if (null != t) return t;\n    this.gltf.images || (this.gltf.images = []);\n    const s = {};\n    if (e.url) s.uri = e.url;else {\n      const t = e.data;\n      s.extras = t;\n\n      for (let e = 0; e < this.gltf.images.length; ++e) if (t === this.gltf.images[e].extras) return e;\n\n      const i = this.gltf.extras;\n\n      switch (i.options.imageOutputType) {\n        case A.GLB:\n          {\n            const e = i.binChunkBuffer.addBufferView(w.UNSIGNED_BYTE, T.SCALAR);\n            if (O(t)) r(t.data) && e.writeOutToBuffer(t.data, 0);else {\n              const r = E(t).then(({\n                data: e,\n                type: t\n              }) => (s.mimeType = t, e));\n              e.writeAsync(r).then(() => {\n                e.finalize();\n              });\n            }\n            s.bufferView = e.index;\n            break;\n          }\n\n        case A.DataURI:\n          if (O(t)) {\n            B.warnOnce(\"Image export for basis compressed textures not available.\");\n            break;\n          }\n\n          s.uri = M(t);\n          break;\n\n        default:\n          if (O(t)) {\n            B.warnOnce(\"Image export for basis compressed textures not available.\");\n            break;\n          }\n\n          i.promises.push(E(t).then(({\n            data: e,\n            type: t\n          }) => {\n            s.uri = e, s.mimeType = t;\n          }));\n      }\n    }\n    const i = this.gltf.images.length;\n    return this.gltf.images.push(s), this._imageMap.set(e, i), i;\n  }\n\n  _addSampler(e) {\n    this.gltf.samplers || (this.gltf.samplers = []);\n    let t = N.REPEAT,\n        s = N.REPEAT;\n    if (\"string\" == typeof e.wrap) switch (e.wrap) {\n      case \"clamp\":\n        t = N.CLAMP_TO_EDGE, s = N.CLAMP_TO_EDGE;\n        break;\n\n      case \"mirror\":\n        t = N.MIRRORED_REPEAT, s = N.MIRRORED_REPEAT;\n    } else {\n      switch (e.wrap.vertical) {\n        case \"clamp\":\n          s = N.CLAMP_TO_EDGE;\n          break;\n\n        case \"mirror\":\n          s = N.MIRRORED_REPEAT;\n      }\n\n      switch (e.wrap.horizontal) {\n        case \"clamp\":\n          t = N.CLAMP_TO_EDGE;\n          break;\n\n        case \"mirror\":\n          t = N.MIRRORED_REPEAT;\n      }\n    }\n    const r = {\n      wrapS: t,\n      wrapT: s\n    };\n\n    for (let a = 0; a < this.gltf.samplers.length; ++a) if (JSON.stringify(r) === JSON.stringify(this.gltf.samplers[a])) return a;\n\n    const i = this.gltf.samplers.length;\n    return this.gltf.samplers.push(r), i;\n  }\n\n  _addAccessor(e, t) {\n    this.gltf.accessors || (this.gltf.accessors = []);\n    const s = {\n      bufferView: e,\n      byteOffset: t.byteOffset,\n      componentType: t.componentType,\n      count: t.count,\n      type: t.type,\n      min: t.min,\n      max: t.max,\n      name: t.name\n    };\n    t.normalized && (s.normalized = !0);\n    const r = this.gltf.accessors.length;\n    return this.gltf.accessors.push(s), r;\n  }\n\n  _addMeshVertexIndexed(e, t, s, r, i, a, o, n) {\n    for (const l of t) {\n      e.startAccessor(\"INDICES\");\n\n      for (let s = 0; s < l.faces.length; ++s) e.push(l.faces[s]);\n\n      const t = e.endAccessor(),\n            c = {\n        attributes: {\n          POSITION: r\n        },\n        indices: this._addAccessor(e.index, t),\n        material: this._addMaterial(l.material)\n      };\n      i && \"flat\" !== l.shading && (c.attributes.NORMAL = i), a && (c.attributes.TEXCOORD_0 = a), o && \"flat\" !== l.shading && (c.attributes.TANGENT = o), n && (c.attributes.COLOR_0 = n), s.primitives.push(c);\n    }\n  }\n\n  _addMeshVertexNonIndexed(e, t, s, r, i, a, o) {\n    const n = {\n      attributes: {\n        POSITION: s\n      }\n    };\n    r && (n.attributes.NORMAL = r), i && (n.attributes.TEXCOORD_0 = i), a && (n.attributes.TANGENT = a), o && (n.attributes.COLOR_0 = o), e && (n.material = this._addMaterial(e[0].material)), t.primitives.push(n);\n  }\n\n}\n\nexport { C as GLTF };","map":{"version":3,"names":["e","getOrCreateMapValue","t","applySome","s","isSome","r","isNone","i","j","a","I","o","b","n","k","l","Z","c","h","O","f","u","p","ungeoreferenceByTransform","d","Buffer","m","computeOrigin","g","smoothNormals","_","BufferOutputType","x","ImageOutputType","A","AttributeType","T","TargetBuffer","R","AlphaMode","imageToArrayBuffer","E","imageToDataURI","M","isEncodedMeshTexture","DataType","w","TextureWrapMode","N","B","getLogger","C","constructor","params","_materialMap","Array","_imageMap","Map","_textureMap","gltf","asset","version","copyright","generator","extras","options","binChunkBuffer","promises","_addScenes","scene","defaultScene","bufferOutputType","GLB","imageOutputType","forEachScene","_addScene","finalize","scenes","name","forEachNode","nodes","_addNode","push","translation","rotation","scale","mesh","vertexAttributes","position","_addMesh","children","length","meshes","primitives","origin","ignoreLocalTransform","transform","geographic","unit","_flipYZAxis","addBufferView","FLOAT","VEC3","ARRAY_BUFFER","normal","uv","VEC2","tangent","VEC4","color","UNSIGNED_BYTE","startAccessor","endAccessor","_addAccessor","index","L","v","y","F","S","components","faces","UNSIGNED_INT","SCALAR","ELEMENT_ARRAY_BUFFER","_addMeshVertexIndexed","_addMeshVertexNonIndexed","_flipYZBuffer","_addMaterial","indexOf","materials","alphaMode","MASK","BLEND","alphaCutoff","doubleSided","pbrMetallicRoughness","toRgba","baseColorFactor","colorTexture","baseColorTexture","_addTexture","normalTexture","emissiveTexture","emissiveColor","emissiveFactor","occlusionTexture","metallicRoughnessTexture","metallicFactor","metallic","roughnessFactor","roughness","warnOnce","textures","sampler","_addSampler","source","_addImage","get","images","url","uri","data","writeOutToBuffer","then","type","mimeType","writeAsync","bufferView","DataURI","set","samplers","REPEAT","wrap","CLAMP_TO_EDGE","MIRRORED_REPEAT","vertical","horizontal","wrapS","wrapT","JSON","stringify","accessors","byteOffset","componentType","count","min","max","normalized","attributes","POSITION","indices","material","shading","NORMAL","TEXCOORD_0","TANGENT","COLOR_0","GLTF"],"sources":["C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/node_modules/@arcgis/core/geometry/support/meshUtils/exporters/gltf/gltf.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Logger.js\";import{getOrCreateMapValue as t}from\"../../../../../core/MapUtils.js\";import{applySome as s,isSome as r,isNone as i}from\"../../../../../core/maybe.js\";import{j as a}from\"../../../../../chunks/quat.js\";import{I as o,b as n}from\"../../../../../chunks/quatf64.js\";import{k as l}from\"../../../../../chunks/vec3.js\";import{Z as c,a as h,O as f}from\"../../../../../chunks/vec3f64.js\";import u from\"../../../MeshMaterialMetallicRoughness.js\";import p from\"../../../MeshTransform.js\";import{ungeoreferenceByTransform as d}from\"../../georeference.js\";import{Buffer as m}from\"./buffer.js\";import{computeOrigin as g,smoothNormals as _}from\"./geometry.js\";import{BufferOutputType as x,ImageOutputType as A,AttributeType as T,TargetBuffer as R,AlphaMode as b}from\"./types.js\";import{imageToArrayBuffer as E,imageToDataURI as M}from\"./imageutils.js\";import{isEncodedMeshTexture as O}from\"../../../../../views/3d/glTF/internal/resourceUtils.js\";import{DataType as w,TextureWrapMode as N}from\"../../../../../views/webgl/enums.js\";const B=e.getLogger(\"gltf\");class C{constructor(e,t,s){this.params={},this._materialMap=new Array,this._imageMap=new Map,this._textureMap=new Map,this.gltf={asset:{version:\"2.0\",copyright:e.copyright,generator:e.generator},extras:{options:t,binChunkBuffer:null,promises:[]}},s&&(this.params=s),this._addScenes(e)}_addScenes(e){this.gltf.scene=e.defaultScene;const t=this.gltf.extras,s=t.options.bufferOutputType===x.GLB||t.options.imageOutputType===A.GLB;s&&(t.binChunkBuffer=new m(this.gltf)),e.forEachScene((e=>{this._addScene(e)})),s&&t.binChunkBuffer.finalize()}_addScene(e){this.gltf.scenes||(this.gltf.scenes=[]);const t={};e.name&&(t.name=e.name),e.forEachNode((e=>{t.nodes||(t.nodes=[]);const s=this._addNode(e);t.nodes.push(s)})),this.gltf.scenes.push(t)}_addNode(e){this.gltf.nodes||(this.gltf.nodes=[]);const t={};e.name&&(t.name=e.name);const s=e.translation;l(s,c)||(t.translation=h(s));const r=e.rotation;a(r,o)||(t.rotation=n(r));const i=e.scale;l(i,f)||(t.scale=h(i)),e.mesh&&e.mesh.vertexAttributes.position?t.mesh=this._addMesh(e.mesh):e.forEachNode((e=>{t.children||(t.children=[]);const s=this._addNode(e);t.children.push(s)}));const u=this.gltf.nodes.length;return this.gltf.nodes.push(t),u}_addMesh(e){this.gltf.meshes||(this.gltf.meshes=[]);const t={primitives:[]},i=this.gltf.extras,a=i.options.bufferOutputType===x.GLB;let o;o=a?i.binChunkBuffer:new m(this.gltf),this.params.origin||(this.params.origin=g(e));const n=this.params.ignoreLocalTransform?s(e.transform,(e=>new p({origin:[e.origin[0],e.origin[1],e.origin[2]],geographic:!1}))):e.transform,l=d(e.vertexAttributes,n,this.params.origin,{geographic:this.params.geographic,unit:\"meters\"});_(e,l),this._flipYZAxis(l);const c=o.addBufferView(w.FLOAT,T.VEC3,R.ARRAY_BUFFER);let h,f,u,A;l.normal&&(h=o.addBufferView(w.FLOAT,T.VEC3,R.ARRAY_BUFFER)),e.vertexAttributes.uv&&(f=o.addBufferView(w.FLOAT,T.VEC2,R.ARRAY_BUFFER)),l.tangent&&(u=o.addBufferView(w.FLOAT,T.VEC4,R.ARRAY_BUFFER)),e.vertexAttributes.color&&(A=o.addBufferView(w.UNSIGNED_BYTE,T.VEC4,R.ARRAY_BUFFER)),c.startAccessor(\"POSITION\"),h&&h.startAccessor(\"NORMAL\"),f&&f.startAccessor(\"TEXCOORD_0\"),u&&u.startAccessor(\"TANGENT\"),A&&A.startAccessor(\"COLOR_0\");const b=l.position.length/3,{position:E,normal:M,tangent:O}=l,{color:N,uv:B}=e.vertexAttributes;for(let s=0;s<b;++s)c.push(E[3*s+0]),c.push(E[3*s+1]),c.push(E[3*s+2]),h&&r(M)&&(h.push(M[3*s+0]),h.push(M[3*s+1]),h.push(M[3*s+2])),f&&r(B)&&(f.push(B[2*s+0]),f.push(B[2*s+1])),u&&r(O)&&(u.push(O[4*s+0]),u.push(O[4*s+1]),u.push(O[4*s+2]),u.push(O[4*s+3])),A&&r(N)&&(A.push(N[4*s+0]),A.push(N[4*s+1]),A.push(N[4*s+2]),A.push(N[4*s+3]));const C=c.endAccessor(),I=this._addAccessor(c.index,C);let L,v,y,F,S;if(h){const e=h.endAccessor();L=this._addAccessor(h.index,e)}if(f){const e=f.endAccessor();v=this._addAccessor(f.index,e)}if(u){const e=u.endAccessor();y=this._addAccessor(u.index,e)}if(A){const e=A.endAccessor();F=this._addAccessor(A.index,e)}e.components&&e.components.length>0&&e.components[0].faces?(S=o.addBufferView(w.UNSIGNED_INT,T.SCALAR,R.ELEMENT_ARRAY_BUFFER),this._addMeshVertexIndexed(S,e.components,t,I,L,v,y,F)):this._addMeshVertexNonIndexed(e.components,t,I,L,v,y,F),c.finalize(),h&&h.finalize(),f&&f.finalize(),u&&u.finalize(),S&&S.finalize(),A&&A.finalize(),a||o.finalize();const k=this.gltf.meshes.length;return this.gltf.meshes.push(t),k}_flipYZAxis({position:e,normal:t,tangent:s}){this._flipYZBuffer(e,3),this._flipYZBuffer(t,3),this._flipYZBuffer(s,4)}_flipYZBuffer(e,t){if(!i(e))for(let s=1,r=2;s<e.length;s+=t,r+=t){const t=e[s],i=e[r];e[s]=i,e[r]=-t}}_addMaterial(e){if(null===e)return;const t=this._materialMap.indexOf(e);if(-1!==t)return t;this.gltf.materials||(this.gltf.materials=[]);const s={};switch(e.alphaMode){case\"mask\":s.alphaMode=b.MASK;break;case\"auto\":case\"blend\":s.alphaMode=b.BLEND}.5!==e.alphaCutoff&&(s.alphaCutoff=e.alphaCutoff),e.doubleSided&&(s.doubleSided=e.doubleSided),s.pbrMetallicRoughness={};const i=e=>e**2.1,a=e=>{const t=e.toRgba();return t[0]=i(t[0]/255),t[1]=i(t[1]/255),t[2]=i(t[2]/255),t};if(r(e.color)&&(s.pbrMetallicRoughness.baseColorFactor=a(e.color)),r(e.colorTexture)&&(s.pbrMetallicRoughness.baseColorTexture={index:this._addTexture(e.colorTexture)}),r(e.normalTexture)&&(s.normalTexture={index:this._addTexture(e.normalTexture)}),e instanceof u){if(r(e.emissiveTexture)&&(s.emissiveTexture={index:this._addTexture(e.emissiveTexture)}),r(e.emissiveColor)){const t=a(e.emissiveColor);s.emissiveFactor=[t[0],t[1],t[2]]}r(e.occlusionTexture)&&(s.occlusionTexture={index:this._addTexture(e.occlusionTexture)}),r(e.metallicRoughnessTexture)&&(s.pbrMetallicRoughness.metallicRoughnessTexture={index:this._addTexture(e.metallicRoughnessTexture)}),s.pbrMetallicRoughness.metallicFactor=e.metallic,s.pbrMetallicRoughness.roughnessFactor=e.roughness}else s.pbrMetallicRoughness.metallicFactor=1,s.pbrMetallicRoughness.roughnessFactor=1,B.warnOnce(\"Meshes exported to GLTF without MeshMaterialMetallicRoughness material will appear different when imported back.\");const o=this.gltf.materials.length;return this.gltf.materials.push(s),this._materialMap.push(e),o}_addTexture(e){const s=this.gltf.textures??[];return this.gltf.textures=s,t(this._textureMap,e,(()=>{const t={sampler:this._addSampler(e),source:this._addImage(e)},r=s.length;return s.push(t),r}))}_addImage(e){const t=this._imageMap.get(e);if(null!=t)return t;this.gltf.images||(this.gltf.images=[]);const s={};if(e.url)s.uri=e.url;else{const t=e.data;s.extras=t;for(let e=0;e<this.gltf.images.length;++e)if(t===this.gltf.images[e].extras)return e;const i=this.gltf.extras;switch(i.options.imageOutputType){case A.GLB:{const e=i.binChunkBuffer.addBufferView(w.UNSIGNED_BYTE,T.SCALAR);if(O(t))r(t.data)&&e.writeOutToBuffer(t.data,0);else{const r=E(t).then((({data:e,type:t})=>(s.mimeType=t,e)));e.writeAsync(r).then((()=>{e.finalize()}))}s.bufferView=e.index;break}case A.DataURI:if(O(t)){B.warnOnce(\"Image export for basis compressed textures not available.\");break}s.uri=M(t);break;default:if(O(t)){B.warnOnce(\"Image export for basis compressed textures not available.\");break}i.promises.push(E(t).then((({data:e,type:t})=>{s.uri=e,s.mimeType=t})))}}const i=this.gltf.images.length;return this.gltf.images.push(s),this._imageMap.set(e,i),i}_addSampler(e){this.gltf.samplers||(this.gltf.samplers=[]);let t=N.REPEAT,s=N.REPEAT;if(\"string\"==typeof e.wrap)switch(e.wrap){case\"clamp\":t=N.CLAMP_TO_EDGE,s=N.CLAMP_TO_EDGE;break;case\"mirror\":t=N.MIRRORED_REPEAT,s=N.MIRRORED_REPEAT}else{switch(e.wrap.vertical){case\"clamp\":s=N.CLAMP_TO_EDGE;break;case\"mirror\":s=N.MIRRORED_REPEAT}switch(e.wrap.horizontal){case\"clamp\":t=N.CLAMP_TO_EDGE;break;case\"mirror\":t=N.MIRRORED_REPEAT}}const r={wrapS:t,wrapT:s};for(let a=0;a<this.gltf.samplers.length;++a)if(JSON.stringify(r)===JSON.stringify(this.gltf.samplers[a]))return a;const i=this.gltf.samplers.length;return this.gltf.samplers.push(r),i}_addAccessor(e,t){this.gltf.accessors||(this.gltf.accessors=[]);const s={bufferView:e,byteOffset:t.byteOffset,componentType:t.componentType,count:t.count,type:t.type,min:t.min,max:t.max,name:t.name};t.normalized&&(s.normalized=!0);const r=this.gltf.accessors.length;return this.gltf.accessors.push(s),r}_addMeshVertexIndexed(e,t,s,r,i,a,o,n){for(const l of t){e.startAccessor(\"INDICES\");for(let s=0;s<l.faces.length;++s)e.push(l.faces[s]);const t=e.endAccessor(),c={attributes:{POSITION:r},indices:this._addAccessor(e.index,t),material:this._addMaterial(l.material)};i&&\"flat\"!==l.shading&&(c.attributes.NORMAL=i),a&&(c.attributes.TEXCOORD_0=a),o&&\"flat\"!==l.shading&&(c.attributes.TANGENT=o),n&&(c.attributes.COLOR_0=n),s.primitives.push(c)}}_addMeshVertexNonIndexed(e,t,s,r,i,a,o){const n={attributes:{POSITION:s}};r&&(n.attributes.NORMAL=r),i&&(n.attributes.TEXCOORD_0=i),a&&(n.attributes.TANGENT=a),o&&(n.attributes.COLOR_0=o),e&&(n.material=this._addMaterial(e[0].material)),t.primitives.push(n)}}export{C as GLTF};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}