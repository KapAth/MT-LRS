{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/ClientApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport t from \"../../../../../core/Error.js\";\nimport has from \"../../../../../core/has.js\";\nimport e from \"../../../../../core/Logger.js\";\nimport { clamp as i } from \"../../../../../core/mathUtils.js\";\nimport { isNone as s, isSome as r, mapMany as a, forEachSome as n, applySome as o, unwrap as h } from \"../../../../../core/maybe.js\";\nimport { createResolver as l, isAbortError as u } from \"../../../../../core/promiseUtils.js\";\nimport { diff as d } from \"../../../../../core/accessorSupport/diffUtils.js\";\nimport c from \"../../../../../layers/support/FieldsIndex.js\";\nimport { MAX_FILTERS as p, HIGHLIGHT_FLAG as g, ATTRIBUTE_DATA_VV as _, NAN_MAGIC_NUMBER as f, ATTRIBUTE_DATA_ANIMATION as y, ATTRIBUTE_DATA_GPGPU as m } from \"../../../engine/webgl/definitions.js\";\nimport { DISPLAY_ID_TYPE_AGGREGATE as b, DISPLAY_ID_TYPE_FEATURE as x, getDisplayIdTexel as S, getDisplayIdType as T, getDisplayIdFilterMask as z } from \"../../../engine/webgl/DisplayId.js\";\nimport { getPixelArrayCtor as A } from \"../../../engine/webgl/Utils.js\";\nimport { createDebugLogger as E, DEBUG_ATTR_UPDATES as U } from \"../../../engine/webgl/util/debug.js\";\nimport { getVisualVariableSizeValueRepresentationRatio as w } from \"../tileRenderers/support/visualVariablesUtils.js\";\nimport { PixelType as D } from \"../../../../webgl/enums.js\";\nconst k = e.getLogger(\"esri.views.layers.2d.features.support.AttributeStore\"),\n      F = E(U, k),\n      I = {\n  sharedArrayBuffer: has(\"esri-shared-array-buffer\"),\n  atomics: has(\"esri-atomics\")\n};\n\nfunction B(t, e) {\n  return i => e(t(i));\n}\n\nclass C {\n  constructor(t, e, i, s) {\n    this.size = 0, this.texelSize = 4, this.dirtyStart = 0, this.dirtyEnd = 0;\n    const {\n      pixelType: r,\n      layout: a,\n      textureOnly: n\n    } = s;\n    this.textureOnly = n || !1, this.pixelType = r, this._ctype = e, this.layout = a, this._resetRange(), this._shared = t, this.size = i, n || (this.data = this._initData(r, i, t, e));\n  }\n\n  get buffer() {\n    return o(this.data, t => t.buffer);\n  }\n\n  unsetComponentAllTexels(t, e) {\n    const i = h(this.data);\n\n    for (let s = 0; s < this.size * this.size; s++) i[s * this.texelSize + t] &= ~e;\n\n    this.dirtyStart = 0, this.dirtyEnd = this.size * this.size - 1;\n  }\n\n  setComponentAllTexels(t, e) {\n    const i = h(this.data);\n\n    for (let s = 0; s < this.size * this.size; s++) i[s * this.texelSize + t] |= 255 & e;\n\n    this.dirtyStart = 0, this.dirtyEnd = this.size * this.size - 1;\n  }\n\n  setComponent(t, e, i) {\n    const s = h(this.data);\n\n    for (const r of i) s[r * this.texelSize + t] |= e, this.dirtyStart = Math.min(this.dirtyStart, r), this.dirtyEnd = Math.max(this.dirtyEnd, r);\n  }\n\n  setComponentTexel(t, e, i) {\n    h(this.data)[i * this.texelSize + t] |= e, this.dirtyStart = Math.min(this.dirtyStart, i), this.dirtyEnd = Math.max(this.dirtyEnd, i);\n  }\n\n  unsetComponentTexel(t, e, i) {\n    h(this.data)[i * this.texelSize + t] &= ~e, this.dirtyStart = Math.min(this.dirtyStart, i), this.dirtyEnd = Math.max(this.dirtyEnd, i);\n  }\n\n  getData(t, e) {\n    const i = S(t);\n    return h(this.data)[i * this.texelSize + e];\n  }\n\n  setData(t, e, i) {\n    const r = S(t),\n          a = 1 << e;\n    0 != (this.layout & a) ? s(this.data) || (this.data[r * this.texelSize + e] = i, this.dirtyStart = Math.min(this.dirtyStart, r), this.dirtyEnd = Math.max(this.dirtyEnd, r)) : k.error(\"mapview-attributes-store\", \"Tried to set a value for a texel's readonly component\");\n  }\n\n  lock() {\n    this.pixelType === D.UNSIGNED_BYTE && this._shared && I.atomics && \"local\" !== this._ctype && Atomics.store(this.data, 0, 1);\n  }\n\n  unlock() {\n    this.pixelType === D.UNSIGNED_BYTE && this._shared && I.atomics && \"local\" !== this._ctype && Atomics.store(this.data, 0, 0);\n  }\n\n  expand(t) {\n    if (this.size = t, !this.textureOnly) {\n      const e = this._initData(this.pixelType, t, this._shared, this._ctype),\n            i = h(this.data);\n\n      e.set(i), this.data = e;\n    }\n  }\n\n  toMessage() {\n    const t = this.dirtyStart,\n          e = this.dirtyEnd,\n          i = this.texelSize;\n    if (t > e) return null;\n\n    this._resetRange();\n\n    const s = !(this._shared || \"local\" === this._ctype),\n          r = this.pixelType,\n          a = this.layout,\n          n = h(this.data);\n    return {\n      start: t,\n      end: e,\n      data: s && n.slice(t * i, (e + 1) * i) || null,\n      pixelType: r,\n      layout: a\n    };\n  }\n\n  _initData(t, e, i, s) {\n    const r = i && \"local\" !== s ? SharedArrayBuffer : ArrayBuffer,\n          a = A(t),\n          n = new a(new r(e * e * 4 * a.BYTES_PER_ELEMENT));\n\n    for (let o = 0; o < n.length; o += 4) n[o + 1] = 255;\n\n    return n;\n  }\n\n  _resetRange() {\n    this.dirtyStart = 2147483647, this.dirtyEnd = 0;\n  }\n\n}\n\nclass M {\n  constructor(t, e, i = () => {}) {\n    this._client = t, this.config = e, this._notifyChange = i, this._blocks = new Array(), this._filters = new Array(p), this._attributeComputeInfo = null, this._targetType = 0, this._abortController = new AbortController(), this._hasScaleExpr = !1, this._size = 32, this._nextUpdate = null, this._currUpdate = null, this._idsToHighlight = new Set();\n    const s = e.supportsTextureFloat ? D.FLOAT : D.UNSIGNED_BYTE;\n    F(`Creating AttributeStore ${I.sharedArrayBuffer ? \"with\" : \"without\"} shared memory`), this._blockDescriptors = [{\n      pixelType: D.UNSIGNED_BYTE,\n      layout: 1\n    }, {\n      pixelType: D.UNSIGNED_BYTE,\n      layout: 15,\n      textureOnly: !0\n    }, {\n      pixelType: D.UNSIGNED_BYTE,\n      layout: 15,\n      textureOnly: !0\n    }, {\n      pixelType: s,\n      layout: 15\n    }, {\n      pixelType: s,\n      layout: 15\n    }, {\n      pixelType: s,\n      layout: 15\n    }, {\n      pixelType: s,\n      layout: 15\n    }], this._blocks = this._blockDescriptors.map(() => null);\n  }\n\n  destroy() {\n    this._abortController.abort();\n  }\n\n  get hasScaleExpr() {\n    return this._hasScaleExpr;\n  }\n\n  get _signal() {\n    return this._abortController.signal;\n  }\n\n  get hasHighlight() {\n    return this._idsToHighlight.size > 0;\n  }\n\n  isUpdating() {\n    return !!this._currUpdate || !!this._nextUpdate;\n  }\n\n  update(t, e) {\n    this.config = e;\n    const i = e.schema.processors[0].storage,\n          a = d(this._schema, i);\n\n    if ((t.targets.feature || t.targets.aggregate) && (t.storage.data = !0), a && (has(\"esri-2d-update-debug\") && console.debug(\"Applying Update - AttributeStore:\", a), t.storage.data = !0, this._schema = i, this._attributeComputeInfo = null, !s(i))) {\n      switch (i.target) {\n        case \"feature\":\n          this._targetType = x;\n          break;\n\n        case \"aggregate\":\n          this._targetType = b;\n      }\n\n      if (\"subtype\" === i.type) {\n        this._attributeComputeInfo = {\n          isSubtype: !0,\n          subtypeField: i.subtypeField,\n          map: new Map()\n        };\n\n        for (const t in i.mapping) {\n          const e = i.mapping[t];\n          if (r(e) && r(e.vvMapping)) for (const i of e.vvMapping) this._bindAttribute(i, parseInt(t, 10));\n        }\n      } else {\n        if (this._attributeComputeInfo = {\n          isSubtype: !1,\n          map: new Map()\n        }, r(i.vvMapping)) for (const t of i.vvMapping) this._bindAttribute(t);\n        if (r(i.attributeMapping)) for (const t of i.attributeMapping) this._bindAttribute(t);\n      }\n    }\n  }\n\n  onTileData(t, e) {\n    if (s(e.addOrUpdate)) return;\n    const i = e.addOrUpdate.getCursor();\n\n    for (; i.next();) {\n      const t = i.getDisplayId();\n      this.setAttributeData(t, i);\n    }\n  }\n\n  setHighlight(t, e) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const i = 1,\n            s = _this._getBlock(0),\n            r = e.map(t => S(t));\n\n      s.lock(), s.unsetComponentAllTexels(0, i), s.setComponent(0, i, r), s.unlock(), _this._idsToHighlight.clear();\n\n      for (const a of t) _this._idsToHighlight.add(a);\n\n      yield _this.sendUpdates();\n    })();\n  }\n\n  updateFilters(t, e, i) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      const {\n        service: s,\n        spatialReference: r\n      } = i,\n            {\n        filters: a\n      } = e,\n            n = a.map((t, e) => _this2._updateFilter(t, e, s, r));\n      (yield Promise.all(n)).some(t => t) && (t.storage.filters = !0, has(\"esri-2d-update-debug\") && console.debug(\"Applying Update - AttributeStore:\", \"Filters changed\"));\n    })();\n  }\n\n  setData(t, e, i, s) {\n    const r = S(t);\n    this._ensureSizeForTexel(r), this._getBlock(e).setData(t, i, s);\n  }\n\n  getData(t, e, i) {\n    return this._getBlock(e).getData(t, i);\n  }\n\n  getHighlightFlag(t) {\n    return this._idsToHighlight.has(t) ? g : 0;\n  }\n\n  unsetAttributeData(t) {\n    const e = S(t);\n\n    this._getBlock(0).setData(e, 0, 0);\n  }\n\n  setAttributeData(t, e) {\n    const s = S(t);\n    if (this._ensureSizeForTexel(s), this._getBlock(0).setData(s, 0, this.getFilterFlags(e)), this._targetType !== T(t)) return;\n    const r = this._attributeComputeInfo,\n          a = this.config.supportsTextureFloat ? 1 : 2,\n          n = 4;\n    let o = null;\n    r && (o = r.isSubtype ? r.map.get(e.readAttribute(r.subtypeField)) : r.map, o && o.size && o.forEach((t, r) => {\n      const o = r * a % n,\n            h = Math.floor(r * a / n),\n            l = this._getBlock(h + _),\n            u = t(e);\n\n      if (this.config.supportsTextureFloat) l.setData(s, o, u);else if (u === f) l.setData(s, o, 255), l.setData(s, o + 1, 255);else {\n        const t = i(Math.round(u), -32767, 32766) + 32768,\n              e = 255 & t,\n              r = (65280 & t) >> 8;\n        l.setData(s, o, e), l.setData(s, o + 1, r);\n      }\n    }));\n  }\n\n  sendUpdates() {\n    if (has(\"esri-2d-update-debug\") && console.debug(\"AttributeStore::sendUpdate\"), this._notifyChange(), this._nextUpdate) return this._nextUpdate.promise;\n    if (this._currUpdate) return this._nextUpdate = l(), this._nextUpdate.promise;\n    const e = {\n      blocks: this._blocks.map(t => r(t) ? t.toMessage() : null)\n    };\n    return this._currUpdate = this._createResources().then(() => {\n      const t = () => {\n        if (this._currUpdate = null, this._nextUpdate) {\n          const t = this._nextUpdate;\n          this._nextUpdate = null, this.sendUpdates().then(() => t.resolve());\n        } else has(\"esri-2d-update-debug\") && console.debug(\"AttributeStore::sendUpdate::No additional updates queued\");\n\n        this._notifyChange();\n      };\n\n      has(\"esri-2d-update-debug\") && console.debug(\"AttributeStore::sendUpdate::client.update\");\n\n      const i = this._client.update(e, this._signal).then(t).catch(t);\n\n      return this._client.render(this._signal), i;\n    }).catch(e => {\n      if (u(e)) return this._createResourcesPromise = null, this._createResources();\n      this._notifyChange(), k.error(new t(\"mapview-attribute-store\", \"Encountered an error during client update\", e));\n    }), this._currUpdate;\n  }\n\n  _ensureSizeForTexel(t) {\n    for (; t >= this._size * this._size;) if (this._expand()) return;\n  }\n\n  _bindAttribute(t, e) {\n    function i() {\n      const {\n        normalizationField: e\n      } = t;\n      return e ? i => {\n        const s = i.readAttribute(e);\n        if (!s) return null;\n        return i.readAttribute(t.field) / s;\n      } : e => e.readAttribute(t.field);\n    }\n\n    function s() {\n      return t.normalizationField && k.warn(\"mapview-arcade\", \"Ignoring normalizationField specified with an arcade expression which is not supported.\"), e => e.getComputedNumericAtIndex(t.fieldIndex);\n    }\n\n    let r;\n    if (null != t.fieldIndex) r = s();else {\n      if (!t.field) return;\n      r = i();\n    }\n    const {\n      valueRepresentation: a\n    } = t;\n\n    if (a) {\n      r = B(r, t => w(t, a));\n    }\n\n    const n = t => null === t || isNaN(t) || t === 1 / 0 || t === -1 / 0 ? f : t,\n          o = this._attributeComputeInfo;\n\n    if (o.isSubtype) {\n      const i = o.map.get(e) ?? new Map();\n      i.set(t.binding, B(r, n)), o.map.set(e, i);\n    } else o.map.set(t.binding, B(r, n));\n  }\n\n  _createResources() {\n    if (r(this._createResourcesPromise)) return this._createResourcesPromise;\n    this._getBlock(y), this._getBlock(m), F(\"Initializing AttributeStore\");\n\n    const e = {\n      shared: I.sharedArrayBuffer && !(\"local\" === this._client.type),\n      size: this._size,\n      blocks: a(this._blocks, t => ({\n        textureOnly: t.textureOnly,\n        buffer: t.buffer,\n        pixelType: t.pixelType\n      }))\n    },\n          i = this._client.initialize(e, this._signal).catch(e => {\n      u(e) ? this._createResourcesPromise = null : k.error(new t(\"mapview-attribute-store\", \"Encountered an error during client initialization\", e));\n    });\n\n    return this._createResourcesPromise = i, i.then(() => s(this._createResourcesPromise) ? this._createResources() : void 0), i;\n  }\n\n  _getBlock(t) {\n    const e = this._blocks[t];\n    if (r(e)) return e;\n    F(`Initializing AttributeBlock at index ${t}`);\n    const i = I.sharedArrayBuffer,\n          s = this._client.type,\n          a = new C(i, s, this._size, this._blockDescriptors[t]);\n    return this._blocks[t] = a, this._createResourcesPromise = null, a;\n  }\n\n  _expand() {\n    if (this._size < this.config.maxTextureSize) {\n      const t = this._size <<= 1;\n      return F(\"Expanding block size to\", t, this._blocks), n(this._blocks, e => e.expand(t)), this._createResourcesPromise = null, this._size = t, 0;\n    }\n\n    return k.error(new t(\"mapview-limitations\", \"Maximum number of onscreen features exceeded.\")), -1;\n  }\n\n  _updateFilter(t, e, i, a) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      const n = _this3._filters[e],\n            o = r(n) && n.hash;\n      if (!n && !t) return !1;\n      if (o === JSON.stringify(t)) return !1;\n\n      if (s(t)) {\n        if (!n) return !1;\n\n        const t = 1 << e + 1,\n              i = _this3._getBlock(0);\n\n        return _this3._filters[e] = null, i.setComponentAllTexels(0, t), _this3.sendUpdates(), !0;\n      }\n\n      const h = yield _this3._getFilter(e, i);\n      return yield h.update(t, a), !0;\n    })();\n  }\n\n  _getFilter(t, e) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      const i = _this4._filters[t];\n      if (r(i)) return i;\n      const {\n        default: s\n      } = yield import(\"./FeatureFilter.js\"),\n            a = new s({\n        geometryType: e.geometryType,\n        hasM: !1,\n        hasZ: !1,\n        timeInfo: e.timeInfo,\n        fieldsIndex: new c(e.fields)\n      });\n      return _this4._filters[t] = a, a;\n    })();\n  }\n\n  isVisible(t) {\n    return !!(2 & this._getBlock(0).getData(t, 0));\n  }\n\n  getFilterFlags(t) {\n    let e = 0;\n    const i = z(t.getDisplayId());\n\n    for (let a = 0; a < this._filters.length; a++) {\n      const r = !!(i & 1 << a),\n            n = this._filters[a];\n      e |= (!r || s(n) || n.check(t) ? 1 : 0) << a;\n    }\n\n    let r = 0;\n\n    if (this._idsToHighlight.size) {\n      const e = t.getObjectId();\n      r = this.getHighlightFlag(e);\n    }\n\n    return e << 1 | r;\n  }\n\n}\n\nexport { M as default };","map":{"version":3,"names":["t","has","e","clamp","i","isNone","s","isSome","r","mapMany","a","forEachSome","n","applySome","o","unwrap","h","createResolver","l","isAbortError","u","diff","d","c","MAX_FILTERS","p","HIGHLIGHT_FLAG","g","ATTRIBUTE_DATA_VV","_","NAN_MAGIC_NUMBER","f","ATTRIBUTE_DATA_ANIMATION","y","ATTRIBUTE_DATA_GPGPU","m","DISPLAY_ID_TYPE_AGGREGATE","b","DISPLAY_ID_TYPE_FEATURE","x","getDisplayIdTexel","S","getDisplayIdType","T","getDisplayIdFilterMask","z","getPixelArrayCtor","A","createDebugLogger","E","DEBUG_ATTR_UPDATES","U","getVisualVariableSizeValueRepresentationRatio","w","PixelType","D","k","getLogger","F","I","sharedArrayBuffer","atomics","B","C","constructor","size","texelSize","dirtyStart","dirtyEnd","pixelType","layout","textureOnly","_ctype","_resetRange","_shared","data","_initData","buffer","unsetComponentAllTexels","setComponentAllTexels","setComponent","Math","min","max","setComponentTexel","unsetComponentTexel","getData","setData","error","lock","UNSIGNED_BYTE","Atomics","store","unlock","expand","set","toMessage","start","end","slice","SharedArrayBuffer","ArrayBuffer","BYTES_PER_ELEMENT","length","M","_client","config","_notifyChange","_blocks","Array","_filters","_attributeComputeInfo","_targetType","_abortController","AbortController","_hasScaleExpr","_size","_nextUpdate","_currUpdate","_idsToHighlight","Set","supportsTextureFloat","FLOAT","_blockDescriptors","map","destroy","abort","hasScaleExpr","_signal","signal","hasHighlight","isUpdating","update","schema","processors","storage","_schema","targets","feature","aggregate","console","debug","target","type","isSubtype","subtypeField","Map","mapping","vvMapping","_bindAttribute","parseInt","attributeMapping","onTileData","addOrUpdate","getCursor","next","getDisplayId","setAttributeData","setHighlight","_getBlock","clear","add","sendUpdates","updateFilters","service","spatialReference","filters","_updateFilter","Promise","all","some","_ensureSizeForTexel","getHighlightFlag","unsetAttributeData","getFilterFlags","get","readAttribute","forEach","floor","round","promise","blocks","_createResources","then","resolve","catch","render","_createResourcesPromise","_expand","normalizationField","field","warn","getComputedNumericAtIndex","fieldIndex","valueRepresentation","isNaN","binding","shared","initialize","maxTextureSize","hash","JSON","stringify","_getFilter","default","geometryType","hasM","hasZ","timeInfo","fieldsIndex","fields","isVisible","check","getObjectId"],"sources":["C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/node_modules/@arcgis/core/views/2d/layers/features/support/AttributeStore.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport t from\"../../../../../core/Error.js\";import has from\"../../../../../core/has.js\";import e from\"../../../../../core/Logger.js\";import{clamp as i}from\"../../../../../core/mathUtils.js\";import{isNone as s,isSome as r,mapMany as a,forEachSome as n,applySome as o,unwrap as h}from\"../../../../../core/maybe.js\";import{createResolver as l,isAbortError as u}from\"../../../../../core/promiseUtils.js\";import{diff as d}from\"../../../../../core/accessorSupport/diffUtils.js\";import c from\"../../../../../layers/support/FieldsIndex.js\";import{MAX_FILTERS as p,HIGHLIGHT_FLAG as g,ATTRIBUTE_DATA_VV as _,NAN_MAGIC_NUMBER as f,ATTRIBUTE_DATA_ANIMATION as y,ATTRIBUTE_DATA_GPGPU as m}from\"../../../engine/webgl/definitions.js\";import{DISPLAY_ID_TYPE_AGGREGATE as b,DISPLAY_ID_TYPE_FEATURE as x,getDisplayIdTexel as S,getDisplayIdType as T,getDisplayIdFilterMask as z}from\"../../../engine/webgl/DisplayId.js\";import{getPixelArrayCtor as A}from\"../../../engine/webgl/Utils.js\";import{createDebugLogger as E,DEBUG_ATTR_UPDATES as U}from\"../../../engine/webgl/util/debug.js\";import{getVisualVariableSizeValueRepresentationRatio as w}from\"../tileRenderers/support/visualVariablesUtils.js\";import{PixelType as D}from\"../../../../webgl/enums.js\";const k=e.getLogger(\"esri.views.layers.2d.features.support.AttributeStore\"),F=E(U,k),I={sharedArrayBuffer:has(\"esri-shared-array-buffer\"),atomics:has(\"esri-atomics\")};function B(t,e){return i=>e(t(i))}class C{constructor(t,e,i,s){this.size=0,this.texelSize=4,this.dirtyStart=0,this.dirtyEnd=0;const{pixelType:r,layout:a,textureOnly:n}=s;this.textureOnly=n||!1,this.pixelType=r,this._ctype=e,this.layout=a,this._resetRange(),this._shared=t,this.size=i,n||(this.data=this._initData(r,i,t,e))}get buffer(){return o(this.data,(t=>t.buffer))}unsetComponentAllTexels(t,e){const i=h(this.data);for(let s=0;s<this.size*this.size;s++)i[s*this.texelSize+t]&=~e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(t,e){const i=h(this.data);for(let s=0;s<this.size*this.size;s++)i[s*this.texelSize+t]|=255&e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(t,e,i){const s=h(this.data);for(const r of i)s[r*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}setComponentTexel(t,e,i){h(this.data)[i*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}unsetComponentTexel(t,e,i){h(this.data)[i*this.texelSize+t]&=~e,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}getData(t,e){const i=S(t);return h(this.data)[i*this.texelSize+e]}setData(t,e,i){const r=S(t),a=1<<e;0!=(this.layout&a)?s(this.data)||(this.data[r*this.texelSize+e]=i,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)):k.error(\"mapview-attributes-store\",\"Tried to set a value for a texel's readonly component\")}lock(){this.pixelType===D.UNSIGNED_BYTE&&this._shared&&I.atomics&&\"local\"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){this.pixelType===D.UNSIGNED_BYTE&&this._shared&&I.atomics&&\"local\"!==this._ctype&&Atomics.store(this.data,0,0)}expand(t){if(this.size=t,!this.textureOnly){const e=this._initData(this.pixelType,t,this._shared,this._ctype),i=h(this.data);e.set(i),this.data=e}}toMessage(){const t=this.dirtyStart,e=this.dirtyEnd,i=this.texelSize;if(t>e)return null;this._resetRange();const s=!(this._shared||\"local\"===this._ctype),r=this.pixelType,a=this.layout,n=h(this.data);return{start:t,end:e,data:s&&n.slice(t*i,(e+1)*i)||null,pixelType:r,layout:a}}_initData(t,e,i,s){const r=i&&\"local\"!==s?SharedArrayBuffer:ArrayBuffer,a=A(t),n=new a(new r(e*e*4*a.BYTES_PER_ELEMENT));for(let o=0;o<n.length;o+=4)n[o+1]=255;return n}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class M{constructor(t,e,i=(()=>{})){this._client=t,this.config=e,this._notifyChange=i,this._blocks=new Array,this._filters=new Array(p),this._attributeComputeInfo=null,this._targetType=0,this._abortController=new AbortController,this._hasScaleExpr=!1,this._size=32,this._nextUpdate=null,this._currUpdate=null,this._idsToHighlight=new Set;const s=e.supportsTextureFloat?D.FLOAT:D.UNSIGNED_BYTE;F(`Creating AttributeStore ${I.sharedArrayBuffer?\"with\":\"without\"} shared memory`),this._blockDescriptors=[{pixelType:D.UNSIGNED_BYTE,layout:1},{pixelType:D.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:D.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:s,layout:15},{pixelType:s,layout:15},{pixelType:s,layout:15},{pixelType:s,layout:15}],this._blocks=this._blockDescriptors.map((()=>null))}destroy(){this._abortController.abort()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}get hasHighlight(){return this._idsToHighlight.size>0}isUpdating(){return!!this._currUpdate||!!this._nextUpdate}update(t,e){this.config=e;const i=e.schema.processors[0].storage,a=d(this._schema,i);if((t.targets.feature||t.targets.aggregate)&&(t.storage.data=!0),a&&(has(\"esri-2d-update-debug\")&&console.debug(\"Applying Update - AttributeStore:\",a),t.storage.data=!0,this._schema=i,this._attributeComputeInfo=null,!s(i))){switch(i.target){case\"feature\":this._targetType=x;break;case\"aggregate\":this._targetType=b}if(\"subtype\"===i.type){this._attributeComputeInfo={isSubtype:!0,subtypeField:i.subtypeField,map:new Map};for(const t in i.mapping){const e=i.mapping[t];if(r(e)&&r(e.vvMapping))for(const i of e.vvMapping)this._bindAttribute(i,parseInt(t,10))}}else{if(this._attributeComputeInfo={isSubtype:!1,map:new Map},r(i.vvMapping))for(const t of i.vvMapping)this._bindAttribute(t);if(r(i.attributeMapping))for(const t of i.attributeMapping)this._bindAttribute(t)}}}onTileData(t,e){if(s(e.addOrUpdate))return;const i=e.addOrUpdate.getCursor();for(;i.next();){const t=i.getDisplayId();this.setAttributeData(t,i)}}async setHighlight(t,e){const i=1,s=this._getBlock(0),r=e.map((t=>S(t)));s.lock(),s.unsetComponentAllTexels(0,i),s.setComponent(0,i,r),s.unlock(),this._idsToHighlight.clear();for(const a of t)this._idsToHighlight.add(a);await this.sendUpdates()}async updateFilters(t,e,i){const{service:s,spatialReference:r}=i,{filters:a}=e,n=a.map(((t,e)=>this._updateFilter(t,e,s,r)));(await Promise.all(n)).some((t=>t))&&(t.storage.filters=!0,has(\"esri-2d-update-debug\")&&console.debug(\"Applying Update - AttributeStore:\",\"Filters changed\"))}setData(t,e,i,s){const r=S(t);this._ensureSizeForTexel(r),this._getBlock(e).setData(t,i,s)}getData(t,e,i){return this._getBlock(e).getData(t,i)}getHighlightFlag(t){return this._idsToHighlight.has(t)?g:0}unsetAttributeData(t){const e=S(t);this._getBlock(0).setData(e,0,0)}setAttributeData(t,e){const s=S(t);if(this._ensureSizeForTexel(s),this._getBlock(0).setData(s,0,this.getFilterFlags(e)),this._targetType!==T(t))return;const r=this._attributeComputeInfo,a=this.config.supportsTextureFloat?1:2,n=4;let o=null;r&&(o=r.isSubtype?r.map.get(e.readAttribute(r.subtypeField)):r.map,o&&o.size&&o.forEach(((t,r)=>{const o=r*a%n,h=Math.floor(r*a/n),l=this._getBlock(h+_),u=t(e);if(this.config.supportsTextureFloat)l.setData(s,o,u);else if(u===f)l.setData(s,o,255),l.setData(s,o+1,255);else{const t=i(Math.round(u),-32767,32766)+32768,e=255&t,r=(65280&t)>>8;l.setData(s,o,e),l.setData(s,o+1,r)}})))}sendUpdates(){if(has(\"esri-2d-update-debug\")&&console.debug(\"AttributeStore::sendUpdate\"),this._notifyChange(),this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=l(),this._nextUpdate.promise;const e={blocks:this._blocks.map((t=>r(t)?t.toMessage():null))};return this._currUpdate=this._createResources().then((()=>{const t=()=>{if(this._currUpdate=null,this._nextUpdate){const t=this._nextUpdate;this._nextUpdate=null,this.sendUpdates().then((()=>t.resolve()))}else has(\"esri-2d-update-debug\")&&console.debug(\"AttributeStore::sendUpdate::No additional updates queued\");this._notifyChange()};has(\"esri-2d-update-debug\")&&console.debug(\"AttributeStore::sendUpdate::client.update\");const i=this._client.update(e,this._signal).then(t).catch(t);return this._client.render(this._signal),i})).catch((e=>{if(u(e))return this._createResourcesPromise=null,this._createResources();this._notifyChange(),k.error(new t(\"mapview-attribute-store\",\"Encountered an error during client update\",e))})),this._currUpdate}_ensureSizeForTexel(t){for(;t>=this._size*this._size;)if(this._expand())return}_bindAttribute(t,e){function i(){const{normalizationField:e}=t;return e?i=>{const s=i.readAttribute(e);if(!s)return null;return i.readAttribute(t.field)/s}:e=>e.readAttribute(t.field)}function s(){return t.normalizationField&&k.warn(\"mapview-arcade\",\"Ignoring normalizationField specified with an arcade expression which is not supported.\"),e=>e.getComputedNumericAtIndex(t.fieldIndex)}let r;if(null!=t.fieldIndex)r=s();else{if(!t.field)return;r=i()}const{valueRepresentation:a}=t;if(a){r=B(r,(t=>w(t,a)))}const n=t=>null===t||isNaN(t)||t===1/0||t===-1/0?f:t,o=this._attributeComputeInfo;if(o.isSubtype){const i=o.map.get(e)??new Map;i.set(t.binding,B(r,n)),o.map.set(e,i)}else o.map.set(t.binding,B(r,n))}_createResources(){if(r(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(y),this._getBlock(m),F(\"Initializing AttributeStore\");const e={shared:I.sharedArrayBuffer&&!(\"local\"===this._client.type),size:this._size,blocks:a(this._blocks,(t=>({textureOnly:t.textureOnly,buffer:t.buffer,pixelType:t.pixelType})))},i=this._client.initialize(e,this._signal).catch((e=>{u(e)?this._createResourcesPromise=null:k.error(new t(\"mapview-attribute-store\",\"Encountered an error during client initialization\",e))}));return this._createResourcesPromise=i,i.then((()=>s(this._createResourcesPromise)?this._createResources():void 0)),i}_getBlock(t){const e=this._blocks[t];if(r(e))return e;F(`Initializing AttributeBlock at index ${t}`);const i=I.sharedArrayBuffer,s=this._client.type,a=new C(i,s,this._size,this._blockDescriptors[t]);return this._blocks[t]=a,this._createResourcesPromise=null,a}_expand(){if(this._size<this.config.maxTextureSize){const t=this._size<<=1;return F(\"Expanding block size to\",t,this._blocks),n(this._blocks,(e=>e.expand(t))),this._createResourcesPromise=null,this._size=t,0}return k.error(new t(\"mapview-limitations\",\"Maximum number of onscreen features exceeded.\")),-1}async _updateFilter(t,e,i,a){const n=this._filters[e],o=r(n)&&n.hash;if(!n&&!t)return!1;if(o===JSON.stringify(t))return!1;if(s(t)){if(!n)return!1;const t=1<<e+1,i=this._getBlock(0);return this._filters[e]=null,i.setComponentAllTexels(0,t),this.sendUpdates(),!0}const h=await this._getFilter(e,i);return await h.update(t,a),!0}async _getFilter(t,e){const i=this._filters[t];if(r(i))return i;const{default:s}=await import(\"./FeatureFilter.js\"),a=new s({geometryType:e.geometryType,hasM:!1,hasZ:!1,timeInfo:e.timeInfo,fieldsIndex:new c(e.fields)});return this._filters[t]=a,a}isVisible(t){return!!(2&this._getBlock(0).getData(t,0))}getFilterFlags(t){let e=0;const i=z(t.getDisplayId());for(let a=0;a<this._filters.length;a++){const r=!!(i&1<<a),n=this._filters[a];e|=(!r||s(n)||n.check(t)?1:0)<<a}let r=0;if(this._idsToHighlight.size){const e=t.getObjectId();r=this.getHighlightFlag(e)}return e<<1|r}}export{M as default};\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAa,8BAAb;AAA4C,OAAOC,GAAP,MAAe,4BAAf;AAA4C,OAAOC,CAAP,MAAa,+BAAb;AAA6C,SAAOC,KAAK,IAAIC,CAAhB,QAAsB,kCAAtB;AAAyD,SAAOC,MAAM,IAAIC,CAAjB,EAAmBC,MAAM,IAAIC,CAA7B,EAA+BC,OAAO,IAAIC,CAA1C,EAA4CC,WAAW,IAAIC,CAA3D,EAA6DC,SAAS,IAAIC,CAA1E,EAA4EC,MAAM,IAAIC,CAAtF,QAA4F,8BAA5F;AAA2H,SAAOC,cAAc,IAAIC,CAAzB,EAA2BC,YAAY,IAAIC,CAA3C,QAAiD,qCAAjD;AAAuF,SAAOC,IAAI,IAAIC,CAAf,QAAqB,kDAArB;AAAwE,OAAOC,CAAP,MAAa,8CAAb;AAA4D,SAAOC,WAAW,IAAIC,CAAtB,EAAwBC,cAAc,IAAIC,CAA1C,EAA4CC,iBAAiB,IAAIC,CAAjE,EAAmEC,gBAAgB,IAAIC,CAAvF,EAAyFC,wBAAwB,IAAIC,CAArH,EAAuHC,oBAAoB,IAAIC,CAA/I,QAAqJ,sCAArJ;AAA4L,SAAOC,yBAAyB,IAAIC,CAApC,EAAsCC,uBAAuB,IAAIC,CAAjE,EAAmEC,iBAAiB,IAAIC,CAAxF,EAA0FC,gBAAgB,IAAIC,CAA9G,EAAgHC,sBAAsB,IAAIC,CAA1I,QAAgJ,oCAAhJ;AAAqL,SAAOC,iBAAiB,IAAIC,CAA5B,QAAkC,gCAAlC;AAAmE,SAAOC,iBAAiB,IAAIC,CAA5B,EAA8BC,kBAAkB,IAAIC,CAApD,QAA0D,qCAA1D;AAAgG,SAAOC,6CAA6C,IAAIC,CAAxD,QAA8D,kDAA9D;AAAiH,SAAOC,SAAS,IAAIC,CAApB,QAA0B,4BAA1B;AAAuD,MAAMC,CAAC,GAACtD,CAAC,CAACuD,SAAF,CAAY,sDAAZ,CAAR;AAAA,MAA4EC,CAAC,GAACT,CAAC,CAACE,CAAD,EAAGK,CAAH,CAA/E;AAAA,MAAqFG,CAAC,GAAC;EAACC,iBAAiB,EAAC3D,GAAG,CAAC,0BAAD,CAAtB;EAAmD4D,OAAO,EAAC5D,GAAG,CAAC,cAAD;AAA9D,CAAvF;;AAAuK,SAAS6D,CAAT,CAAW9D,CAAX,EAAaE,CAAb,EAAe;EAAC,OAAOE,CAAC,IAAEF,CAAC,CAACF,CAAC,CAACI,CAAD,CAAF,CAAX;AAAkB;;AAAA,MAAM2D,CAAN,CAAO;EAACC,WAAW,CAAChE,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAAS;IAAC,KAAK2D,IAAL,GAAU,CAAV,EAAY,KAAKC,SAAL,GAAe,CAA3B,EAA6B,KAAKC,UAAL,GAAgB,CAA7C,EAA+C,KAAKC,QAAL,GAAc,CAA7D;IAA+D,MAAK;MAACC,SAAS,EAAC7D,CAAX;MAAa8D,MAAM,EAAC5D,CAApB;MAAsB6D,WAAW,EAAC3D;IAAlC,IAAqCN,CAA1C;IAA4C,KAAKiE,WAAL,GAAiB3D,CAAC,IAAE,CAAC,CAArB,EAAuB,KAAKyD,SAAL,GAAe7D,CAAtC,EAAwC,KAAKgE,MAAL,GAAYtE,CAApD,EAAsD,KAAKoE,MAAL,GAAY5D,CAAlE,EAAoE,KAAK+D,WAAL,EAApE,EAAuF,KAAKC,OAAL,GAAa1E,CAApG,EAAsG,KAAKiE,IAAL,GAAU7D,CAAhH,EAAkHQ,CAAC,KAAG,KAAK+D,IAAL,GAAU,KAAKC,SAAL,CAAepE,CAAf,EAAiBJ,CAAjB,EAAmBJ,CAAnB,EAAqBE,CAArB,CAAb,CAAnH;EAAyJ;;EAAU,IAAN2E,MAAM,GAAE;IAAC,OAAO/D,CAAC,CAAC,KAAK6D,IAAN,EAAY3E,CAAC,IAAEA,CAAC,CAAC6E,MAAjB,CAAR;EAAkC;;EAAAC,uBAAuB,CAAC9E,CAAD,EAAGE,CAAH,EAAK;IAAC,MAAME,CAAC,GAACY,CAAC,CAAC,KAAK2D,IAAN,CAAT;;IAAqB,KAAI,IAAIrE,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,KAAK2D,IAAL,GAAU,KAAKA,IAA7B,EAAkC3D,CAAC,EAAnC,EAAsCF,CAAC,CAACE,CAAC,GAAC,KAAK4D,SAAP,GAAiBlE,CAAlB,CAAD,IAAuB,CAACE,CAAxB;;IAA0B,KAAKiE,UAAL,GAAgB,CAAhB,EAAkB,KAAKC,QAAL,GAAc,KAAKH,IAAL,GAAU,KAAKA,IAAf,GAAoB,CAApD;EAAsD;;EAAAc,qBAAqB,CAAC/E,CAAD,EAAGE,CAAH,EAAK;IAAC,MAAME,CAAC,GAACY,CAAC,CAAC,KAAK2D,IAAN,CAAT;;IAAqB,KAAI,IAAIrE,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,KAAK2D,IAAL,GAAU,KAAKA,IAA7B,EAAkC3D,CAAC,EAAnC,EAAsCF,CAAC,CAACE,CAAC,GAAC,KAAK4D,SAAP,GAAiBlE,CAAlB,CAAD,IAAuB,MAAIE,CAA3B;;IAA6B,KAAKiE,UAAL,GAAgB,CAAhB,EAAkB,KAAKC,QAAL,GAAc,KAAKH,IAAL,GAAU,KAAKA,IAAf,GAAoB,CAApD;EAAsD;;EAAAe,YAAY,CAAChF,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAO;IAAC,MAAME,CAAC,GAACU,CAAC,CAAC,KAAK2D,IAAN,CAAT;;IAAqB,KAAI,MAAMnE,CAAV,IAAeJ,CAAf,EAAiBE,CAAC,CAACE,CAAC,GAAC,KAAK0D,SAAP,GAAiBlE,CAAlB,CAAD,IAAuBE,CAAvB,EAAyB,KAAKiE,UAAL,GAAgBc,IAAI,CAACC,GAAL,CAAS,KAAKf,UAAd,EAAyB3D,CAAzB,CAAzC,EAAqE,KAAK4D,QAAL,GAAca,IAAI,CAACE,GAAL,CAAS,KAAKf,QAAd,EAAuB5D,CAAvB,CAAnF;EAA6G;;EAAA4E,iBAAiB,CAACpF,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAO;IAACY,CAAC,CAAC,KAAK2D,IAAN,CAAD,CAAavE,CAAC,GAAC,KAAK8D,SAAP,GAAiBlE,CAA9B,KAAkCE,CAAlC,EAAoC,KAAKiE,UAAL,GAAgBc,IAAI,CAACC,GAAL,CAAS,KAAKf,UAAd,EAAyB/D,CAAzB,CAApD,EAAgF,KAAKgE,QAAL,GAAca,IAAI,CAACE,GAAL,CAAS,KAAKf,QAAd,EAAuBhE,CAAvB,CAA9F;EAAwH;;EAAAiF,mBAAmB,CAACrF,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAO;IAACY,CAAC,CAAC,KAAK2D,IAAN,CAAD,CAAavE,CAAC,GAAC,KAAK8D,SAAP,GAAiBlE,CAA9B,KAAkC,CAACE,CAAnC,EAAqC,KAAKiE,UAAL,GAAgBc,IAAI,CAACC,GAAL,CAAS,KAAKf,UAAd,EAAyB/D,CAAzB,CAArD,EAAiF,KAAKgE,QAAL,GAAca,IAAI,CAACE,GAAL,CAAS,KAAKf,QAAd,EAAuBhE,CAAvB,CAA/F;EAAyH;;EAAAkF,OAAO,CAACtF,CAAD,EAAGE,CAAH,EAAK;IAAC,MAAME,CAAC,GAACqC,CAAC,CAACzC,CAAD,CAAT;IAAa,OAAOgB,CAAC,CAAC,KAAK2D,IAAN,CAAD,CAAavE,CAAC,GAAC,KAAK8D,SAAP,GAAiBhE,CAA9B,CAAP;EAAwC;;EAAAqF,OAAO,CAACvF,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAO;IAAC,MAAMI,CAAC,GAACiC,CAAC,CAACzC,CAAD,CAAT;IAAA,MAAaU,CAAC,GAAC,KAAGR,CAAlB;IAAoB,MAAI,KAAKoE,MAAL,GAAY5D,CAAhB,IAAmBJ,CAAC,CAAC,KAAKqE,IAAN,CAAD,KAAe,KAAKA,IAAL,CAAUnE,CAAC,GAAC,KAAK0D,SAAP,GAAiBhE,CAA3B,IAA8BE,CAA9B,EAAgC,KAAK+D,UAAL,GAAgBc,IAAI,CAACC,GAAL,CAAS,KAAKf,UAAd,EAAyB3D,CAAzB,CAAhD,EAA4E,KAAK4D,QAAL,GAAca,IAAI,CAACE,GAAL,CAAS,KAAKf,QAAd,EAAuB5D,CAAvB,CAAzG,CAAnB,GAAuJgD,CAAC,CAACgC,KAAF,CAAQ,0BAAR,EAAmC,uDAAnC,CAAvJ;EAAmP;;EAAAC,IAAI,GAAE;IAAC,KAAKpB,SAAL,KAAiBd,CAAC,CAACmC,aAAnB,IAAkC,KAAKhB,OAAvC,IAAgDf,CAAC,CAACE,OAAlD,IAA2D,YAAU,KAAKW,MAA1E,IAAkFmB,OAAO,CAACC,KAAR,CAAc,KAAKjB,IAAnB,EAAwB,CAAxB,EAA0B,CAA1B,CAAlF;EAA+G;;EAAAkB,MAAM,GAAE;IAAC,KAAKxB,SAAL,KAAiBd,CAAC,CAACmC,aAAnB,IAAkC,KAAKhB,OAAvC,IAAgDf,CAAC,CAACE,OAAlD,IAA2D,YAAU,KAAKW,MAA1E,IAAkFmB,OAAO,CAACC,KAAR,CAAc,KAAKjB,IAAnB,EAAwB,CAAxB,EAA0B,CAA1B,CAAlF;EAA+G;;EAAAmB,MAAM,CAAC9F,CAAD,EAAG;IAAC,IAAG,KAAKiE,IAAL,GAAUjE,CAAV,EAAY,CAAC,KAAKuE,WAArB,EAAiC;MAAC,MAAMrE,CAAC,GAAC,KAAK0E,SAAL,CAAe,KAAKP,SAApB,EAA8BrE,CAA9B,EAAgC,KAAK0E,OAArC,EAA6C,KAAKF,MAAlD,CAAR;MAAA,MAAkEpE,CAAC,GAACY,CAAC,CAAC,KAAK2D,IAAN,CAArE;;MAAiFzE,CAAC,CAAC6F,GAAF,CAAM3F,CAAN,GAAS,KAAKuE,IAAL,GAAUzE,CAAnB;IAAqB;EAAC;;EAAA8F,SAAS,GAAE;IAAC,MAAMhG,CAAC,GAAC,KAAKmE,UAAb;IAAA,MAAwBjE,CAAC,GAAC,KAAKkE,QAA/B;IAAA,MAAwChE,CAAC,GAAC,KAAK8D,SAA/C;IAAyD,IAAGlE,CAAC,GAACE,CAAL,EAAO,OAAO,IAAP;;IAAY,KAAKuE,WAAL;;IAAmB,MAAMnE,CAAC,GAAC,EAAE,KAAKoE,OAAL,IAAc,YAAU,KAAKF,MAA/B,CAAR;IAAA,MAA+ChE,CAAC,GAAC,KAAK6D,SAAtD;IAAA,MAAgE3D,CAAC,GAAC,KAAK4D,MAAvE;IAAA,MAA8E1D,CAAC,GAACI,CAAC,CAAC,KAAK2D,IAAN,CAAjF;IAA6F,OAAM;MAACsB,KAAK,EAACjG,CAAP;MAASkG,GAAG,EAAChG,CAAb;MAAeyE,IAAI,EAACrE,CAAC,IAAEM,CAAC,CAACuF,KAAF,CAAQnG,CAAC,GAACI,CAAV,EAAY,CAACF,CAAC,GAAC,CAAH,IAAME,CAAlB,CAAH,IAAyB,IAA7C;MAAkDiE,SAAS,EAAC7D,CAA5D;MAA8D8D,MAAM,EAAC5D;IAArE,CAAN;EAA8E;;EAAAkE,SAAS,CAAC5E,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAAS;IAAC,MAAME,CAAC,GAACJ,CAAC,IAAE,YAAUE,CAAb,GAAe8F,iBAAf,GAAiCC,WAAzC;IAAA,MAAqD3F,CAAC,GAACqC,CAAC,CAAC/C,CAAD,CAAxD;IAAA,MAA4DY,CAAC,GAAC,IAAIF,CAAJ,CAAM,IAAIF,CAAJ,CAAMN,CAAC,GAACA,CAAF,GAAI,CAAJ,GAAMQ,CAAC,CAAC4F,iBAAd,CAAN,CAA9D;;IAAsG,KAAI,IAAIxF,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACF,CAAC,CAAC2F,MAAhB,EAAuBzF,CAAC,IAAE,CAA1B,EAA4BF,CAAC,CAACE,CAAC,GAAC,CAAH,CAAD,GAAO,GAAP;;IAAW,OAAOF,CAAP;EAAS;;EAAA6D,WAAW,GAAE;IAAC,KAAKN,UAAL,GAAgB,UAAhB,EAA2B,KAAKC,QAAL,GAAc,CAAzC;EAA2C;;AAAvzE;;AAAwzE,MAAMoC,CAAN,CAAO;EAACxC,WAAW,CAAChE,CAAD,EAAGE,CAAH,EAAKE,CAAC,GAAE,MAAI,CAAE,CAAd,EAAgB;IAAC,KAAKqG,OAAL,GAAazG,CAAb,EAAe,KAAK0G,MAAL,GAAYxG,CAA3B,EAA6B,KAAKyG,aAAL,GAAmBvG,CAAhD,EAAkD,KAAKwG,OAAL,GAAa,IAAIC,KAAJ,EAA/D,EAAyE,KAAKC,QAAL,GAAc,IAAID,KAAJ,CAAUpF,CAAV,CAAvF,EAAoG,KAAKsF,qBAAL,GAA2B,IAA/H,EAAoI,KAAKC,WAAL,GAAiB,CAArJ,EAAuJ,KAAKC,gBAAL,GAAsB,IAAIC,eAAJ,EAA7K,EAAiM,KAAKC,aAAL,GAAmB,CAAC,CAArN,EAAuN,KAAKC,KAAL,GAAW,EAAlO,EAAqO,KAAKC,WAAL,GAAiB,IAAtP,EAA2P,KAAKC,WAAL,GAAiB,IAA5Q,EAAiR,KAAKC,eAAL,GAAqB,IAAIC,GAAJ,EAAtS;IAA8S,MAAMlH,CAAC,GAACJ,CAAC,CAACuH,oBAAF,GAAuBlE,CAAC,CAACmE,KAAzB,GAA+BnE,CAAC,CAACmC,aAAzC;IAAuDhC,CAAC,CAAE,2BAA0BC,CAAC,CAACC,iBAAF,GAAoB,MAApB,GAA2B,SAAU,gBAAjE,CAAD,EAAmF,KAAK+D,iBAAL,GAAuB,CAAC;MAACtD,SAAS,EAACd,CAAC,CAACmC,aAAb;MAA2BpB,MAAM,EAAC;IAAlC,CAAD,EAAsC;MAACD,SAAS,EAACd,CAAC,CAACmC,aAAb;MAA2BpB,MAAM,EAAC,EAAlC;MAAqCC,WAAW,EAAC,CAAC;IAAlD,CAAtC,EAA2F;MAACF,SAAS,EAACd,CAAC,CAACmC,aAAb;MAA2BpB,MAAM,EAAC,EAAlC;MAAqCC,WAAW,EAAC,CAAC;IAAlD,CAA3F,EAAgJ;MAACF,SAAS,EAAC/D,CAAX;MAAagE,MAAM,EAAC;IAApB,CAAhJ,EAAwK;MAACD,SAAS,EAAC/D,CAAX;MAAagE,MAAM,EAAC;IAApB,CAAxK,EAAgM;MAACD,SAAS,EAAC/D,CAAX;MAAagE,MAAM,EAAC;IAApB,CAAhM,EAAwN;MAACD,SAAS,EAAC/D,CAAX;MAAagE,MAAM,EAAC;IAApB,CAAxN,CAA1G,EAA2V,KAAKsC,OAAL,GAAa,KAAKe,iBAAL,CAAuBC,GAAvB,CAA4B,MAAI,IAAhC,CAAxW;EAA+Y;;EAAAC,OAAO,GAAE;IAAC,KAAKZ,gBAAL,CAAsBa,KAAtB;EAA8B;;EAAgB,IAAZC,YAAY,GAAE;IAAC,OAAO,KAAKZ,aAAZ;EAA0B;;EAAW,IAAPa,OAAO,GAAE;IAAC,OAAO,KAAKf,gBAAL,CAAsBgB,MAA7B;EAAoC;;EAAgB,IAAZC,YAAY,GAAE;IAAC,OAAO,KAAKX,eAAL,CAAqBtD,IAArB,GAA0B,CAAjC;EAAmC;;EAAAkE,UAAU,GAAE;IAAC,OAAM,CAAC,CAAC,KAAKb,WAAP,IAAoB,CAAC,CAAC,KAAKD,WAAjC;EAA6C;;EAAAe,MAAM,CAACpI,CAAD,EAAGE,CAAH,EAAK;IAAC,KAAKwG,MAAL,GAAYxG,CAAZ;IAAc,MAAME,CAAC,GAACF,CAAC,CAACmI,MAAF,CAASC,UAAT,CAAoB,CAApB,EAAuBC,OAA/B;IAAA,MAAuC7H,CAAC,GAACY,CAAC,CAAC,KAAKkH,OAAN,EAAcpI,CAAd,CAA1C;;IAA2D,IAAG,CAACJ,CAAC,CAACyI,OAAF,CAAUC,OAAV,IAAmB1I,CAAC,CAACyI,OAAF,CAAUE,SAA9B,MAA2C3I,CAAC,CAACuI,OAAF,CAAU5D,IAAV,GAAe,CAAC,CAA3D,GAA8DjE,CAAC,KAAGT,GAAG,CAAC,sBAAD,CAAH,IAA6B2I,OAAO,CAACC,KAAR,CAAc,mCAAd,EAAkDnI,CAAlD,CAA7B,EAAkFV,CAAC,CAACuI,OAAF,CAAU5D,IAAV,GAAe,CAAC,CAAlG,EAAoG,KAAK6D,OAAL,GAAapI,CAAjH,EAAmH,KAAK2G,qBAAL,GAA2B,IAA9I,EAAmJ,CAACzG,CAAC,CAACF,CAAD,CAAxJ,CAAlE,EAA+N;MAAC,QAAOA,CAAC,CAAC0I,MAAT;QAAiB,KAAI,SAAJ;UAAc,KAAK9B,WAAL,GAAiBzE,CAAjB;UAAmB;;QAAM,KAAI,WAAJ;UAAgB,KAAKyE,WAAL,GAAiB3E,CAAjB;MAAxE;;MAA2F,IAAG,cAAYjC,CAAC,CAAC2I,IAAjB,EAAsB;QAAC,KAAKhC,qBAAL,GAA2B;UAACiC,SAAS,EAAC,CAAC,CAAZ;UAAcC,YAAY,EAAC7I,CAAC,CAAC6I,YAA7B;UAA0CrB,GAAG,EAAC,IAAIsB,GAAJ;QAA9C,CAA3B;;QAAkF,KAAI,MAAMlJ,CAAV,IAAeI,CAAC,CAAC+I,OAAjB,EAAyB;UAAC,MAAMjJ,CAAC,GAACE,CAAC,CAAC+I,OAAF,CAAUnJ,CAAV,CAAR;UAAqB,IAAGQ,CAAC,CAACN,CAAD,CAAD,IAAMM,CAAC,CAACN,CAAC,CAACkJ,SAAH,CAAV,EAAwB,KAAI,MAAMhJ,CAAV,IAAeF,CAAC,CAACkJ,SAAjB,EAA2B,KAAKC,cAAL,CAAoBjJ,CAApB,EAAsBkJ,QAAQ,CAACtJ,CAAD,EAAG,EAAH,CAA9B;QAAsC;MAAC,CAAlP,MAAsP;QAAC,IAAG,KAAK+G,qBAAL,GAA2B;UAACiC,SAAS,EAAC,CAAC,CAAZ;UAAcpB,GAAG,EAAC,IAAIsB,GAAJ;QAAlB,CAA3B,EAAsD1I,CAAC,CAACJ,CAAC,CAACgJ,SAAH,CAA1D,EAAwE,KAAI,MAAMpJ,CAAV,IAAeI,CAAC,CAACgJ,SAAjB,EAA2B,KAAKC,cAAL,CAAoBrJ,CAApB;QAAuB,IAAGQ,CAAC,CAACJ,CAAC,CAACmJ,gBAAH,CAAJ,EAAyB,KAAI,MAAMvJ,CAAV,IAAeI,CAAC,CAACmJ,gBAAjB,EAAkC,KAAKF,cAAL,CAAoBrJ,CAApB;MAAuB;IAAC;EAAC;;EAAAwJ,UAAU,CAACxJ,CAAD,EAAGE,CAAH,EAAK;IAAC,IAAGI,CAAC,CAACJ,CAAC,CAACuJ,WAAH,CAAJ,EAAoB;IAAO,MAAMrJ,CAAC,GAACF,CAAC,CAACuJ,WAAF,CAAcC,SAAd,EAAR;;IAAkC,OAAKtJ,CAAC,CAACuJ,IAAF,EAAL,GAAe;MAAC,MAAM3J,CAAC,GAACI,CAAC,CAACwJ,YAAF,EAAR;MAAyB,KAAKC,gBAAL,CAAsB7J,CAAtB,EAAwBI,CAAxB;IAA2B;EAAC;;EAAM0J,YAAY,CAAC9J,CAAD,EAAGE,CAAH,EAAK;IAAA;;IAAA;MAAC,MAAME,CAAC,GAAC,CAAR;MAAA,MAAUE,CAAC,GAAC,KAAI,CAACyJ,SAAL,CAAe,CAAf,CAAZ;MAAA,MAA8BvJ,CAAC,GAACN,CAAC,CAAC0H,GAAF,CAAO5H,CAAC,IAAEyC,CAAC,CAACzC,CAAD,CAAX,CAAhC;;MAAiDM,CAAC,CAACmF,IAAF,IAASnF,CAAC,CAACwE,uBAAF,CAA0B,CAA1B,EAA4B1E,CAA5B,CAAT,EAAwCE,CAAC,CAAC0E,YAAF,CAAe,CAAf,EAAiB5E,CAAjB,EAAmBI,CAAnB,CAAxC,EAA8DF,CAAC,CAACuF,MAAF,EAA9D,EAAyE,KAAI,CAAC0B,eAAL,CAAqByC,KAArB,EAAzE;;MAAsG,KAAI,MAAMtJ,CAAV,IAAeV,CAAf,EAAiB,KAAI,CAACuH,eAAL,CAAqB0C,GAArB,CAAyBvJ,CAAzB;;MAA4B,MAAM,KAAI,CAACwJ,WAAL,EAAN;IAArM;EAA8N;;EAAMC,aAAa,CAACnK,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAO;IAAA;;IAAA;MAAC,MAAK;QAACgK,OAAO,EAAC9J,CAAT;QAAW+J,gBAAgB,EAAC7J;MAA5B,IAA+BJ,CAApC;MAAA,MAAsC;QAACkK,OAAO,EAAC5J;MAAT,IAAYR,CAAlD;MAAA,MAAoDU,CAAC,GAACF,CAAC,CAACkH,GAAF,CAAO,CAAC5H,CAAD,EAAGE,CAAH,KAAO,MAAI,CAACqK,aAAL,CAAmBvK,CAAnB,EAAqBE,CAArB,EAAuBI,CAAvB,EAAyBE,CAAzB,CAAd,CAAtD;MAAkG,OAAOgK,OAAO,CAACC,GAAR,CAAY7J,CAAZ,CAAP,EAAuB8J,IAAvB,CAA6B1K,CAAC,IAAEA,CAAhC,MAAsCA,CAAC,CAACuI,OAAF,CAAU+B,OAAV,GAAkB,CAAC,CAAnB,EAAqBrK,GAAG,CAAC,sBAAD,CAAH,IAA6B2I,OAAO,CAACC,KAAR,CAAc,mCAAd,EAAkD,iBAAlD,CAAxF;IAAnG;EAAiQ;;EAAAtD,OAAO,CAACvF,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAAS;IAAC,MAAME,CAAC,GAACiC,CAAC,CAACzC,CAAD,CAAT;IAAa,KAAK2K,mBAAL,CAAyBnK,CAAzB,GAA4B,KAAKuJ,SAAL,CAAe7J,CAAf,EAAkBqF,OAAlB,CAA0BvF,CAA1B,EAA4BI,CAA5B,EAA8BE,CAA9B,CAA5B;EAA6D;;EAAAgF,OAAO,CAACtF,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAO;IAAC,OAAO,KAAK2J,SAAL,CAAe7J,CAAf,EAAkBoF,OAAlB,CAA0BtF,CAA1B,EAA4BI,CAA5B,CAAP;EAAsC;;EAAAwK,gBAAgB,CAAC5K,CAAD,EAAG;IAAC,OAAO,KAAKuH,eAAL,CAAqBtH,GAArB,CAAyBD,CAAzB,IAA4B2B,CAA5B,GAA8B,CAArC;EAAuC;;EAAAkJ,kBAAkB,CAAC7K,CAAD,EAAG;IAAC,MAAME,CAAC,GAACuC,CAAC,CAACzC,CAAD,CAAT;;IAAa,KAAK+J,SAAL,CAAe,CAAf,EAAkBxE,OAAlB,CAA0BrF,CAA1B,EAA4B,CAA5B,EAA8B,CAA9B;EAAiC;;EAAA2J,gBAAgB,CAAC7J,CAAD,EAAGE,CAAH,EAAK;IAAC,MAAMI,CAAC,GAACmC,CAAC,CAACzC,CAAD,CAAT;IAAa,IAAG,KAAK2K,mBAAL,CAAyBrK,CAAzB,GAA4B,KAAKyJ,SAAL,CAAe,CAAf,EAAkBxE,OAAlB,CAA0BjF,CAA1B,EAA4B,CAA5B,EAA8B,KAAKwK,cAAL,CAAoB5K,CAApB,CAA9B,CAA5B,EAAkF,KAAK8G,WAAL,KAAmBrE,CAAC,CAAC3C,CAAD,CAAzG,EAA6G;IAAO,MAAMQ,CAAC,GAAC,KAAKuG,qBAAb;IAAA,MAAmCrG,CAAC,GAAC,KAAKgG,MAAL,CAAYe,oBAAZ,GAAiC,CAAjC,GAAmC,CAAxE;IAAA,MAA0E7G,CAAC,GAAC,CAA5E;IAA8E,IAAIE,CAAC,GAAC,IAAN;IAAWN,CAAC,KAAGM,CAAC,GAACN,CAAC,CAACwI,SAAF,GAAYxI,CAAC,CAACoH,GAAF,CAAMmD,GAAN,CAAU7K,CAAC,CAAC8K,aAAF,CAAgBxK,CAAC,CAACyI,YAAlB,CAAV,CAAZ,GAAuDzI,CAAC,CAACoH,GAA3D,EAA+D9G,CAAC,IAAEA,CAAC,CAACmD,IAAL,IAAWnD,CAAC,CAACmK,OAAF,CAAW,CAACjL,CAAD,EAAGQ,CAAH,KAAO;MAAC,MAAMM,CAAC,GAACN,CAAC,GAACE,CAAF,GAAIE,CAAZ;MAAA,MAAcI,CAAC,GAACiE,IAAI,CAACiG,KAAL,CAAW1K,CAAC,GAACE,CAAF,GAAIE,CAAf,CAAhB;MAAA,MAAkCM,CAAC,GAAC,KAAK6I,SAAL,CAAe/I,CAAC,GAACa,CAAjB,CAApC;MAAA,MAAwDT,CAAC,GAACpB,CAAC,CAACE,CAAD,CAA3D;;MAA+D,IAAG,KAAKwG,MAAL,CAAYe,oBAAf,EAAoCvG,CAAC,CAACqE,OAAF,CAAUjF,CAAV,EAAYQ,CAAZ,EAAcM,CAAd,EAApC,KAA0D,IAAGA,CAAC,KAAGW,CAAP,EAASb,CAAC,CAACqE,OAAF,CAAUjF,CAAV,EAAYQ,CAAZ,EAAc,GAAd,GAAmBI,CAAC,CAACqE,OAAF,CAAUjF,CAAV,EAAYQ,CAAC,GAAC,CAAd,EAAgB,GAAhB,CAAnB,CAAT,KAAqD;QAAC,MAAMd,CAAC,GAACI,CAAC,CAAC6E,IAAI,CAACkG,KAAL,CAAW/J,CAAX,CAAD,EAAe,CAAC,KAAhB,EAAsB,KAAtB,CAAD,GAA8B,KAAtC;QAAA,MAA4ClB,CAAC,GAAC,MAAIF,CAAlD;QAAA,MAAoDQ,CAAC,GAAC,CAAC,QAAMR,CAAP,KAAW,CAAjE;QAAmEkB,CAAC,CAACqE,OAAF,CAAUjF,CAAV,EAAYQ,CAAZ,EAAcZ,CAAd,GAAiBgB,CAAC,CAACqE,OAAF,CAAUjF,CAAV,EAAYQ,CAAC,GAAC,CAAd,EAAgBN,CAAhB,CAAjB;MAAoC;IAAC,CAA1S,CAA7E,CAAD;EAA4X;;EAAA0J,WAAW,GAAE;IAAC,IAAGjK,GAAG,CAAC,sBAAD,CAAH,IAA6B2I,OAAO,CAACC,KAAR,CAAc,4BAAd,CAA7B,EAAyE,KAAKlC,aAAL,EAAzE,EAA8F,KAAKU,WAAtG,EAAkH,OAAO,KAAKA,WAAL,CAAiB+D,OAAxB;IAAgC,IAAG,KAAK9D,WAAR,EAAoB,OAAO,KAAKD,WAAL,GAAiBnG,CAAC,EAAlB,EAAqB,KAAKmG,WAAL,CAAiB+D,OAA7C;IAAqD,MAAMlL,CAAC,GAAC;MAACmL,MAAM,EAAC,KAAKzE,OAAL,CAAagB,GAAb,CAAkB5H,CAAC,IAAEQ,CAAC,CAACR,CAAD,CAAD,GAAKA,CAAC,CAACgG,SAAF,EAAL,GAAmB,IAAxC;IAAR,CAAR;IAAgE,OAAO,KAAKsB,WAAL,GAAiB,KAAKgE,gBAAL,GAAwBC,IAAxB,CAA8B,MAAI;MAAC,MAAMvL,CAAC,GAAC,MAAI;QAAC,IAAG,KAAKsH,WAAL,GAAiB,IAAjB,EAAsB,KAAKD,WAA9B,EAA0C;UAAC,MAAMrH,CAAC,GAAC,KAAKqH,WAAb;UAAyB,KAAKA,WAAL,GAAiB,IAAjB,EAAsB,KAAK6C,WAAL,GAAmBqB,IAAnB,CAAyB,MAAIvL,CAAC,CAACwL,OAAF,EAA7B,CAAtB;QAAiE,CAArI,MAA0IvL,GAAG,CAAC,sBAAD,CAAH,IAA6B2I,OAAO,CAACC,KAAR,CAAc,0DAAd,CAA7B;;QAAuG,KAAKlC,aAAL;MAAqB,CAAnR;;MAAoR1G,GAAG,CAAC,sBAAD,CAAH,IAA6B2I,OAAO,CAACC,KAAR,CAAc,2CAAd,CAA7B;;MAAwF,MAAMzI,CAAC,GAAC,KAAKqG,OAAL,CAAa2B,MAAb,CAAoBlI,CAApB,EAAsB,KAAK8H,OAA3B,EAAoCuD,IAApC,CAAyCvL,CAAzC,EAA4CyL,KAA5C,CAAkDzL,CAAlD,CAAR;;MAA6D,OAAO,KAAKyG,OAAL,CAAaiF,MAAb,CAAoB,KAAK1D,OAAzB,GAAkC5H,CAAzC;IAA2C,CAAvf,EAA0fqL,KAA1f,CAAigBvL,CAAC,IAAE;MAAC,IAAGkB,CAAC,CAAClB,CAAD,CAAJ,EAAQ,OAAO,KAAKyL,uBAAL,GAA6B,IAA7B,EAAkC,KAAKL,gBAAL,EAAzC;MAAiE,KAAK3E,aAAL,IAAqBnD,CAAC,CAACgC,KAAF,CAAQ,IAAIxF,CAAJ,CAAM,yBAAN,EAAgC,2CAAhC,EAA4EE,CAA5E,CAAR,CAArB;IAA6G,CAA3rB,CAAjB,EAA+sB,KAAKoH,WAA3tB;EAAuuB;;EAAAqD,mBAAmB,CAAC3K,CAAD,EAAG;IAAC,OAAKA,CAAC,IAAE,KAAKoH,KAAL,GAAW,KAAKA,KAAxB,GAA+B,IAAG,KAAKwE,OAAL,EAAH,EAAkB;EAAO;;EAAAvC,cAAc,CAACrJ,CAAD,EAAGE,CAAH,EAAK;IAAC,SAASE,CAAT,GAAY;MAAC,MAAK;QAACyL,kBAAkB,EAAC3L;MAApB,IAAuBF,CAA5B;MAA8B,OAAOE,CAAC,GAACE,CAAC,IAAE;QAAC,MAAME,CAAC,GAACF,CAAC,CAAC4K,aAAF,CAAgB9K,CAAhB,CAAR;QAA2B,IAAG,CAACI,CAAJ,EAAM,OAAO,IAAP;QAAY,OAAOF,CAAC,CAAC4K,aAAF,CAAgBhL,CAAC,CAAC8L,KAAlB,IAAyBxL,CAAhC;MAAkC,CAApF,GAAqFJ,CAAC,IAAEA,CAAC,CAAC8K,aAAF,CAAgBhL,CAAC,CAAC8L,KAAlB,CAAhG;IAAyH;;IAAA,SAASxL,CAAT,GAAY;MAAC,OAAON,CAAC,CAAC6L,kBAAF,IAAsBrI,CAAC,CAACuI,IAAF,CAAO,gBAAP,EAAwB,yFAAxB,CAAtB,EAAyI7L,CAAC,IAAEA,CAAC,CAAC8L,yBAAF,CAA4BhM,CAAC,CAACiM,UAA9B,CAAnJ;IAA6L;;IAAA,IAAIzL,CAAJ;IAAM,IAAG,QAAMR,CAAC,CAACiM,UAAX,EAAsBzL,CAAC,GAACF,CAAC,EAAH,CAAtB,KAAgC;MAAC,IAAG,CAACN,CAAC,CAAC8L,KAAN,EAAY;MAAOtL,CAAC,GAACJ,CAAC,EAAH;IAAM;IAAA,MAAK;MAAC8L,mBAAmB,EAACxL;IAArB,IAAwBV,CAA7B;;IAA+B,IAAGU,CAAH,EAAK;MAACF,CAAC,GAACsD,CAAC,CAACtD,CAAD,EAAIR,CAAC,IAAEqD,CAAC,CAACrD,CAAD,EAAGU,CAAH,CAAR,CAAH;IAAmB;;IAAA,MAAME,CAAC,GAACZ,CAAC,IAAE,SAAOA,CAAP,IAAUmM,KAAK,CAACnM,CAAD,CAAf,IAAoBA,CAAC,KAAG,IAAE,CAA1B,IAA6BA,CAAC,KAAG,CAAC,CAAD,GAAG,CAApC,GAAsC+B,CAAtC,GAAwC/B,CAAnD;IAAA,MAAqDc,CAAC,GAAC,KAAKiG,qBAA5D;;IAAkF,IAAGjG,CAAC,CAACkI,SAAL,EAAe;MAAC,MAAM5I,CAAC,GAACU,CAAC,CAAC8G,GAAF,CAAMmD,GAAN,CAAU7K,CAAV,KAAc,IAAIgJ,GAAJ,EAAtB;MAA8B9I,CAAC,CAAC2F,GAAF,CAAM/F,CAAC,CAACoM,OAAR,EAAgBtI,CAAC,CAACtD,CAAD,EAAGI,CAAH,CAAjB,GAAwBE,CAAC,CAAC8G,GAAF,CAAM7B,GAAN,CAAU7F,CAAV,EAAYE,CAAZ,CAAxB;IAAuC,CAArF,MAA0FU,CAAC,CAAC8G,GAAF,CAAM7B,GAAN,CAAU/F,CAAC,CAACoM,OAAZ,EAAoBtI,CAAC,CAACtD,CAAD,EAAGI,CAAH,CAArB;EAA4B;;EAAA0K,gBAAgB,GAAE;IAAC,IAAG9K,CAAC,CAAC,KAAKmL,uBAAN,CAAJ,EAAmC,OAAO,KAAKA,uBAAZ;IAAoC,KAAK5B,SAAL,CAAe9H,CAAf,GAAkB,KAAK8H,SAAL,CAAe5H,CAAf,CAAlB,EAAoCuB,CAAC,CAAC,6BAAD,CAArC;;IAAqE,MAAMxD,CAAC,GAAC;MAACmM,MAAM,EAAC1I,CAAC,CAACC,iBAAF,IAAqB,EAAE,YAAU,KAAK6C,OAAL,CAAasC,IAAzB,CAA7B;MAA4D9E,IAAI,EAAC,KAAKmD,KAAtE;MAA4EiE,MAAM,EAAC3K,CAAC,CAAC,KAAKkG,OAAN,EAAe5G,CAAC,KAAG;QAACuE,WAAW,EAACvE,CAAC,CAACuE,WAAf;QAA2BM,MAAM,EAAC7E,CAAC,CAAC6E,MAApC;QAA2CR,SAAS,EAACrE,CAAC,CAACqE;MAAvD,CAAH,CAAhB;IAApF,CAAR;IAAA,MAAqLjE,CAAC,GAAC,KAAKqG,OAAL,CAAa6F,UAAb,CAAwBpM,CAAxB,EAA0B,KAAK8H,OAA/B,EAAwCyD,KAAxC,CAA+CvL,CAAC,IAAE;MAACkB,CAAC,CAAClB,CAAD,CAAD,GAAK,KAAKyL,uBAAL,GAA6B,IAAlC,GAAuCnI,CAAC,CAACgC,KAAF,CAAQ,IAAIxF,CAAJ,CAAM,yBAAN,EAAgC,mDAAhC,EAAoFE,CAApF,CAAR,CAAvC;IAAuI,CAA1L,CAAvL;;IAAoX,OAAO,KAAKyL,uBAAL,GAA6BvL,CAA7B,EAA+BA,CAAC,CAACmL,IAAF,CAAQ,MAAIjL,CAAC,CAAC,KAAKqL,uBAAN,CAAD,GAAgC,KAAKL,gBAAL,EAAhC,GAAwD,KAAK,CAAzE,CAA/B,EAA4GlL,CAAnH;EAAqH;;EAAA2J,SAAS,CAAC/J,CAAD,EAAG;IAAC,MAAME,CAAC,GAAC,KAAK0G,OAAL,CAAa5G,CAAb,CAAR;IAAwB,IAAGQ,CAAC,CAACN,CAAD,CAAJ,EAAQ,OAAOA,CAAP;IAASwD,CAAC,CAAE,wCAAuC1D,CAAE,EAA3C,CAAD;IAA+C,MAAMI,CAAC,GAACuD,CAAC,CAACC,iBAAV;IAAA,MAA4BtD,CAAC,GAAC,KAAKmG,OAAL,CAAasC,IAA3C;IAAA,MAAgDrI,CAAC,GAAC,IAAIqD,CAAJ,CAAM3D,CAAN,EAAQE,CAAR,EAAU,KAAK8G,KAAf,EAAqB,KAAKO,iBAAL,CAAuB3H,CAAvB,CAArB,CAAlD;IAAkG,OAAO,KAAK4G,OAAL,CAAa5G,CAAb,IAAgBU,CAAhB,EAAkB,KAAKiL,uBAAL,GAA6B,IAA/C,EAAoDjL,CAA3D;EAA6D;;EAAAkL,OAAO,GAAE;IAAC,IAAG,KAAKxE,KAAL,GAAW,KAAKV,MAAL,CAAY6F,cAA1B,EAAyC;MAAC,MAAMvM,CAAC,GAAC,KAAKoH,KAAL,KAAa,CAArB;MAAuB,OAAO1D,CAAC,CAAC,yBAAD,EAA2B1D,CAA3B,EAA6B,KAAK4G,OAAlC,CAAD,EAA4ChG,CAAC,CAAC,KAAKgG,OAAN,EAAe1G,CAAC,IAAEA,CAAC,CAAC4F,MAAF,CAAS9F,CAAT,CAAlB,CAA7C,EAA6E,KAAK2L,uBAAL,GAA6B,IAA1G,EAA+G,KAAKvE,KAAL,GAAWpH,CAA1H,EAA4H,CAAnI;IAAqI;;IAAA,OAAOwD,CAAC,CAACgC,KAAF,CAAQ,IAAIxF,CAAJ,CAAM,qBAAN,EAA4B,+CAA5B,CAAR,GAAsF,CAAC,CAA9F;EAAgG;;EAAMuK,aAAa,CAACvK,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOM,CAAP,EAAS;IAAA;;IAAA;MAAC,MAAME,CAAC,GAAC,MAAI,CAACkG,QAAL,CAAc5G,CAAd,CAAR;MAAA,MAAyBY,CAAC,GAACN,CAAC,CAACI,CAAD,CAAD,IAAMA,CAAC,CAAC4L,IAAnC;MAAwC,IAAG,CAAC5L,CAAD,IAAI,CAACZ,CAAR,EAAU,OAAM,CAAC,CAAP;MAAS,IAAGc,CAAC,KAAG2L,IAAI,CAACC,SAAL,CAAe1M,CAAf,CAAP,EAAyB,OAAM,CAAC,CAAP;;MAAS,IAAGM,CAAC,CAACN,CAAD,CAAJ,EAAQ;QAAC,IAAG,CAACY,CAAJ,EAAM,OAAM,CAAC,CAAP;;QAAS,MAAMZ,CAAC,GAAC,KAAGE,CAAC,GAAC,CAAb;QAAA,MAAeE,CAAC,GAAC,MAAI,CAAC2J,SAAL,CAAe,CAAf,CAAjB;;QAAmC,OAAO,MAAI,CAACjD,QAAL,CAAc5G,CAAd,IAAiB,IAAjB,EAAsBE,CAAC,CAAC2E,qBAAF,CAAwB,CAAxB,EAA0B/E,CAA1B,CAAtB,EAAmD,MAAI,CAACkK,WAAL,EAAnD,EAAsE,CAAC,CAA9E;MAAgF;;MAAA,MAAMlJ,CAAC,SAAO,MAAI,CAAC2L,UAAL,CAAgBzM,CAAhB,EAAkBE,CAAlB,CAAd;MAAmC,OAAO,MAAMY,CAAC,CAACoH,MAAF,CAASpI,CAAT,EAAWU,CAAX,CAAN,EAAoB,CAAC,CAA5B;IAA5Q;EAA0S;;EAAMiM,UAAU,CAAC3M,CAAD,EAAGE,CAAH,EAAK;IAAA;;IAAA;MAAC,MAAME,CAAC,GAAC,MAAI,CAAC0G,QAAL,CAAc9G,CAAd,CAAR;MAAyB,IAAGQ,CAAC,CAACJ,CAAD,CAAJ,EAAQ,OAAOA,CAAP;MAAS,MAAK;QAACwM,OAAO,EAACtM;MAAT,UAAkB,OAAO,oBAAP,CAAvB;MAAA,MAAoDI,CAAC,GAAC,IAAIJ,CAAJ,CAAM;QAACuM,YAAY,EAAC3M,CAAC,CAAC2M,YAAhB;QAA6BC,IAAI,EAAC,CAAC,CAAnC;QAAqCC,IAAI,EAAC,CAAC,CAA3C;QAA6CC,QAAQ,EAAC9M,CAAC,CAAC8M,QAAxD;QAAiEC,WAAW,EAAC,IAAI1L,CAAJ,CAAMrB,CAAC,CAACgN,MAAR;MAA7E,CAAN,CAAtD;MAA2J,OAAO,MAAI,CAACpG,QAAL,CAAc9G,CAAd,IAAiBU,CAAjB,EAAmBA,CAA1B;IAAtM;EAAkO;;EAAAyM,SAAS,CAACnN,CAAD,EAAG;IAAC,OAAM,CAAC,EAAE,IAAE,KAAK+J,SAAL,CAAe,CAAf,EAAkBzE,OAAlB,CAA0BtF,CAA1B,EAA4B,CAA5B,CAAJ,CAAP;EAA2C;;EAAA8K,cAAc,CAAC9K,CAAD,EAAG;IAAC,IAAIE,CAAC,GAAC,CAAN;IAAQ,MAAME,CAAC,GAACyC,CAAC,CAAC7C,CAAC,CAAC4J,YAAF,EAAD,CAAT;;IAA4B,KAAI,IAAIlJ,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,KAAKoG,QAAL,CAAcP,MAA5B,EAAmC7F,CAAC,EAApC,EAAuC;MAAC,MAAMF,CAAC,GAAC,CAAC,EAAEJ,CAAC,GAAC,KAAGM,CAAP,CAAT;MAAA,MAAmBE,CAAC,GAAC,KAAKkG,QAAL,CAAcpG,CAAd,CAArB;MAAsCR,CAAC,IAAE,CAAC,CAACM,CAAD,IAAIF,CAAC,CAACM,CAAD,CAAL,IAAUA,CAAC,CAACwM,KAAF,CAAQpN,CAAR,CAAV,GAAqB,CAArB,GAAuB,CAAxB,KAA4BU,CAA/B;IAAiC;;IAAA,IAAIF,CAAC,GAAC,CAAN;;IAAQ,IAAG,KAAK+G,eAAL,CAAqBtD,IAAxB,EAA6B;MAAC,MAAM/D,CAAC,GAACF,CAAC,CAACqN,WAAF,EAAR;MAAwB7M,CAAC,GAAC,KAAKoK,gBAAL,CAAsB1K,CAAtB,CAAF;IAA2B;;IAAA,OAAOA,CAAC,IAAE,CAAH,GAAKM,CAAZ;EAAc;;AAAxtO;;AAAytO,SAAOgG,CAAC,IAAIoG,OAAZ"},"metadata":{},"sourceType":"module"}