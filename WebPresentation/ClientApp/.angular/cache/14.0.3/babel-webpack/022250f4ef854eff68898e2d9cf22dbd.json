{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/ClientApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport e from \"../../../../request.js\";\nimport { createTask as t } from \"../../../../core/asyncUtils.js\";\nimport s from \"../../../../core/Error.js\";\nimport i from \"../../../../core/Logger.js\";\nimport { isSome as r } from \"../../../../core/maybe.js\";\nimport { isAbortError as n } from \"../../../../core/promiseUtils.js\";\nimport { getJsonType as a } from \"../../../../geometry/support/jsonUtils.js\";\nimport { WGS84 as o, equals as u } from \"../../../../geometry/support/spatialReferenceUtils.js\";\nimport { convertFromGeometry as l, convertToGeometry as d, convertFromFeatures as p, convertToFeature as c, convertFromFeature as h } from \"../../featureConversionUtils.js\";\nimport y from \"../../data/FeatureStore.js\";\nimport { checkProjectionSupport as m, project as f } from \"../../data/projectionSupport.js\";\nimport { QueryEngine as g } from \"../../data/QueryEngine.js\";\nimport { inferLayerProperties as _, createOptimizedFeatures as I, validateGeoJSON as j } from \"./geojson.js\";\nimport { createDrawingInfo as F, createDefaultTemplate as E, createDefaultAttributesFunction as b } from \"../support/clientSideDefaults.js\";\nimport { loadGeometryEngineForSimplify as w, mixAttributes as T, createFeatureEditSuccessResult as x, createFeatureEditErrorResult as q, simplify as S } from \"../support/sourceUtils.js\";\nimport R from \"../../../support/FieldsIndex.js\";\nimport { kebabDict as k } from \"../../../support/fieldType.js\";\nimport { getFieldDefaultValue as O } from \"../../../support/fieldUtils.js\";\nconst C = {\n  hasAttachments: !1,\n  capabilities: \"query, editing, create, delete, update\",\n  useStandardizedQueries: !0,\n  supportsCoordinatesQuantization: !0,\n  supportsReturningQueryGeometry: !0,\n  advancedQueryCapabilities: {\n    supportsQueryAttachments: !1,\n    supportsStatistics: !0,\n    supportsPercentileStatistics: !0,\n    supportsReturningGeometryCentroid: !0,\n    supportsQueryWithDistance: !0,\n    supportsDistinct: !0,\n    supportsReturningQueryExtent: !0,\n    supportsReturningGeometryProperties: !1,\n    supportsHavingClause: !0,\n    supportsOrderBy: !0,\n    supportsPagination: !0,\n    supportsQueryWithResultType: !1,\n    supportsSqlExpression: !0,\n    supportsDisjointSpatialRel: !0\n  }\n};\n\nclass D {\n  constructor() {\n    var _this = this;\n\n    this._queryEngine = null, this._snapshotFeatures = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (e) {\n        const t = yield _this._fetch(e);\n        return _this._createFeatures(t);\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n  }\n\n  destroy() {\n    this._queryEngine?.destroy(), this._queryEngine = this._fieldsIndex = this._createDefaultAttributes = null;\n  }\n\n  load(e, t = {}) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      _this2._loadOptions = {\n        url: e.url,\n        customParameters: e.customParameters\n      };\n      const i = [];\n      yield _this2._checkProjection(e.spatialReference);\n      let r = null;\n      e.url && (r = yield _this2._fetch(t?.signal));\n\n      const n = _(r, {\n        geometryType: e.geometryType\n      }),\n            a = e.fields || n.fields || [],\n            u = null != e.hasZ ? e.hasZ : n.hasZ,\n            l = n.geometryType;\n\n      let d = e.objectIdField || n.objectIdFieldName || \"__OBJECTID\";\n      const p = e.spatialReference || o;\n      let c = e.timeInfo;\n      a === n.fields && n.unknownFields.length > 0 && i.push({\n        name: \"geojson-layer:unknown-field-types\",\n        message: \"Some fields types couldn't be inferred from the features and were dropped\",\n        details: {\n          unknownFields: n.unknownFields\n        }\n      });\n      let h = new R(a).get(d);\n      h ? (\"esriFieldTypeString\" !== h.type && (h.type = \"esriFieldTypeOID\"), h.editable = !1, h.nullable = !1, d = h.name) : (h = {\n        alias: d,\n        name: d,\n        type: \"string\" === n.objectIdFieldType ? \"esriFieldTypeString\" : \"esriFieldTypeOID\",\n        editable: !1,\n        nullable: !1\n      }, a.unshift(h));\n      const m = {};\n\n      for (const o of a) {\n        if (null == o.name && (o.name = o.alias), null == o.alias && (o.alias = o.name), !o.name) throw new s(\"geojson-layer:invalid-field-name\", \"field name is missing\", {\n          field: o\n        });\n        if (!k.jsonValues.includes(o.type)) throw new s(\"geojson-layer:invalid-field-type\", `invalid type for field \"${o.name}\"`, {\n          field: o\n        });\n\n        if (o.name !== h.name) {\n          const e = O(o);\n          void 0 !== e && (m[o.name] = e);\n        }\n      }\n\n      _this2._fieldsIndex = new R(a);\n\n      const f = _this2._fieldsIndex.requiredFields.indexOf(h);\n\n      if (f > -1 && _this2._fieldsIndex.requiredFields.splice(f, 1), c) {\n        if (c.startTimeField) {\n          const e = _this2._fieldsIndex.get(c.startTimeField);\n\n          e ? (c.startTimeField = e.name, e.type = \"esriFieldTypeDate\") : c.startTimeField = null;\n        }\n\n        if (c.endTimeField) {\n          const e = _this2._fieldsIndex.get(c.endTimeField);\n\n          e ? (c.endTimeField = e.name, e.type = \"esriFieldTypeDate\") : c.endTimeField = null;\n        }\n\n        if (c.trackIdField) {\n          const e = _this2._fieldsIndex.get(c.trackIdField);\n\n          e ? c.trackIdField = e.name : (c.trackIdField = null, i.push({\n            name: \"geojson-layer:invalid-timeInfo-trackIdField\",\n            message: \"trackIdField is missing\",\n            details: {\n              timeInfo: c\n            }\n          }));\n        }\n\n        c.startTimeField || c.endTimeField || (i.push({\n          name: \"geojson-layer:invalid-timeInfo\",\n          message: \"startTimeField and endTimeField are missing\",\n          details: {\n            timeInfo: c\n          }\n        }), c = null);\n      }\n\n      const I = l ? F(l) : void 0,\n            j = {\n        warnings: i,\n        featureErrors: [],\n        layerDefinition: { ...C,\n          drawingInfo: I ?? void 0,\n          templates: E(m),\n          extent: void 0,\n          geometryType: l,\n          objectIdField: d,\n          fields: a,\n          hasZ: !!u,\n          timeInfo: c\n        }\n      };\n      _this2._queryEngine = new g({\n        fields: a,\n        geometryType: l,\n        hasM: !1,\n        hasZ: u,\n        objectIdField: d,\n        spatialReference: p,\n        timeInfo: c,\n        featureStore: new y({\n          geometryType: l,\n          hasM: !1,\n          hasZ: u\n        }),\n        cacheSpatialQueries: !0\n      }), _this2._createDefaultAttributes = b(m, d);\n      const w = yield _this2._createFeatures(r);\n      _this2._objectIdGenerator = _this2._createObjectIdGenerator(_this2._queryEngine, w);\n\n      const T = _this2._normalizeFeatures(w, j.warnings, j.featureErrors);\n\n      _this2._queryEngine.featureStore.addMany(T);\n\n      const {\n        fullExtent: x,\n        timeExtent: q\n      } = yield _this2._queryEngine.fetchRecomputedExtents();\n\n      if (j.layerDefinition.extent = x, q) {\n        const {\n          start: e,\n          end: t\n        } = q;\n        j.layerDefinition.timeInfo.timeExtent = [e, t];\n      }\n\n      return j;\n    })();\n  }\n\n  applyEdits(e) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      const {\n        spatialReference: t,\n        geometryType: s\n      } = _this3._queryEngine;\n      return yield Promise.all([w(t, s), m(e.adds, t), m(e.updates, t)]), yield _this3._waitSnapshotComplete(), _this3._applyEdits(e);\n    })();\n  }\n\n  queryFeatures(e = {}, t = {}) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      return yield _this4._waitSnapshotComplete(), _this4._queryEngine.executeQuery(e, t.signal);\n    })();\n  }\n\n  queryFeatureCount(e = {}, t = {}) {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      return yield _this5._waitSnapshotComplete(), _this5._queryEngine.executeQueryForCount(e, t.signal);\n    })();\n  }\n\n  queryObjectIds(e = {}, t = {}) {\n    var _this6 = this;\n\n    return _asyncToGenerator(function* () {\n      return yield _this6._waitSnapshotComplete(), _this6._queryEngine.executeQueryForIds(e, t.signal);\n    })();\n  }\n\n  queryExtent(e = {}, t = {}) {\n    var _this7 = this;\n\n    return _asyncToGenerator(function* () {\n      return yield _this7._waitSnapshotComplete(), _this7._queryEngine.executeQueryForExtent(e, t.signal);\n    })();\n  }\n\n  querySnapping(e, t = {}) {\n    var _this8 = this;\n\n    return _asyncToGenerator(function* () {\n      return yield _this8._waitSnapshotComplete(), _this8._queryEngine.executeQueryForSnapping(e, t.signal);\n    })();\n  }\n\n  refresh(e) {\n    var _this9 = this;\n\n    return _asyncToGenerator(function* () {\n      _this9._loadOptions.customParameters = e, _this9._snapshotTask?.abort(), _this9._snapshotTask = t(_this9._snapshotFeatures), _this9._snapshotTask.promise.then(e => {\n        _this9._queryEngine.featureStore.clear(), _this9._objectIdGenerator = _this9._createObjectIdGenerator(_this9._queryEngine, e);\n\n        const t = _this9._normalizeFeatures(e);\n\n        t && _this9._queryEngine.featureStore.addMany(t);\n      }, e => {\n        _this9._queryEngine.featureStore.clear(), n(e) || i.getLogger(\"esri.layers.GeoJSONLayer\").error(new s(\"geojson-layer:refresh\", \"An error occurred during refresh\", {\n          error: e\n        }));\n      }), yield _this9._waitSnapshotComplete();\n      const {\n        fullExtent: r,\n        timeExtent: a\n      } = yield _this9._queryEngine.fetchRecomputedExtents();\n      return {\n        extent: r,\n        timeExtent: a\n      };\n    })();\n  }\n\n  _createFeatures(e) {\n    var _this10 = this;\n\n    return _asyncToGenerator(function* () {\n      if (null == e) return [];\n      const {\n        geometryType: t,\n        hasZ: s,\n        objectIdField: i\n      } = _this10._queryEngine,\n            n = I(e, {\n        geometryType: t,\n        hasZ: s,\n        objectIdField: i\n      });\n      if (!u(_this10._queryEngine.spatialReference, o)) for (const a of n) r(a.geometry) && (a.geometry = l(f(d(a.geometry, _this10._queryEngine.geometryType, _this10._queryEngine.hasZ, !1), o, _this10._queryEngine.spatialReference)));\n      return n;\n    })();\n  }\n\n  _waitSnapshotComplete() {\n    var _this11 = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this11._snapshotTask && !_this11._snapshotTask.finished) {\n        try {\n          yield _this11._snapshotTask.promise;\n        } catch {}\n\n        return _this11._waitSnapshotComplete();\n      }\n    })();\n  }\n\n  _fetch(t) {\n    var _this12 = this;\n\n    return _asyncToGenerator(function* () {\n      const {\n        url: s,\n        customParameters: i\n      } = _this12._loadOptions,\n            r = (yield e(s, {\n        responseType: \"json\",\n        query: { ...i\n        },\n        signal: t\n      })).data;\n      return yield j(r), r;\n    })();\n  }\n\n  _normalizeFeatures(e, t, s) {\n    const {\n      objectIdField: i\n    } = this._queryEngine,\n          r = [];\n\n    for (const n of e) {\n      const e = this._createDefaultAttributes(),\n            a = T(this._fieldsIndex, e, n.attributes, !0, t);\n\n      a ? s?.push(a) : (this._assignObjectId(e, n.attributes, !0), n.attributes = e, n.objectId = e[i], r.push(n));\n    }\n\n    return r;\n  }\n\n  _applyEdits(e) {\n    var _this13 = this;\n\n    return _asyncToGenerator(function* () {\n      const {\n        adds: t,\n        updates: s,\n        deletes: i\n      } = e,\n            r = {\n        addResults: [],\n        deleteResults: [],\n        updateResults: [],\n        uidToObjectId: {}\n      };\n\n      if (t && t.length && _this13._applyAddEdits(r, t), s && s.length && _this13._applyUpdateEdits(r, s), i && i.length) {\n        for (const e of i) r.deleteResults.push(x(e));\n\n        _this13._queryEngine.featureStore.removeManyById(i);\n      }\n\n      const {\n        fullExtent: n,\n        timeExtent: a\n      } = yield _this13._queryEngine.fetchRecomputedExtents();\n      return {\n        extent: n,\n        timeExtent: a,\n        featureEditResults: r\n      };\n    })();\n  }\n\n  _applyAddEdits(e, t) {\n    const {\n      addResults: s\n    } = e,\n          {\n      geometryType: i,\n      hasM: n,\n      hasZ: o,\n      objectIdField: u,\n      spatialReference: l,\n      featureStore: d\n    } = this._queryEngine,\n          c = [];\n\n    for (const p of t) {\n      if (p.geometry && i !== a(p.geometry)) {\n        s.push(q(\"Incorrect geometry type.\"));\n        continue;\n      }\n\n      const t = this._createDefaultAttributes(),\n            n = T(this._fieldsIndex, t, p.attributes);\n\n      if (n) s.push(n);else {\n        if (this._assignObjectId(t, p.attributes), p.attributes = t, null != p.uid) {\n          const t = p.attributes[u];\n          e.uidToObjectId[p.uid] = t;\n        }\n\n        if (r(p.geometry)) {\n          const e = p.geometry.spatialReference ?? l;\n          p.geometry = f(S(p.geometry, e), e, l);\n        }\n\n        c.push(p), s.push(x(p.attributes[u]));\n      }\n    }\n\n    d.addMany(p([], c, i, o, n, u));\n  }\n\n  _applyUpdateEdits({\n    updateResults: e\n  }, t) {\n    const {\n      geometryType: s,\n      hasM: i,\n      hasZ: n,\n      objectIdField: o,\n      spatialReference: u,\n      featureStore: l\n    } = this._queryEngine;\n\n    for (const d of t) {\n      const {\n        attributes: t,\n        geometry: p\n      } = d,\n            y = t && t[o];\n\n      if (null == y) {\n        e.push(q(`Identifier field ${o} missing`));\n        continue;\n      }\n\n      if (!l.has(y)) {\n        e.push(q(`Feature with object id ${y} missing`));\n        continue;\n      }\n\n      const m = c(l.getFeature(y), s, n, i);\n\n      if (r(p)) {\n        if (s !== a(p)) {\n          e.push(q(\"Incorrect geometry type.\"));\n          continue;\n        }\n\n        const t = p.spatialReference ?? u;\n        m.geometry = f(S(p, t), t, u);\n      }\n\n      if (t) {\n        const s = T(this._fieldsIndex, m.attributes, t);\n\n        if (s) {\n          e.push(s);\n          continue;\n        }\n      }\n\n      l.add(h(m, s, n, i, o)), e.push(x(y));\n    }\n  }\n\n  _createObjectIdGenerator(e, t) {\n    const s = e.fieldsIndex.get(e.objectIdField);\n    if (\"esriFieldTypeString\" === s.type) return () => s.name + \"-\" + Date.now().toString(16);\n    let i = Number.NEGATIVE_INFINITY;\n\n    for (const r of t) r.objectId && (i = Math.max(i, r.objectId));\n\n    return i = Math.max(0, i) + 1, () => i++;\n  }\n\n  _assignObjectId(e, t, s = !1) {\n    const i = this._queryEngine.objectIdField;\n    e[i] = s && i in t ? t[i] : this._objectIdGenerator();\n  }\n\n  _checkProjection(e) {\n    return _asyncToGenerator(function* () {\n      try {\n        yield m(o, e);\n      } catch {\n        throw new s(\"geojson-layer\", \"Projection not supported\");\n      }\n    })();\n  }\n\n}\n\nexport { D as default };","map":{"version":3,"names":["e","createTask","t","s","i","isSome","r","isAbortError","n","getJsonType","a","WGS84","o","equals","u","convertFromGeometry","l","convertToGeometry","d","convertFromFeatures","p","convertToFeature","c","convertFromFeature","h","y","checkProjectionSupport","m","project","f","QueryEngine","g","inferLayerProperties","_","createOptimizedFeatures","I","validateGeoJSON","j","createDrawingInfo","F","createDefaultTemplate","E","createDefaultAttributesFunction","b","loadGeometryEngineForSimplify","w","mixAttributes","T","createFeatureEditSuccessResult","x","createFeatureEditErrorResult","q","simplify","S","R","kebabDict","k","getFieldDefaultValue","O","C","hasAttachments","capabilities","useStandardizedQueries","supportsCoordinatesQuantization","supportsReturningQueryGeometry","advancedQueryCapabilities","supportsQueryAttachments","supportsStatistics","supportsPercentileStatistics","supportsReturningGeometryCentroid","supportsQueryWithDistance","supportsDistinct","supportsReturningQueryExtent","supportsReturningGeometryProperties","supportsHavingClause","supportsOrderBy","supportsPagination","supportsQueryWithResultType","supportsSqlExpression","supportsDisjointSpatialRel","D","constructor","_queryEngine","_snapshotFeatures","_fetch","_createFeatures","destroy","_fieldsIndex","_createDefaultAttributes","load","_loadOptions","url","customParameters","_checkProjection","spatialReference","signal","geometryType","fields","hasZ","objectIdField","objectIdFieldName","timeInfo","unknownFields","length","push","name","message","details","get","type","editable","nullable","alias","objectIdFieldType","unshift","field","jsonValues","includes","requiredFields","indexOf","splice","startTimeField","endTimeField","trackIdField","warnings","featureErrors","layerDefinition","drawingInfo","templates","extent","hasM","featureStore","cacheSpatialQueries","_objectIdGenerator","_createObjectIdGenerator","_normalizeFeatures","addMany","fullExtent","timeExtent","fetchRecomputedExtents","start","end","applyEdits","Promise","all","adds","updates","_waitSnapshotComplete","_applyEdits","queryFeatures","executeQuery","queryFeatureCount","executeQueryForCount","queryObjectIds","executeQueryForIds","queryExtent","executeQueryForExtent","querySnapping","executeQueryForSnapping","refresh","_snapshotTask","abort","promise","then","clear","getLogger","error","geometry","finished","responseType","query","data","attributes","_assignObjectId","objectId","deletes","addResults","deleteResults","updateResults","uidToObjectId","_applyAddEdits","_applyUpdateEdits","removeManyById","featureEditResults","uid","has","getFeature","add","fieldsIndex","Date","now","toString","Number","NEGATIVE_INFINITY","Math","max","default"],"sources":["C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/node_modules/@arcgis/core/layers/graphics/sources/geojson/GeoJSONSourceWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport e from\"../../../../request.js\";import{createTask as t}from\"../../../../core/asyncUtils.js\";import s from\"../../../../core/Error.js\";import i from\"../../../../core/Logger.js\";import{isSome as r}from\"../../../../core/maybe.js\";import{isAbortError as n}from\"../../../../core/promiseUtils.js\";import{getJsonType as a}from\"../../../../geometry/support/jsonUtils.js\";import{WGS84 as o,equals as u}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{convertFromGeometry as l,convertToGeometry as d,convertFromFeatures as p,convertToFeature as c,convertFromFeature as h}from\"../../featureConversionUtils.js\";import y from\"../../data/FeatureStore.js\";import{checkProjectionSupport as m,project as f}from\"../../data/projectionSupport.js\";import{QueryEngine as g}from\"../../data/QueryEngine.js\";import{inferLayerProperties as _,createOptimizedFeatures as I,validateGeoJSON as j}from\"./geojson.js\";import{createDrawingInfo as F,createDefaultTemplate as E,createDefaultAttributesFunction as b}from\"../support/clientSideDefaults.js\";import{loadGeometryEngineForSimplify as w,mixAttributes as T,createFeatureEditSuccessResult as x,createFeatureEditErrorResult as q,simplify as S}from\"../support/sourceUtils.js\";import R from\"../../../support/FieldsIndex.js\";import{kebabDict as k}from\"../../../support/fieldType.js\";import{getFieldDefaultValue as O}from\"../../../support/fieldUtils.js\";const C={hasAttachments:!1,capabilities:\"query, editing, create, delete, update\",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsPercentileStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}};class D{constructor(){this._queryEngine=null,this._snapshotFeatures=async e=>{const t=await this._fetch(e);return this._createFeatures(t)}}destroy(){this._queryEngine?.destroy(),this._queryEngine=this._fieldsIndex=this._createDefaultAttributes=null}async load(e,t={}){this._loadOptions={url:e.url,customParameters:e.customParameters};const i=[];await this._checkProjection(e.spatialReference);let r=null;e.url&&(r=await this._fetch(t?.signal));const n=_(r,{geometryType:e.geometryType}),a=e.fields||n.fields||[],u=null!=e.hasZ?e.hasZ:n.hasZ,l=n.geometryType;let d=e.objectIdField||n.objectIdFieldName||\"__OBJECTID\";const p=e.spatialReference||o;let c=e.timeInfo;a===n.fields&&n.unknownFields.length>0&&i.push({name:\"geojson-layer:unknown-field-types\",message:\"Some fields types couldn't be inferred from the features and were dropped\",details:{unknownFields:n.unknownFields}});let h=new R(a).get(d);h?(\"esriFieldTypeString\"!==h.type&&(h.type=\"esriFieldTypeOID\"),h.editable=!1,h.nullable=!1,d=h.name):(h={alias:d,name:d,type:\"string\"===n.objectIdFieldType?\"esriFieldTypeString\":\"esriFieldTypeOID\",editable:!1,nullable:!1},a.unshift(h));const m={};for(const o of a){if(null==o.name&&(o.name=o.alias),null==o.alias&&(o.alias=o.name),!o.name)throw new s(\"geojson-layer:invalid-field-name\",\"field name is missing\",{field:o});if(!k.jsonValues.includes(o.type))throw new s(\"geojson-layer:invalid-field-type\",`invalid type for field \"${o.name}\"`,{field:o});if(o.name!==h.name){const e=O(o);void 0!==e&&(m[o.name]=e)}}this._fieldsIndex=new R(a);const f=this._fieldsIndex.requiredFields.indexOf(h);if(f>-1&&this._fieldsIndex.requiredFields.splice(f,1),c){if(c.startTimeField){const e=this._fieldsIndex.get(c.startTimeField);e?(c.startTimeField=e.name,e.type=\"esriFieldTypeDate\"):c.startTimeField=null}if(c.endTimeField){const e=this._fieldsIndex.get(c.endTimeField);e?(c.endTimeField=e.name,e.type=\"esriFieldTypeDate\"):c.endTimeField=null}if(c.trackIdField){const e=this._fieldsIndex.get(c.trackIdField);e?c.trackIdField=e.name:(c.trackIdField=null,i.push({name:\"geojson-layer:invalid-timeInfo-trackIdField\",message:\"trackIdField is missing\",details:{timeInfo:c}}))}c.startTimeField||c.endTimeField||(i.push({name:\"geojson-layer:invalid-timeInfo\",message:\"startTimeField and endTimeField are missing\",details:{timeInfo:c}}),c=null)}const I=l?F(l):void 0,j={warnings:i,featureErrors:[],layerDefinition:{...C,drawingInfo:I??void 0,templates:E(m),extent:void 0,geometryType:l,objectIdField:d,fields:a,hasZ:!!u,timeInfo:c}};this._queryEngine=new g({fields:a,geometryType:l,hasM:!1,hasZ:u,objectIdField:d,spatialReference:p,timeInfo:c,featureStore:new y({geometryType:l,hasM:!1,hasZ:u}),cacheSpatialQueries:!0}),this._createDefaultAttributes=b(m,d);const w=await this._createFeatures(r);this._objectIdGenerator=this._createObjectIdGenerator(this._queryEngine,w);const T=this._normalizeFeatures(w,j.warnings,j.featureErrors);this._queryEngine.featureStore.addMany(T);const{fullExtent:x,timeExtent:q}=await this._queryEngine.fetchRecomputedExtents();if(j.layerDefinition.extent=x,q){const{start:e,end:t}=q;j.layerDefinition.timeInfo.timeExtent=[e,t]}return j}async applyEdits(e){const{spatialReference:t,geometryType:s}=this._queryEngine;return await Promise.all([w(t,s),m(e.adds,t),m(e.updates,t)]),await this._waitSnapshotComplete(),this._applyEdits(e)}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(e){this._loadOptions.customParameters=e,this._snapshotTask?.abort(),this._snapshotTask=t(this._snapshotFeatures),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),this._objectIdGenerator=this._createObjectIdGenerator(this._queryEngine,e);const t=this._normalizeFeatures(e);t&&this._queryEngine.featureStore.addMany(t)}),(e=>{this._queryEngine.featureStore.clear(),n(e)||i.getLogger(\"esri.layers.GeoJSONLayer\").error(new s(\"geojson-layer:refresh\",\"An error occurred during refresh\",{error:e}))})),await this._waitSnapshotComplete();const{fullExtent:r,timeExtent:a}=await this._queryEngine.fetchRecomputedExtents();return{extent:r,timeExtent:a}}async _createFeatures(e){if(null==e)return[];const{geometryType:t,hasZ:s,objectIdField:i}=this._queryEngine,n=I(e,{geometryType:t,hasZ:s,objectIdField:i});if(!u(this._queryEngine.spatialReference,o))for(const a of n)r(a.geometry)&&(a.geometry=l(f(d(a.geometry,this._queryEngine.geometryType,this._queryEngine.hasZ,!1),o,this._queryEngine.spatialReference)));return n}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _fetch(t){const{url:s,customParameters:i}=this._loadOptions,r=(await e(s,{responseType:\"json\",query:{...i},signal:t})).data;return await j(r),r}_normalizeFeatures(e,t,s){const{objectIdField:i}=this._queryEngine,r=[];for(const n of e){const e=this._createDefaultAttributes(),a=T(this._fieldsIndex,e,n.attributes,!0,t);a?s?.push(a):(this._assignObjectId(e,n.attributes,!0),n.attributes=e,n.objectId=e[i],r.push(n))}return r}async _applyEdits(e){const{adds:t,updates:s,deletes:i}=e,r={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};if(t&&t.length&&this._applyAddEdits(r,t),s&&s.length&&this._applyUpdateEdits(r,s),i&&i.length){for(const e of i)r.deleteResults.push(x(e));this._queryEngine.featureStore.removeManyById(i)}const{fullExtent:n,timeExtent:a}=await this._queryEngine.fetchRecomputedExtents();return{extent:n,timeExtent:a,featureEditResults:r}}_applyAddEdits(e,t){const{addResults:s}=e,{geometryType:i,hasM:n,hasZ:o,objectIdField:u,spatialReference:l,featureStore:d}=this._queryEngine,c=[];for(const p of t){if(p.geometry&&i!==a(p.geometry)){s.push(q(\"Incorrect geometry type.\"));continue}const t=this._createDefaultAttributes(),n=T(this._fieldsIndex,t,p.attributes);if(n)s.push(n);else{if(this._assignObjectId(t,p.attributes),p.attributes=t,null!=p.uid){const t=p.attributes[u];e.uidToObjectId[p.uid]=t}if(r(p.geometry)){const e=p.geometry.spatialReference??l;p.geometry=f(S(p.geometry,e),e,l)}c.push(p),s.push(x(p.attributes[u]))}}d.addMany(p([],c,i,o,n,u))}_applyUpdateEdits({updateResults:e},t){const{geometryType:s,hasM:i,hasZ:n,objectIdField:o,spatialReference:u,featureStore:l}=this._queryEngine;for(const d of t){const{attributes:t,geometry:p}=d,y=t&&t[o];if(null==y){e.push(q(`Identifier field ${o} missing`));continue}if(!l.has(y)){e.push(q(`Feature with object id ${y} missing`));continue}const m=c(l.getFeature(y),s,n,i);if(r(p)){if(s!==a(p)){e.push(q(\"Incorrect geometry type.\"));continue}const t=p.spatialReference??u;m.geometry=f(S(p,t),t,u)}if(t){const s=T(this._fieldsIndex,m.attributes,t);if(s){e.push(s);continue}}l.add(h(m,s,n,i,o)),e.push(x(y))}}_createObjectIdGenerator(e,t){const s=e.fieldsIndex.get(e.objectIdField);if(\"esriFieldTypeString\"===s.type)return()=>s.name+\"-\"+Date.now().toString(16);let i=Number.NEGATIVE_INFINITY;for(const r of t)r.objectId&&(i=Math.max(i,r.objectId));return i=Math.max(0,i)+1,()=>i++}_assignObjectId(e,t,s=!1){const i=this._queryEngine.objectIdField;e[i]=s&&i in t?t[i]:this._objectIdGenerator()}async _checkProjection(e){try{await m(o,e)}catch{throw new s(\"geojson-layer\",\"Projection not supported\")}}}export{D as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}