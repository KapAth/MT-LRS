{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { isSome as t } from \"../../../core/maybe.js\";\nimport { isArrayBuffer as r } from \"../../../core/typedArrayUtil.js\";\nimport { c as e } from \"../../../chunks/quat.js\";\nimport { c as a } from \"../../../chunks/quatf32.js\";\nimport { q as o } from \"../../../chunks/vec3.js\";\nimport { f, c as i } from \"../../../chunks/vec3f32.js\";\nimport { projectBuffer as n } from \"../../../geometry/projection.js\";\nimport s from \"../../../geometry/SpatialReference.js\";\nimport { readGeometry as u, getAttributeValues as l, evaluateRenderer as b, filterInPlace as m } from \"./i3s/PointCloudWorkerUtil.js\";\n\nclass c {\n  transform(e) {\n    const a = this._transform(e),\n          o = [a.points.buffer, a.rgb.buffer];\n\n    t(a.pointIdFilterMap) && o.push(a.pointIdFilterMap.buffer);\n\n    for (const t of a.attributes) \"buffer\" in t.values && r(t.values.buffer) && t.values.buffer !== a.rgb.buffer && o.push(t.values.buffer);\n\n    return Promise.resolve({\n      result: a,\n      transferList: o\n    });\n  }\n\n  _transform(r) {\n    const e = u(r.schema, r.geometryBuffer);\n    let a = e.length / 3,\n        o = null;\n    const f = [],\n          i = l(r.primaryAttributeData, e, a);\n    t(r.primaryAttributeData) && i && f.push({\n      attributeInfo: r.primaryAttributeData.attributeInfo,\n      values: i\n    });\n    const n = l(r.modulationAttributeData, e, a);\n    t(r.modulationAttributeData) && n && f.push({\n      attributeInfo: r.modulationAttributeData.attributeInfo,\n      values: n\n    });\n    let c = b(r.rendererInfo, i, n, a);\n\n    if (r.filterInfo && r.filterInfo.length > 0 && t(r.filterAttributesData)) {\n      const i = r.filterAttributesData.filter(t).map(t => {\n        const r = l(t, e, a),\n              o = {\n          attributeInfo: t.attributeInfo,\n          values: r\n        };\n        return f.push(o), o;\n      });\n      o = new Uint32Array(a), a = m(e, c, o, r.filterInfo, i);\n    }\n\n    for (const t of r.userAttributesData) {\n      const r = l(t, e, a);\n      f.push({\n        attributeInfo: t.attributeInfo,\n        values: r\n      });\n    }\n\n    3 * a < c.length && (c = new Uint8Array(c.buffer.slice(0, 3 * a))), this._applyElevationOffsetInPlace(e, a, r.elevationOffset);\n\n    const p = this._transformCoordinates(e, a, r.obb, s.fromJSON(r.inSR), s.fromJSON(r.outSR));\n\n    return {\n      obb: r.obb,\n      points: p,\n      rgb: c,\n      attributes: f,\n      pointIdFilterMap: o\n    };\n  }\n\n  _transformCoordinates(t, r, a, s, u) {\n    if (!n(t, s, 0, t, u, 0, r)) throw new Error(\"Can't reproject\");\n    const l = f(a.center[0], a.center[1], a.center[2]),\n          b = i(),\n          m = i();\n    e(p, a.quaternion);\n    const c = new Float32Array(3 * r);\n\n    for (let e = 0; e < r; e++) b[0] = t[3 * e] - l[0], b[1] = t[3 * e + 1] - l[1], b[2] = t[3 * e + 2] - l[2], o(m, b, p), a.halfSize[0] = Math.max(a.halfSize[0], Math.abs(m[0])), a.halfSize[1] = Math.max(a.halfSize[1], Math.abs(m[1])), a.halfSize[2] = Math.max(a.halfSize[2], Math.abs(m[2])), c[3 * e] = b[0], c[3 * e + 1] = b[1], c[3 * e + 2] = b[2];\n\n    return c;\n  }\n\n  _applyElevationOffsetInPlace(t, r, e) {\n    if (0 !== e) for (let a = 0; a < r; a++) t[3 * a + 2] += e;\n  }\n\n}\n\nconst p = a();\n\nfunction h() {\n  return new c();\n}\n\nexport { h as default };","map":{"version":3,"names":["isSome","t","isArrayBuffer","r","c","e","a","q","o","f","i","projectBuffer","n","s","readGeometry","u","getAttributeValues","l","evaluateRenderer","b","filterInPlace","m","transform","_transform","points","buffer","rgb","pointIdFilterMap","push","attributes","values","Promise","resolve","result","transferList","schema","geometryBuffer","length","primaryAttributeData","attributeInfo","modulationAttributeData","rendererInfo","filterInfo","filterAttributesData","filter","map","Uint32Array","userAttributesData","Uint8Array","slice","_applyElevationOffsetInPlace","elevationOffset","p","_transformCoordinates","obb","fromJSON","inSR","outSR","Error","center","quaternion","Float32Array","halfSize","Math","max","abs","h","default"],"sources":["C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/node_modules/@arcgis/core/views/3d/layers/PointCloudWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{isArrayBuffer as r}from\"../../../core/typedArrayUtil.js\";import{c as e}from\"../../../chunks/quat.js\";import{c as a}from\"../../../chunks/quatf32.js\";import{q as o}from\"../../../chunks/vec3.js\";import{f,c as i}from\"../../../chunks/vec3f32.js\";import{projectBuffer as n}from\"../../../geometry/projection.js\";import s from\"../../../geometry/SpatialReference.js\";import{readGeometry as u,getAttributeValues as l,evaluateRenderer as b,filterInPlace as m}from\"./i3s/PointCloudWorkerUtil.js\";class c{transform(e){const a=this._transform(e),o=[a.points.buffer,a.rgb.buffer];t(a.pointIdFilterMap)&&o.push(a.pointIdFilterMap.buffer);for(const t of a.attributes)\"buffer\"in t.values&&r(t.values.buffer)&&t.values.buffer!==a.rgb.buffer&&o.push(t.values.buffer);return Promise.resolve({result:a,transferList:o})}_transform(r){const e=u(r.schema,r.geometryBuffer);let a=e.length/3,o=null;const f=[],i=l(r.primaryAttributeData,e,a);t(r.primaryAttributeData)&&i&&f.push({attributeInfo:r.primaryAttributeData.attributeInfo,values:i});const n=l(r.modulationAttributeData,e,a);t(r.modulationAttributeData)&&n&&f.push({attributeInfo:r.modulationAttributeData.attributeInfo,values:n});let c=b(r.rendererInfo,i,n,a);if(r.filterInfo&&r.filterInfo.length>0&&t(r.filterAttributesData)){const i=r.filterAttributesData.filter(t).map((t=>{const r=l(t,e,a),o={attributeInfo:t.attributeInfo,values:r};return f.push(o),o}));o=new Uint32Array(a),a=m(e,c,o,r.filterInfo,i)}for(const t of r.userAttributesData){const r=l(t,e,a);f.push({attributeInfo:t.attributeInfo,values:r})}3*a<c.length&&(c=new Uint8Array(c.buffer.slice(0,3*a))),this._applyElevationOffsetInPlace(e,a,r.elevationOffset);const p=this._transformCoordinates(e,a,r.obb,s.fromJSON(r.inSR),s.fromJSON(r.outSR));return{obb:r.obb,points:p,rgb:c,attributes:f,pointIdFilterMap:o}}_transformCoordinates(t,r,a,s,u){if(!n(t,s,0,t,u,0,r))throw new Error(\"Can't reproject\");const l=f(a.center[0],a.center[1],a.center[2]),b=i(),m=i();e(p,a.quaternion);const c=new Float32Array(3*r);for(let e=0;e<r;e++)b[0]=t[3*e]-l[0],b[1]=t[3*e+1]-l[1],b[2]=t[3*e+2]-l[2],o(m,b,p),a.halfSize[0]=Math.max(a.halfSize[0],Math.abs(m[0])),a.halfSize[1]=Math.max(a.halfSize[1],Math.abs(m[1])),a.halfSize[2]=Math.max(a.halfSize[2],Math.abs(m[2])),c[3*e]=b[0],c[3*e+1]=b[1],c[3*e+2]=b[2];return c}_applyElevationOffsetInPlace(t,r,e){if(0!==e)for(let a=0;a<r;a++)t[3*a+2]+=e}}const p=a();function h(){return new c}export{h as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}