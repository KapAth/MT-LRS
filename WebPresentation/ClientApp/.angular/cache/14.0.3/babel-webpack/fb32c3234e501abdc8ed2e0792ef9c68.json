{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/ClientApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { id as t } from \"../../kernel.js\";\nimport r from \"../../request.js\";\nimport { isNone as e, isSome as a } from \"../../core/maybe.js\";\nimport { throwIfAbortError as i } from \"../../core/promiseUtils.js\";\nimport s from \"../FeatureLayer.js\";\nimport n from \"../../portal/Portal.js\";\nimport o from \"../../portal/PortalItem.js\";\n\nclass l {\n  constructor(t, r, e, a) {\n    this._parsedUrl = t, this._portalItem = r, this._apiKey = e, this.signal = a, this._rootDocument = null;\n    const i = this._parsedUrl?.path.match(/^(.*)\\/SceneServer\\/layers\\/([\\d]*)\\/?$/i);\n    i && (this._urlParts = {\n      root: i[1],\n      layerId: parseInt(i[2], 10)\n    });\n  }\n\n  fetch() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      if (!_this._urlParts) return null;\n      const t = _this._portalItem ?? (yield _this._portalItemFromServiceItemId());\n      if (e(t)) return _this._loadFromUrl();\n      const r = yield _this._findAndLoadRelatedPortalItem(t);\n      return e(r) ? null : _this._loadFeatureLayerFromPortalItem(r);\n    })();\n  }\n\n  fetchPortalItem() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      if (!_this2._urlParts) return null;\n      const t = _this2._portalItem ?? (yield _this2._portalItemFromServiceItemId());\n      return e(t) ? null : _this2._findAndLoadRelatedPortalItem(t);\n    })();\n  }\n\n  _fetchRootDocument() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      if (a(_this3._rootDocument)) return _this3._rootDocument;\n      if (e(_this3._urlParts)) return _this3._rootDocument = {}, {};\n      const t = {\n        query: {\n          f: \"json\",\n          token: _this3._apiKey\n        },\n        responseType: \"json\",\n        signal: _this3.signal\n      },\n            i = `${_this3._urlParts.root}/SceneServer`;\n\n      try {\n        const e = yield r(i, t);\n        _this3._rootDocument = e.data;\n      } catch {\n        _this3._rootDocument = {};\n      }\n\n      return _this3._rootDocument;\n    })();\n  }\n\n  _fetchServiceOwningPortalUrl() {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      const e = _this4._parsedUrl?.path,\n            a = e ? t?.findServerInfo(e) : null;\n      if (a?.owningSystemUrl) return a.owningSystemUrl;\n      const s = e ? e.replace(/(.*\\/rest)\\/.*/i, \"$1\") + \"/info\" : null;\n\n      try {\n        const t = (yield r(s, {\n          query: {\n            f: \"json\"\n          },\n          responseType: \"json\",\n          signal: _this4.signal\n        })).data.owningSystemUrl;\n        if (t) return t;\n      } catch (n) {\n        i(n);\n      }\n\n      return null;\n    })();\n  }\n\n  _findAndLoadRelatedPortalItem(t) {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        return (yield t.fetchRelatedItems({\n          relationshipType: \"Service2Service\",\n          direction: \"reverse\"\n        }, {\n          signal: _this5.signal\n        })).find(t => \"Feature Service\" === t.type) || null;\n      } catch (r) {\n        return i(r), null;\n      }\n    })();\n  }\n\n  _loadFeatureLayerFromPortalItem(t) {\n    var _this6 = this;\n\n    return _asyncToGenerator(function* () {\n      yield t.load({\n        signal: _this6.signal\n      });\n      const r = yield _this6._findMatchingAssociatedSublayerUrl(t.url ?? \"\");\n      return new s({\n        url: r,\n        portalItem: t\n      }).load({\n        signal: _this6.signal\n      });\n    })();\n  }\n\n  _loadFromUrl() {\n    var _this7 = this;\n\n    return _asyncToGenerator(function* () {\n      const t = yield _this7._findMatchingAssociatedSublayerUrl(`${_this7._urlParts?.root}/FeatureServer`);\n      return new s({\n        url: t\n      }).load({\n        signal: _this7.signal\n      });\n    })();\n  }\n\n  _findMatchingAssociatedSublayerUrl(t) {\n    var _this8 = this;\n\n    return _asyncToGenerator(function* () {\n      const e = t.replace(/^(.*FeatureServer)(\\/[\\d]*\\/?)?$/i, \"$1\"),\n            a = {\n        query: {\n          f: \"json\"\n        },\n        responseType: \"json\",\n        authMode: \"no-prompt\",\n        signal: _this8.signal\n      },\n            i = _this8._urlParts?.layerId,\n            s = _this8._fetchRootDocument(),\n            n = r(e, a),\n            [o, l] = yield Promise.all([n, s]),\n            c = l && l.layers,\n            u = o.data && o.data.layers;\n\n      if (!Array.isArray(u)) throw new Error(\"expected layers array\");\n      if (Array.isArray(c)) for (let r = 0; r < Math.min(c.length, u.length); r++) {\n        if (c[r].id === i) return `${e}/${u[r].id}`;\n      } else if (null != i && i < u.length) return `${e}/${u[i].id}`;\n      throw new Error(\"could not find matching associated sublayer\");\n    })();\n  }\n\n  _portalItemFromServiceItemId() {\n    var _this9 = this;\n\n    return _asyncToGenerator(function* () {\n      const t = (yield _this9._fetchRootDocument()).serviceItemId;\n      if (!t) return null;\n      const r = new o({\n        id: t,\n        apiKey: _this9._apiKey\n      }),\n            e = yield _this9._fetchServiceOwningPortalUrl();\n      a(e) && (r.portal = new n({\n        url: e\n      }));\n\n      try {\n        return r.load({\n          signal: _this9.signal\n        });\n      } catch (s) {\n        return i(s), null;\n      }\n    })();\n  }\n\n}\n\nexport { l as FetchAssociatedFeatureLayer };","map":{"version":3,"names":["id","t","r","isNone","e","isSome","a","throwIfAbortError","i","s","n","o","l","constructor","_parsedUrl","_portalItem","_apiKey","signal","_rootDocument","path","match","_urlParts","root","layerId","parseInt","fetch","_portalItemFromServiceItemId","_loadFromUrl","_findAndLoadRelatedPortalItem","_loadFeatureLayerFromPortalItem","fetchPortalItem","_fetchRootDocument","query","f","token","responseType","data","_fetchServiceOwningPortalUrl","findServerInfo","owningSystemUrl","replace","fetchRelatedItems","relationshipType","direction","find","type","load","_findMatchingAssociatedSublayerUrl","url","portalItem","authMode","Promise","all","c","layers","u","Array","isArray","Error","Math","min","length","serviceItemId","apiKey","portal","FetchAssociatedFeatureLayer"],"sources":["C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/node_modules/@arcgis/core/layers/support/FetchAssociatedFeatureLayer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{id as t}from\"../../kernel.js\";import r from\"../../request.js\";import{isNone as e,isSome as a}from\"../../core/maybe.js\";import{throwIfAbortError as i}from\"../../core/promiseUtils.js\";import s from\"../FeatureLayer.js\";import n from\"../../portal/Portal.js\";import o from\"../../portal/PortalItem.js\";class l{constructor(t,r,e,a){this._parsedUrl=t,this._portalItem=r,this._apiKey=e,this.signal=a,this._rootDocument=null;const i=this._parsedUrl?.path.match(/^(.*)\\/SceneServer\\/layers\\/([\\d]*)\\/?$/i);i&&(this._urlParts={root:i[1],layerId:parseInt(i[2],10)})}async fetch(){if(!this._urlParts)return null;const t=this._portalItem??await this._portalItemFromServiceItemId();if(e(t))return this._loadFromUrl();const r=await this._findAndLoadRelatedPortalItem(t);return e(r)?null:this._loadFeatureLayerFromPortalItem(r)}async fetchPortalItem(){if(!this._urlParts)return null;const t=this._portalItem??await this._portalItemFromServiceItemId();return e(t)?null:this._findAndLoadRelatedPortalItem(t)}async _fetchRootDocument(){if(a(this._rootDocument))return this._rootDocument;if(e(this._urlParts))return this._rootDocument={},{};const t={query:{f:\"json\",token:this._apiKey},responseType:\"json\",signal:this.signal},i=`${this._urlParts.root}/SceneServer`;try{const e=await r(i,t);this._rootDocument=e.data}catch{this._rootDocument={}}return this._rootDocument}async _fetchServiceOwningPortalUrl(){const e=this._parsedUrl?.path,a=e?t?.findServerInfo(e):null;if(a?.owningSystemUrl)return a.owningSystemUrl;const s=e?e.replace(/(.*\\/rest)\\/.*/i,\"$1\")+\"/info\":null;try{const t=(await r(s,{query:{f:\"json\"},responseType:\"json\",signal:this.signal})).data.owningSystemUrl;if(t)return t}catch(n){i(n)}return null}async _findAndLoadRelatedPortalItem(t){try{return(await t.fetchRelatedItems({relationshipType:\"Service2Service\",direction:\"reverse\"},{signal:this.signal})).find((t=>\"Feature Service\"===t.type))||null}catch(r){return i(r),null}}async _loadFeatureLayerFromPortalItem(t){await t.load({signal:this.signal});const r=await this._findMatchingAssociatedSublayerUrl(t.url??\"\");return new s({url:r,portalItem:t}).load({signal:this.signal})}async _loadFromUrl(){const t=await this._findMatchingAssociatedSublayerUrl(`${this._urlParts?.root}/FeatureServer`);return new s({url:t}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(t){const e=t.replace(/^(.*FeatureServer)(\\/[\\d]*\\/?)?$/i,\"$1\"),a={query:{f:\"json\"},responseType:\"json\",authMode:\"no-prompt\",signal:this.signal},i=this._urlParts?.layerId,s=this._fetchRootDocument(),n=r(e,a),[o,l]=await Promise.all([n,s]),c=l&&l.layers,u=o.data&&o.data.layers;if(!Array.isArray(u))throw new Error(\"expected layers array\");if(Array.isArray(c))for(let r=0;r<Math.min(c.length,u.length);r++){if(c[r].id===i)return`${e}/${u[r].id}`}else if(null!=i&&i<u.length)return`${e}/${u[i].id}`;throw new Error(\"could not find matching associated sublayer\")}async _portalItemFromServiceItemId(){const t=(await this._fetchRootDocument()).serviceItemId;if(!t)return null;const r=new o({id:t,apiKey:this._apiKey}),e=await this._fetchServiceOwningPortalUrl();a(e)&&(r.portal=new n({url:e}));try{return r.load({signal:this.signal})}catch(s){return i(s),null}}}export{l as FetchAssociatedFeatureLayer};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}