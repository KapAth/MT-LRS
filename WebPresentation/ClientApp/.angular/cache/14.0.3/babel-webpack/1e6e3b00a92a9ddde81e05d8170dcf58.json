{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../chunks/tslib.es6.js\";\nimport { isNone as s } from \"../../../core/maybe.js\";\nimport { property as e } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/arrayUtils.js\";\nimport { subclass as o } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport r from \"./BaseRasterFunction.js\";\nimport { lookupPixels as u } from \"./pixelUtils.js\";\nimport n from \"./StretchFunctionArguments.js\";\nimport { getStretchCutoff as i, createStretchLUT as a, stretch as p, computeGammaCorrection as c } from \"./stretchUtils.js\";\nlet m = class extends r {\n  constructor() {\n    super(...arguments), this.functionName = \"Stretch\", this.functionArguments = null, this.rasterArgumentNames = [\"raster\"], this.lookup = null, this.cutOffs = null;\n  }\n\n  _bindSourceRasters() {\n    this.lookup = null, this.cutOffs = null;\n    const t = this.sourceRasterInfos[0],\n          {\n      pixelType: s\n    } = t,\n          {\n      functionArguments: e\n    } = this,\n          {\n      dynamicRangeAdjustment: o,\n      gamma: r,\n      useGamma: u\n    } = e;\n\n    if (!o && [\"u8\", \"u16\", \"s8\", \"s16\"].includes(s)) {\n      const o = i(e.toJSON(), {\n        rasterInfo: t\n      }),\n            n = this._isOutputRoundingNeeded() ? \"round\" : \"float\";\n      this.lookup = a({\n        pixelType: s,\n        ...o,\n        gamma: u ? r : null,\n        rounding: n\n      }), this.cutOffs = o;\n    } else o || (this.cutOffs = i(e.toJSON(), {\n      rasterInfo: t\n    }));\n\n    this.outputPixelType = this._getOutputPixelType(s);\n    const n = t.clone();\n    n.pixelType = this.outputPixelType, n.statistics = null, n.histograms = null, n.colormap = null, n.attributeTable = null, \"u8\" === this.outputPixelType && (n.keyProperties.DataType = \"processed\"), this.rasterInfo = n;\n    return {\n      success: !0,\n      supportsGPU: !o\n    };\n  }\n\n  _processPixels(t) {\n    const e = t.pixelBlocks?.[0];\n    if (s(e)) return e;\n    const {\n      lookup: o\n    } = this;\n    if (o) return u(e, { ...o,\n      outputPixelType: this.rasterInfo.pixelType\n    });\n    const {\n      functionArguments: r\n    } = this,\n          n = this.cutOffs || i(r.toJSON(), {\n      rasterInfo: this.sourceRasterInfos[0],\n      pixelBlock: e\n    }),\n          a = r.useGamma ? r.gamma : null;\n    return p(e, { ...n,\n      gamma: a,\n      outputPixelType: this.outputPixelType\n    });\n  }\n\n  _getWebGLParameters() {\n    const {\n      outputMin: t = 0,\n      outputMax: s = 255,\n      gamma: e,\n      useGamma: o\n    } = this.functionArguments,\n          r = this.rasterInfo.bandCount >= 2 ? 3 : 1,\n          u = o && e && e.length ? c(r, e) : [1, 1, 1],\n          {\n      minCutOff: n,\n      maxCutOff: i\n    } = this.cutOffs ?? {\n      minCutOff: [0, 0, 0],\n      maxCutOff: [255, 255, 255]\n    };\n    1 === n.length && (n[1] = n[2] = n[0], i[1] = i[2] = i[0]);\n    const a = new Float32Array(r);\n    let p;\n\n    for (p = 0; p < r; p++) a[p] = (s - t) / (i[p] - n[p]);\n\n    const m = this._isOutputRoundingNeeded();\n\n    return {\n      bandCount: r,\n      outMin: t,\n      outMax: s,\n      minCutOff: n,\n      maxCutOff: i,\n      factor: a,\n      useGamma: o,\n      gamma: o && e ? e : [1, 1, 1],\n      gammaCorrection: o && u ? u : [1, 1, 1],\n      stretchType: this.functionArguments.stretchType,\n      isOutputRounded: m,\n      type: \"stretch\"\n    };\n  }\n\n};\nt([e({\n  json: {\n    write: !0,\n    name: \"rasterFunction\"\n  }\n})], m.prototype, \"functionName\", void 0), t([e({\n  type: n,\n  json: {\n    write: !0,\n    name: \"rasterFunctionArguments\"\n  }\n})], m.prototype, \"functionArguments\", void 0), t([e()], m.prototype, \"rasterArgumentNames\", void 0), t([e({\n  json: {\n    write: !0\n  }\n})], m.prototype, \"lookup\", void 0), t([e({\n  json: {\n    write: !0\n  }\n})], m.prototype, \"cutOffs\", void 0), m = t([o(\"esri.layers.support.rasterFunctions.StretchFunction\")], m);\nconst l = m;\nexport { l as default };","map":{"version":3,"names":["_","t","isNone","s","property","e","subclass","o","r","lookupPixels","u","n","getStretchCutoff","i","createStretchLUT","a","stretch","p","computeGammaCorrection","c","m","constructor","arguments","functionName","functionArguments","rasterArgumentNames","lookup","cutOffs","_bindSourceRasters","sourceRasterInfos","pixelType","dynamicRangeAdjustment","gamma","useGamma","includes","toJSON","rasterInfo","_isOutputRoundingNeeded","rounding","outputPixelType","_getOutputPixelType","clone","statistics","histograms","colormap","attributeTable","keyProperties","DataType","success","supportsGPU","_processPixels","pixelBlocks","pixelBlock","_getWebGLParameters","outputMin","outputMax","bandCount","length","minCutOff","maxCutOff","Float32Array","outMin","outMax","factor","gammaCorrection","stretchType","isOutputRounded","type","json","write","name","prototype","l","default"],"sources":["C:/Users/akaps/Documents/Visual Studio 2022/Projects/MT_LRS/WebPresentation/node_modules/@arcgis/core/layers/support/rasterFunctions/StretchFunction.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import{isNone as s}from\"../../../core/maybe.js\";import{property as e}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import{subclass as o}from\"../../../core/accessorSupport/decorators/subclass.js\";import r from\"./BaseRasterFunction.js\";import{lookupPixels as u}from\"./pixelUtils.js\";import n from\"./StretchFunctionArguments.js\";import{getStretchCutoff as i,createStretchLUT as a,stretch as p,computeGammaCorrection as c}from\"./stretchUtils.js\";let m=class extends r{constructor(){super(...arguments),this.functionName=\"Stretch\",this.functionArguments=null,this.rasterArgumentNames=[\"raster\"],this.lookup=null,this.cutOffs=null}_bindSourceRasters(){this.lookup=null,this.cutOffs=null;const t=this.sourceRasterInfos[0],{pixelType:s}=t,{functionArguments:e}=this,{dynamicRangeAdjustment:o,gamma:r,useGamma:u}=e;if(!o&&[\"u8\",\"u16\",\"s8\",\"s16\"].includes(s)){const o=i(e.toJSON(),{rasterInfo:t}),n=this._isOutputRoundingNeeded()?\"round\":\"float\";this.lookup=a({pixelType:s,...o,gamma:u?r:null,rounding:n}),this.cutOffs=o}else o||(this.cutOffs=i(e.toJSON(),{rasterInfo:t}));this.outputPixelType=this._getOutputPixelType(s);const n=t.clone();n.pixelType=this.outputPixelType,n.statistics=null,n.histograms=null,n.colormap=null,n.attributeTable=null,\"u8\"===this.outputPixelType&&(n.keyProperties.DataType=\"processed\"),this.rasterInfo=n;return{success:!0,supportsGPU:!o}}_processPixels(t){const e=t.pixelBlocks?.[0];if(s(e))return e;const{lookup:o}=this;if(o)return u(e,{...o,outputPixelType:this.rasterInfo.pixelType});const{functionArguments:r}=this,n=this.cutOffs||i(r.toJSON(),{rasterInfo:this.sourceRasterInfos[0],pixelBlock:e}),a=r.useGamma?r.gamma:null;return p(e,{...n,gamma:a,outputPixelType:this.outputPixelType})}_getWebGLParameters(){const{outputMin:t=0,outputMax:s=255,gamma:e,useGamma:o}=this.functionArguments,r=this.rasterInfo.bandCount>=2?3:1,u=o&&e&&e.length?c(r,e):[1,1,1],{minCutOff:n,maxCutOff:i}=this.cutOffs??{minCutOff:[0,0,0],maxCutOff:[255,255,255]};1===n.length&&(n[1]=n[2]=n[0],i[1]=i[2]=i[0]);const a=new Float32Array(r);let p;for(p=0;p<r;p++)a[p]=(s-t)/(i[p]-n[p]);const m=this._isOutputRoundingNeeded();return{bandCount:r,outMin:t,outMax:s,minCutOff:n,maxCutOff:i,factor:a,useGamma:o,gamma:o&&e?e:[1,1,1],gammaCorrection:o&&u?u:[1,1,1],stretchType:this.functionArguments.stretchType,isOutputRounded:m,type:\"stretch\"}}};t([e({json:{write:!0,name:\"rasterFunction\"}})],m.prototype,\"functionName\",void 0),t([e({type:n,json:{write:!0,name:\"rasterFunctionArguments\"}})],m.prototype,\"functionArguments\",void 0),t([e()],m.prototype,\"rasterArgumentNames\",void 0),t([e({json:{write:!0}})],m.prototype,\"lookup\",void 0),t([e({json:{write:!0}})],m.prototype,\"cutOffs\",void 0),m=t([o(\"esri.layers.support.rasterFunctions.StretchFunction\")],m);const l=m;export{l as default};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}